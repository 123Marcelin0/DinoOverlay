{"version":3,"file":"dino-overlay.iife.js","sources":["../src/types/config.ts","../src/core/ImageDetector.ts","../src/core/ResponsiveManager.ts","../src/types/theme.ts","../src/core/ThemeManager.ts","../src/core/AnimationSystem.ts","../src/core/OverlayAnimations.ts","../src/core/ImageHighlighter.ts","../src/core/TouchGestureHandler.ts","../src/core/QuickActionSidebar.ts","../src/core/FloatingChatBar.ts","../src/core/ErrorManager.ts","../src/core/PerformanceMonitor.ts","../src/core/ImageOptimizer.ts","../src/core/LazyComponentLoader.ts","../src/config/performance.ts","../src/index.ts","../src/core/APIClient.ts","../src/core/DinoOverlayLoader.ts","../src/core/OverlayManager.ts"],"sourcesContent":["export interface DinoOverlayConfig {\r\n  apiEndpoint?: string;\r\n  apiKey?: string;\r\n  theme?: 'light' | 'dark' | 'auto';\r\n  enableAnalytics?: boolean;\r\n  customActions?: CustomAction[];\r\n  debug?: boolean;\r\n}\r\n\r\nexport interface CustomAction {\r\n  id: string;\r\n  label: string;\r\n  prompt: string;\r\n  icon?: string;\r\n}\r\n\r\nexport interface LoaderError extends Error {\r\n  code: string;\r\n  details?: any;\r\n}\r\n\r\nexport const DEFAULT_CONFIG: Required<Omit<DinoOverlayConfig, 'apiKey' | 'customActions'>> = {\r\n  apiEndpoint: 'https://api.dinooverlay.com',\r\n  theme: 'auto',\r\n  enableAnalytics: false,\r\n  debug: false,\r\n};","import { SelectedImage } from '../types/overlay';\r\n\r\nexport interface DetectionConfig {\r\n  className: string;\r\n  observeChanges: boolean;\r\n  debounceMs: number;\r\n  debug?: boolean;\r\n}\r\n\r\nexport interface ImageDetectorEvents {\r\n  imageDetected: (image: HTMLImageElement) => void;\r\n  imageRemoved: (image: HTMLImageElement) => void;\r\n  imageUpdated: (image: HTMLImageElement) => void;\r\n}\r\n\r\nexport class ImageDetector {\r\n  private config: DetectionConfig;\r\n  private observer: MutationObserver | null = null;\r\n  private detectedImages: Set<HTMLImageElement> = new Set();\r\n  private eventListeners: Map<string, Function[]> = new Map();\r\n  private resizeObserver: ResizeObserver | null = null;\r\n  private scrollDebounceTimer: number | null = null;\r\n  private resizeDebounceTimer: number | null = null;\r\n  private isActive: boolean = false;\r\n\r\n  constructor(config: DetectionConfig) {\r\n    this.config = {\r\n      className: 'editable-room',\r\n      observeChanges: true,\r\n      debounceMs: 150,\r\n      debug: false,\r\n      ...config\r\n    };\r\n\r\n    // Bind methods to preserve context\r\n    this.handleScroll = this.handleScroll.bind(this);\r\n    this.handleResize = this.handleResize.bind(this);\r\n    this.handleMutation = this.handleMutation.bind(this);\r\n  }\r\n\r\n  public startDetection(): void {\r\n    if (this.isActive) {\r\n      if (this.config.debug) {\r\n        console.warn('[ImageDetector] Detection already active');\r\n      }\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.isActive = true;\r\n      this.setupMutationObserver();\r\n      this.setupEventListeners();\r\n      this.performInitialScan();\r\n\r\n      if (this.config.debug) {\r\n        console.log('[ImageDetector] Detection started');\r\n      }\r\n    } catch (error) {\r\n      this.isActive = false;\r\n      throw new Error(`Failed to start image detection: ${error}`);\r\n    }\r\n  }\r\n\r\n  public stopDetection(): void {\r\n    if (!this.isActive) {\r\n      return;\r\n    }\r\n\r\n    this.isActive = false;\r\n    this.cleanup();\r\n\r\n    if (this.config.debug) {\r\n      console.log('[ImageDetector] Detection stopped');\r\n    }\r\n  }\r\n\r\n  public getDetectedImages(): HTMLImageElement[] {\r\n    return Array.from(this.detectedImages);\r\n  }\r\n\r\n  public isImageDetected(image: HTMLImageElement): boolean {\r\n    return this.detectedImages.has(image);\r\n  }\r\n\r\n  public calculateImageBounds(image: HTMLImageElement): DOMRect {\r\n    if (!image || !image.isConnected) {\r\n      throw new Error('Image element is not connected to DOM');\r\n    }\r\n\r\n    return image.getBoundingClientRect();\r\n  }\r\n\r\n  public getImageBorderRadius(image: HTMLImageElement): string {\r\n    if (!image || !image.isConnected) {\r\n      return '0px';\r\n    }\r\n\r\n    const computedStyle = window.getComputedStyle(image);\r\n    return computedStyle.borderRadius || '0px';\r\n  }\r\n\r\n  public createSelectedImage(image: HTMLImageElement): SelectedImage {\r\n    const rect = this.calculateImageBounds(image);\r\n    const borderRadius = this.getImageBorderRadius(image);\r\n\r\n    return {\r\n      element: image,\r\n      rect,\r\n      borderRadius\r\n    };\r\n  }\r\n\r\n  public on<K extends keyof ImageDetectorEvents>(\r\n    event: K,\r\n    callback: ImageDetectorEvents[K]\r\n  ): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, []);\r\n    }\r\n    this.eventListeners.get(event)!.push(callback);\r\n  }\r\n\r\n  public off<K extends keyof ImageDetectorEvents>(\r\n    event: K,\r\n    callback: ImageDetectorEvents[K]\r\n  ): void {\r\n    const listeners = this.eventListeners.get(event);\r\n    if (listeners) {\r\n      const index = listeners.indexOf(callback);\r\n      if (index > -1) {\r\n        listeners.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  private setupMutationObserver(): void {\r\n    if (!this.config.observeChanges) {\r\n      return;\r\n    }\r\n\r\n    this.observer = new MutationObserver(this.handleMutation);\r\n    this.observer.observe(document.body, {\r\n      childList: true,\r\n      subtree: true,\r\n      attributes: true,\r\n      attributeFilter: ['class', 'src']\r\n    });\r\n  }\r\n\r\n  private setupEventListeners(): void {\r\n    // Add scroll listener with debouncing\r\n    window.addEventListener('scroll', this.handleScroll, { passive: true });\r\n    \r\n    // Add resize listener with debouncing\r\n    window.addEventListener('resize', this.handleResize, { passive: true });\r\n\r\n    // Setup ResizeObserver for individual image size changes\r\n    if ('ResizeObserver' in window) {\r\n      this.resizeObserver = new ResizeObserver((entries) => {\r\n        for (const entry of entries) {\r\n          const image = entry.target as HTMLImageElement;\r\n          if (this.detectedImages.has(image)) {\r\n            this.emit('imageUpdated', image);\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private performInitialScan(): void {\r\n    const images = this.scanForImages();\r\n    \r\n    for (const image of images) {\r\n      this.addDetectedImage(image);\r\n    }\r\n\r\n    if (this.config.debug) {\r\n      console.log(`[ImageDetector] Initial scan found ${images.length} images`);\r\n    }\r\n  }\r\n\r\n  private scanForImages(): HTMLImageElement[] {\r\n    const selector = `img.${this.config.className}`;\r\n    const elements = document.querySelectorAll(selector);\r\n    \r\n    return Array.from(elements).filter((element): element is HTMLImageElement => {\r\n      return element instanceof HTMLImageElement && this.isValidImage(element);\r\n    });\r\n  }\r\n\r\n  private isValidImage(image: HTMLImageElement): boolean {\r\n    // Check if image is visible and has dimensions\r\n    if (!image.isConnected || image.offsetWidth === 0 || image.offsetHeight === 0) {\r\n      return false;\r\n    }\r\n\r\n    // Check if image has loaded\r\n    if (!image.complete || image.naturalWidth === 0) {\r\n      return false;\r\n    }\r\n\r\n    // Check if image is not hidden\r\n    const computedStyle = window.getComputedStyle(image);\r\n    if (computedStyle.display === 'none' || computedStyle.visibility === 'hidden') {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private addDetectedImage(image: HTMLImageElement): void {\r\n    if (this.detectedImages.has(image)) {\r\n      return;\r\n    }\r\n\r\n    this.detectedImages.add(image);\r\n    this.attachImageListeners(image);\r\n    \r\n    // Observe image for size changes\r\n    if (this.resizeObserver) {\r\n      this.resizeObserver.observe(image);\r\n    }\r\n\r\n    this.emit('imageDetected', image);\r\n\r\n    if (this.config.debug) {\r\n      console.log('[ImageDetector] Image detected:', image);\r\n    }\r\n  }\r\n\r\n  private removeDetectedImage(image: HTMLImageElement): void {\r\n    if (!this.detectedImages.has(image)) {\r\n      return;\r\n    }\r\n\r\n    this.detectedImages.delete(image);\r\n    this.detachImageListeners(image);\r\n    \r\n    // Stop observing image\r\n    if (this.resizeObserver) {\r\n      this.resizeObserver.unobserve(image);\r\n    }\r\n\r\n    this.emit('imageRemoved', image);\r\n\r\n    if (this.config.debug) {\r\n      console.log('[ImageDetector] Image removed:', image);\r\n    }\r\n  }\r\n\r\n  private attachImageListeners(image: HTMLImageElement): void {\r\n    // Add load listener for images that might still be loading\r\n    const handleLoad = () => {\r\n      if (this.isValidImage(image)) {\r\n        this.emit('imageUpdated', image);\r\n      }\r\n    };\r\n\r\n    const handleError = () => {\r\n      this.removeDetectedImage(image);\r\n    };\r\n\r\n    image.addEventListener('load', handleLoad);\r\n    image.addEventListener('error', handleError);\r\n\r\n    // Store listeners for cleanup\r\n    (image as any).__dinoListeners = { handleLoad, handleError };\r\n  }\r\n\r\n  private detachImageListeners(image: HTMLImageElement): void {\r\n    const listeners = (image as any).__dinoListeners;\r\n    if (listeners) {\r\n      image.removeEventListener('load', listeners.handleLoad);\r\n      image.removeEventListener('error', listeners.handleError);\r\n      delete (image as any).__dinoListeners;\r\n    }\r\n  }\r\n\r\n  private handleMutation(mutations: MutationRecord[]): void {\r\n    let hasChanges = false;\r\n\r\n    for (const mutation of mutations) {\r\n      if (mutation.type === 'childList') {\r\n        // Handle added nodes\r\n        for (const node of Array.from(mutation.addedNodes)) {\r\n          if (node.nodeType === Node.ELEMENT_NODE) {\r\n            const element = node as Element;\r\n            \r\n            // Check if the added node is an image\r\n            if (element instanceof HTMLImageElement && element.classList.contains(this.config.className)) {\r\n              if (this.isValidImage(element)) {\r\n                this.addDetectedImage(element);\r\n                hasChanges = true;\r\n              }\r\n            }\r\n            \r\n            // Check for images within the added node\r\n            const images = element.querySelectorAll(`img.${this.config.className}`);\r\n            for (const img of Array.from(images)) {\r\n              if (img instanceof HTMLImageElement && this.isValidImage(img)) {\r\n                this.addDetectedImage(img);\r\n                hasChanges = true;\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        // Handle removed nodes\r\n        for (const node of Array.from(mutation.removedNodes)) {\r\n          if (node.nodeType === Node.ELEMENT_NODE) {\r\n            const element = node as Element;\r\n            \r\n            // Check if the removed node is a detected image\r\n            if (element instanceof HTMLImageElement && this.detectedImages.has(element)) {\r\n              this.removeDetectedImage(element);\r\n              hasChanges = true;\r\n            }\r\n            \r\n            // Check for detected images within the removed node\r\n            for (const image of Array.from(this.detectedImages)) {\r\n              if (!image.isConnected || element.contains(image)) {\r\n                this.removeDetectedImage(image);\r\n                hasChanges = true;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } else if (mutation.type === 'attributes') {\r\n        const target = mutation.target as Element;\r\n        \r\n        if (target instanceof HTMLImageElement) {\r\n          const hadClass = this.detectedImages.has(target);\r\n          const hasClass = target.classList.contains(this.config.className);\r\n          \r\n          if (hasClass && !hadClass && this.isValidImage(target)) {\r\n            this.addDetectedImage(target);\r\n            hasChanges = true;\r\n          } else if (!hasClass && hadClass) {\r\n            this.removeDetectedImage(target);\r\n            hasChanges = true;\r\n          } else if (hasClass && hadClass) {\r\n            // Image attributes changed, emit update\r\n            this.emit('imageUpdated', target);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (hasChanges && this.config.debug) {\r\n      console.log(`[ImageDetector] Mutation detected, ${this.detectedImages.size} images tracked`);\r\n    }\r\n  }\r\n\r\n  private handleScroll(): void {\r\n    if (this.scrollDebounceTimer) {\r\n      clearTimeout(this.scrollDebounceTimer);\r\n    }\r\n\r\n    this.scrollDebounceTimer = window.setTimeout(() => {\r\n      // Update all detected images as their positions may have changed\r\n      for (const image of this.detectedImages) {\r\n        this.emit('imageUpdated', image);\r\n      }\r\n      \r\n      if (this.config.debug) {\r\n        console.log('[ImageDetector] Scroll update processed');\r\n      }\r\n    }, this.config.debounceMs);\r\n  }\r\n\r\n  private handleResize(): void {\r\n    if (this.resizeDebounceTimer) {\r\n      clearTimeout(this.resizeDebounceTimer);\r\n    }\r\n\r\n    this.resizeDebounceTimer = window.setTimeout(() => {\r\n      // Update all detected images as their positions may have changed\r\n      for (const image of this.detectedImages) {\r\n        this.emit('imageUpdated', image);\r\n      }\r\n      \r\n      if (this.config.debug) {\r\n        console.log('[ImageDetector] Resize update processed');\r\n      }\r\n    }, this.config.debounceMs);\r\n  }\r\n\r\n  private emit<K extends keyof ImageDetectorEvents>(\r\n    event: K,\r\n    ...args: Parameters<ImageDetectorEvents[K]>\r\n  ): void {\r\n    const listeners = this.eventListeners.get(event);\r\n    if (listeners) {\r\n      for (const listener of listeners) {\r\n        try {\r\n          (listener as any)(...args);\r\n        } catch (error) {\r\n          console.error(`[ImageDetector] Error in ${event} listener:`, error);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private cleanup(): void {\r\n    // Clear timers\r\n    if (this.scrollDebounceTimer) {\r\n      clearTimeout(this.scrollDebounceTimer);\r\n      this.scrollDebounceTimer = null;\r\n    }\r\n\r\n    if (this.resizeDebounceTimer) {\r\n      clearTimeout(this.resizeDebounceTimer);\r\n      this.resizeDebounceTimer = null;\r\n    }\r\n\r\n    // Disconnect observers\r\n    if (this.observer) {\r\n      this.observer.disconnect();\r\n      this.observer = null;\r\n    }\r\n\r\n    if (this.resizeObserver) {\r\n      this.resizeObserver.disconnect();\r\n      this.resizeObserver = null;\r\n    }\r\n\r\n    // Remove event listeners\r\n    window.removeEventListener('scroll', this.handleScroll);\r\n    window.removeEventListener('resize', this.handleResize);\r\n\r\n    // Clean up image listeners\r\n    for (const image of this.detectedImages) {\r\n      this.detachImageListeners(image);\r\n    }\r\n\r\n    // Clear detected images\r\n    this.detectedImages.clear();\r\n\r\n    // Clear event listeners\r\n    this.eventListeners.clear();\r\n  }\r\n\r\n  public destroy(): void {\r\n    this.stopDetection();\r\n  }\r\n}","import { DinoOverlayConfig } from '../types/config';\r\n\r\nexport interface ResponsiveBreakpoints {\r\n  mobile: number;\r\n  tablet: number;\r\n  desktop: number;\r\n}\r\n\r\nexport interface ViewportInfo {\r\n  width: number;\r\n  height: number;\r\n  isMobile: boolean;\r\n  isTablet: boolean;\r\n  isDesktop: boolean;\r\n  orientation: 'portrait' | 'landscape';\r\n  devicePixelRatio: number;\r\n  isTouchDevice: boolean;\r\n}\r\n\r\nexport interface ResponsiveManagerEvents {\r\n  breakpointChanged: (viewport: ViewportInfo, previousViewport: ViewportInfo) => void;\r\n  orientationChanged: (orientation: 'portrait' | 'landscape') => void;\r\n  viewportResized: (viewport: ViewportInfo) => void;\r\n}\r\n\r\nexport class ResponsiveManager {\r\n  private breakpoints: ResponsiveBreakpoints;\r\n  private currentViewport: ViewportInfo;\r\n  private previousViewport: ViewportInfo;\r\n  private eventListeners: Map<string, Function[]> = new Map();\r\n  private resizeObserver: ResizeObserver | null = null;\r\n  private mediaQueries: Map<string, MediaQueryList> = new Map();\r\n  private isDestroyed: boolean = false;\r\n  private config: Required<DinoOverlayConfig>;\r\n\r\n  constructor(config: Required<DinoOverlayConfig>) {\r\n    this.config = config;\r\n    this.breakpoints = {\r\n      mobile: 768,\r\n      tablet: 1024,\r\n      desktop: 1200\r\n    };\r\n\r\n    // Initialize viewport info\r\n    this.currentViewport = this.calculateViewportInfo();\r\n    this.previousViewport = { ...this.currentViewport };\r\n\r\n    // Bind methods\r\n    this.handleResize = this.handleResize.bind(this);\r\n    this.handleOrientationChange = this.handleOrientationChange.bind(this);\r\n    this.handleMediaQueryChange = this.handleMediaQueryChange.bind(this);\r\n  }\r\n\r\n  public initialize(): void {\r\n    if (this.isDestroyed) {\r\n      throw new Error('ResponsiveManager has been destroyed');\r\n    }\r\n\r\n    this.setupEventListeners();\r\n    this.setupMediaQueries();\r\n    this.setupResizeObserver();\r\n\r\n    if (this.config.debug) {\r\n      console.log('[ResponsiveManager] Initialized with viewport:', this.currentViewport);\r\n    }\r\n  }\r\n\r\n  public destroy(): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    this.isDestroyed = true;\r\n\r\n    // Remove event listeners\r\n    window.removeEventListener('resize', this.handleResize);\r\n    window.removeEventListener('orientationchange', this.handleOrientationChange);\r\n\r\n    // Disconnect resize observer\r\n    if (this.resizeObserver) {\r\n      this.resizeObserver.disconnect();\r\n      this.resizeObserver = null;\r\n    }\r\n\r\n    // Remove media query listeners\r\n    for (const [key, mediaQuery] of this.mediaQueries) {\r\n      mediaQuery.removeEventListener('change', this.handleMediaQueryChange);\r\n    }\r\n    this.mediaQueries.clear();\r\n\r\n    // Clear event listeners\r\n    this.eventListeners.clear();\r\n\r\n    if (this.config.debug) {\r\n      console.log('[ResponsiveManager] Destroyed');\r\n    }\r\n  }\r\n\r\n  public getViewportInfo(): ViewportInfo {\r\n    return { ...this.currentViewport };\r\n  }\r\n\r\n  public isMobile(): boolean {\r\n    return this.currentViewport.isMobile;\r\n  }\r\n\r\n  public isTablet(): boolean {\r\n    return this.currentViewport.isTablet;\r\n  }\r\n\r\n  public isDesktop(): boolean {\r\n    return this.currentViewport.isDesktop;\r\n  }\r\n\r\n  public isTouchDevice(): boolean {\r\n    return this.currentViewport.isTouchDevice;\r\n  }\r\n\r\n  public getBreakpoints(): ResponsiveBreakpoints {\r\n    return { ...this.breakpoints };\r\n  }\r\n\r\n  public setBreakpoints(breakpoints: Partial<ResponsiveBreakpoints>): void {\r\n    this.breakpoints = { ...this.breakpoints, ...breakpoints };\r\n    this.updateViewportInfo();\r\n  }\r\n\r\n  public on<K extends keyof ResponsiveManagerEvents>(\r\n    event: K,\r\n    callback: ResponsiveManagerEvents[K]\r\n  ): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, []);\r\n    }\r\n    this.eventListeners.get(event)!.push(callback);\r\n  }\r\n\r\n  public off<K extends keyof ResponsiveManagerEvents>(\r\n    event: K,\r\n    callback: ResponsiveManagerEvents[K]\r\n  ): void {\r\n    const listeners = this.eventListeners.get(event);\r\n    if (listeners) {\r\n      const index = listeners.indexOf(callback);\r\n      if (index > -1) {\r\n        listeners.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  public getOptimalSidebarWidth(): number {\r\n    if (this.currentViewport.isMobile) {\r\n      return Math.min(this.currentViewport.width * 0.9, 400);\r\n    } else if (this.currentViewport.isTablet) {\r\n      return Math.min(this.currentViewport.width * 0.6, 480);\r\n    } else {\r\n      return 320;\r\n    }\r\n  }\r\n\r\n  public getOptimalChatBarPosition(): { bottom: number; right: number; left?: number } {\r\n    const padding = this.currentViewport.isMobile ? 12 : 20;\r\n    \r\n    if (this.currentViewport.isMobile) {\r\n      // Center chat bar on mobile\r\n      return {\r\n        bottom: padding,\r\n        right: padding,\r\n        left: padding\r\n      };\r\n    } else {\r\n      // Bottom-right on larger screens\r\n      return {\r\n        bottom: padding,\r\n        right: padding\r\n      };\r\n    }\r\n  }\r\n\r\n  public shouldUseMobileLayout(): boolean {\r\n    return this.currentViewport.isMobile || \r\n           (this.currentViewport.isTablet && this.currentViewport.orientation === 'portrait');\r\n  }\r\n\r\n  public getTouchTargetSize(): number {\r\n    // Minimum 44px touch target as per accessibility guidelines\r\n    return this.currentViewport.isTouchDevice ? 44 : 32;\r\n  }\r\n\r\n  private calculateViewportInfo(): ViewportInfo {\r\n    const width = window.innerWidth;\r\n    const height = window.innerHeight;\r\n    const isMobile = width < this.breakpoints.mobile;\r\n    const isTablet = width >= this.breakpoints.mobile && width < this.breakpoints.desktop;\r\n    const isDesktop = width >= this.breakpoints.desktop;\r\n    const orientation = width > height ? 'landscape' : 'portrait';\r\n    const devicePixelRatio = window.devicePixelRatio || 1;\r\n    const isTouchDevice = this.detectTouchDevice();\r\n\r\n    return {\r\n      width,\r\n      height,\r\n      isMobile,\r\n      isTablet,\r\n      isDesktop,\r\n      orientation,\r\n      devicePixelRatio,\r\n      isTouchDevice\r\n    };\r\n  }\r\n\r\n  private detectTouchDevice(): boolean {\r\n    return (\r\n      'ontouchstart' in window ||\r\n      navigator.maxTouchPoints > 0 ||\r\n      (navigator as any).msMaxTouchPoints > 0\r\n    );\r\n  }\r\n\r\n  private updateViewportInfo(): void {\r\n    this.previousViewport = { ...this.currentViewport };\r\n    this.currentViewport = this.calculateViewportInfo();\r\n\r\n    // Check for breakpoint changes\r\n    if (this.hasBreakpointChanged()) {\r\n      this.emit('breakpointChanged', this.currentViewport, this.previousViewport);\r\n    }\r\n\r\n    // Check for orientation changes\r\n    if (this.previousViewport.orientation !== this.currentViewport.orientation) {\r\n      this.emit('orientationChanged', this.currentViewport.orientation);\r\n    }\r\n\r\n    // Always emit viewport resize\r\n    this.emit('viewportResized', this.currentViewport);\r\n\r\n    if (this.config.debug) {\r\n      console.log('[ResponsiveManager] Viewport updated:', this.currentViewport);\r\n    }\r\n  }\r\n\r\n  private hasBreakpointChanged(): boolean {\r\n    return (\r\n      this.previousViewport.isMobile !== this.currentViewport.isMobile ||\r\n      this.previousViewport.isTablet !== this.currentViewport.isTablet ||\r\n      this.previousViewport.isDesktop !== this.currentViewport.isDesktop\r\n    );\r\n  }\r\n\r\n  private setupEventListeners(): void {\r\n    window.addEventListener('resize', this.handleResize, { passive: true });\r\n    window.addEventListener('orientationchange', this.handleOrientationChange, { passive: true });\r\n  }\r\n\r\n  private setupMediaQueries(): void {\r\n    const queries = {\r\n      mobile: `(max-width: ${this.breakpoints.mobile - 1}px)`,\r\n      tablet: `(min-width: ${this.breakpoints.mobile}px) and (max-width: ${this.breakpoints.desktop - 1}px)`,\r\n      desktop: `(min-width: ${this.breakpoints.desktop}px)`,\r\n      portrait: '(orientation: portrait)',\r\n      landscape: '(orientation: landscape)',\r\n      touch: '(pointer: coarse)',\r\n      hover: '(hover: hover)'\r\n    };\r\n\r\n    for (const [key, query] of Object.entries(queries)) {\r\n      const mediaQuery = window.matchMedia(query);\r\n      mediaQuery.addEventListener('change', this.handleMediaQueryChange);\r\n      this.mediaQueries.set(key, mediaQuery);\r\n    }\r\n  }\r\n\r\n  private setupResizeObserver(): void {\r\n    if (typeof ResizeObserver !== 'undefined') {\r\n      this.resizeObserver = new ResizeObserver(() => {\r\n        this.handleResize();\r\n      });\r\n\r\n      // Observe the document body for size changes\r\n      this.resizeObserver.observe(document.body);\r\n    }\r\n  }\r\n\r\n  private handleResize(): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    // Debounce resize events\r\n    clearTimeout((this as any).resizeTimeout);\r\n    (this as any).resizeTimeout = setTimeout(() => {\r\n      this.updateViewportInfo();\r\n    }, 16); // ~60fps\r\n  }\r\n\r\n  private handleOrientationChange(): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    // Delay to allow viewport to update after orientation change\r\n    setTimeout(() => {\r\n      this.updateViewportInfo();\r\n    }, 100);\r\n  }\r\n\r\n  private handleMediaQueryChange(): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    this.updateViewportInfo();\r\n  }\r\n\r\n  private emit<K extends keyof ResponsiveManagerEvents>(\r\n    event: K,\r\n    ...args: Parameters<ResponsiveManagerEvents[K]>\r\n  ): void {\r\n    const listeners = this.eventListeners.get(event);\r\n    if (listeners) {\r\n      for (const listener of listeners) {\r\n        try {\r\n          (listener as any)(...args);\r\n        } catch (error) {\r\n          console.error(`[ResponsiveManager] Error in ${event} listener:`, error);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}","export type ThemeMode = 'light' | 'dark' | 'auto';\r\n\r\nexport interface GlassmorphicColors {\r\n  background: string;\r\n  backdropBlur: string;\r\n  border: string;\r\n  shadow: string;\r\n  text: string;\r\n  textSecondary: string;\r\n  accent: string;\r\n  accentHover: string;\r\n  success: string;\r\n  warning: string;\r\n  error: string;\r\n}\r\n\r\nexport interface ThemeConfig {\r\n  mode: ThemeMode;\r\n  glassmorphism: GlassmorphicColors;\r\n  colors: {\r\n    primary: string;\r\n    secondary: string;\r\n    accent: string;\r\n    text: string;\r\n    textSecondary: string;\r\n    background: string;\r\n    surface: string;\r\n    border: string;\r\n  };\r\n  animations: {\r\n    duration: {\r\n      fast: string;\r\n      normal: string;\r\n      slow: string;\r\n    };\r\n    easing: {\r\n      ease: string;\r\n      easeIn: string;\r\n      easeOut: string;\r\n      easeInOut: string;\r\n    };\r\n  };\r\n}\r\n\r\nexport interface ThemeDetectionResult {\r\n  detectedTheme: 'light' | 'dark';\r\n  confidence: number;\r\n  method: 'prefers-color-scheme' | 'background-color' | 'computed-style' | 'fallback';\r\n  details?: {\r\n    backgroundColor?: string;\r\n    textColor?: string;\r\n    computedBrightness?: number;\r\n  };\r\n}\r\n\r\nexport interface ThemeManagerEvents {\r\n  themeChanged: (theme: ThemeConfig, previousTheme: ThemeConfig) => void;\r\n  modeChanged: (mode: ThemeMode, previousMode: ThemeMode) => void;\r\n  detectionCompleted: (result: ThemeDetectionResult) => void;\r\n}\r\n\r\n// Light theme configuration\r\nexport const LIGHT_THEME: ThemeConfig = {\r\n  mode: 'light',\r\n  glassmorphism: {\r\n    background: 'rgba(255, 255, 255, 0.25)',\r\n    backdropBlur: 'blur(16px)',\r\n    border: 'rgba(255, 255, 255, 0.3)',\r\n    shadow: 'rgba(0, 0, 0, 0.1)',\r\n    text: 'rgba(0, 0, 0, 0.87)',\r\n    textSecondary: 'rgba(0, 0, 0, 0.6)',\r\n    accent: 'rgba(59, 130, 246, 0.8)',\r\n    accentHover: 'rgba(59, 130, 246, 0.9)',\r\n    success: 'rgba(34, 197, 94, 0.8)',\r\n    warning: 'rgba(251, 191, 36, 0.8)',\r\n    error: 'rgba(239, 68, 68, 0.8)',\r\n  },\r\n  colors: {\r\n    primary: '#3b82f6',\r\n    secondary: '#6b7280',\r\n    accent: '#8b5cf6',\r\n    text: '#111827',\r\n    textSecondary: '#6b7280',\r\n    background: '#ffffff',\r\n    surface: '#f9fafb',\r\n    border: '#e5e7eb',\r\n  },\r\n  animations: {\r\n    duration: {\r\n      fast: '150ms',\r\n      normal: '300ms',\r\n      slow: '500ms',\r\n    },\r\n    easing: {\r\n      ease: 'cubic-bezier(0.4, 0, 0.2, 1)',\r\n      easeIn: 'cubic-bezier(0.4, 0, 1, 1)',\r\n      easeOut: 'cubic-bezier(0, 0, 0.2, 1)',\r\n      easeInOut: 'cubic-bezier(0.4, 0, 0.2, 1)',\r\n    },\r\n  },\r\n};\r\n\r\n// Dark theme configuration\r\nexport const DARK_THEME: ThemeConfig = {\r\n  mode: 'dark',\r\n  glassmorphism: {\r\n    background: 'rgba(17, 24, 39, 0.25)',\r\n    backdropBlur: 'blur(16px)',\r\n    border: 'rgba(75, 85, 99, 0.3)',\r\n    shadow: 'rgba(0, 0, 0, 0.3)',\r\n    text: 'rgba(255, 255, 255, 0.87)',\r\n    textSecondary: 'rgba(255, 255, 255, 0.6)',\r\n    accent: 'rgba(96, 165, 250, 0.8)',\r\n    accentHover: 'rgba(96, 165, 250, 0.9)',\r\n    success: 'rgba(52, 211, 153, 0.8)',\r\n    warning: 'rgba(251, 191, 36, 0.8)',\r\n    error: 'rgba(248, 113, 113, 0.8)',\r\n  },\r\n  colors: {\r\n    primary: '#60a5fa',\r\n    secondary: '#9ca3af',\r\n    accent: '#a78bfa',\r\n    text: '#f9fafb',\r\n    textSecondary: '#d1d5db',\r\n    background: '#111827',\r\n    surface: '#1f2937',\r\n    border: '#374151',\r\n  },\r\n  animations: {\r\n    duration: {\r\n      fast: '150ms',\r\n      normal: '300ms',\r\n      slow: '500ms',\r\n    },\r\n    easing: {\r\n      ease: 'cubic-bezier(0.4, 0, 0.2, 1)',\r\n      easeIn: 'cubic-bezier(0.4, 0, 1, 1)',\r\n      easeOut: 'cubic-bezier(0, 0, 0.2, 1)',\r\n      easeInOut: 'cubic-bezier(0.4, 0, 0.2, 1)',\r\n    },\r\n  },\r\n};\r\n\r\nexport const DEFAULT_THEME = LIGHT_THEME;","import { \r\n  ThemeConfig, \r\n  ThemeMode, \r\n  ThemeDetectionResult, \r\n  ThemeManagerEvents,\r\n  LIGHT_THEME,\r\n  DARK_THEME,\r\n  DEFAULT_THEME\r\n} from '../types/theme';\r\nimport { DinoOverlayConfig } from '../types/config';\r\n\r\nexport class ThemeManager {\r\n  private currentTheme: ThemeConfig;\r\n  private previousTheme: ThemeConfig;\r\n  private mode: ThemeMode;\r\n  private shadowRoot: ShadowRoot;\r\n  private config: Required<DinoOverlayConfig>;\r\n  private eventListeners: Map<string, Function[]> = new Map();\r\n  private mediaQueryList: MediaQueryList | null = null;\r\n  private hostObserver: MutationObserver | null = null;\r\n  private isDestroyed: boolean = false;\r\n  private cssVariablesStyleElement: HTMLStyleElement | null = null;\r\n\r\n  constructor(shadowRoot: ShadowRoot, config: Required<DinoOverlayConfig>) {\r\n    this.shadowRoot = shadowRoot;\r\n    this.config = config;\r\n    this.mode = config.theme;\r\n    this.currentTheme = DEFAULT_THEME;\r\n    this.previousTheme = DEFAULT_THEME;\r\n\r\n    // Bind methods to preserve context\r\n    this.handleMediaQueryChange = this.handleMediaQueryChange.bind(this);\r\n    this.handleHostStyleChange = this.handleHostStyleChange.bind(this);\r\n  }\r\n\r\n  public initialize(): void {\r\n    if (this.isDestroyed) {\r\n      throw new Error('ThemeManager has been destroyed');\r\n    }\r\n\r\n    // Detect and apply initial theme\r\n    this.detectAndApplyTheme();\r\n\r\n    // Setup theme detection listeners\r\n    this.setupThemeDetection();\r\n\r\n    // Apply CSS custom properties\r\n    this.applyCSSCustomProperties();\r\n\r\n    if (this.config.debug) {\r\n      console.log('[ThemeManager] Initialized with theme:', this.currentTheme.mode);\r\n    }\r\n  }\r\n\r\n  public destroy(): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    this.isDestroyed = true;\r\n\r\n    // Remove media query listener\r\n    if (this.mediaQueryList) {\r\n      this.mediaQueryList.removeEventListener('change', this.handleMediaQueryChange);\r\n      this.mediaQueryList = null;\r\n    }\r\n\r\n    // Disconnect host observer\r\n    if (this.hostObserver) {\r\n      this.hostObserver.disconnect();\r\n      this.hostObserver = null;\r\n    }\r\n\r\n    // Remove CSS variables style element\r\n    if (this.cssVariablesStyleElement && this.cssVariablesStyleElement.parentNode) {\r\n      this.cssVariablesStyleElement.parentNode.removeChild(this.cssVariablesStyleElement);\r\n      this.cssVariablesStyleElement = null;\r\n    }\r\n\r\n    // Clear event listeners\r\n    this.eventListeners.clear();\r\n\r\n    if (this.config.debug) {\r\n      console.log('[ThemeManager] Destroyed');\r\n    }\r\n  }\r\n\r\n  public getCurrentTheme(): ThemeConfig {\r\n    return { ...this.currentTheme };\r\n  }\r\n\r\n  public getMode(): ThemeMode {\r\n    return this.mode;\r\n  }\r\n\r\n  public setMode(mode: ThemeMode): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    const previousMode = this.mode;\r\n    this.mode = mode;\r\n\r\n    this.detectAndApplyTheme();\r\n    this.emit('modeChanged', mode, previousMode);\r\n\r\n    if (this.config.debug) {\r\n      console.log('[ThemeManager] Mode changed:', { previousMode, newMode: mode });\r\n    }\r\n  }\r\n\r\n  public detectHostTheme(): ThemeDetectionResult {\r\n    // Method 1: Check prefers-color-scheme\r\n    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {\r\n      return {\r\n        detectedTheme: 'dark',\r\n        confidence: 0.9,\r\n        method: 'prefers-color-scheme'\r\n      };\r\n    }\r\n\r\n    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {\r\n      return {\r\n        detectedTheme: 'light',\r\n        confidence: 0.9,\r\n        method: 'prefers-color-scheme'\r\n      };\r\n    }\r\n\r\n    // Method 2: Analyze host page background color\r\n    const hostBackgroundResult = this.analyzeHostBackground();\r\n    if (hostBackgroundResult) {\r\n      return hostBackgroundResult;\r\n    }\r\n\r\n    // Method 3: Analyze computed styles of common elements\r\n    const computedStyleResult = this.analyzeComputedStyles();\r\n    if (computedStyleResult) {\r\n      return computedStyleResult;\r\n    }\r\n\r\n    // Fallback to light theme\r\n    return {\r\n      detectedTheme: 'light',\r\n      confidence: 0.1,\r\n      method: 'fallback'\r\n    };\r\n  }\r\n\r\n  public applyTheme(theme: ThemeConfig): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    this.previousTheme = { ...this.currentTheme };\r\n    this.currentTheme = { ...theme };\r\n\r\n    // Update CSS custom properties\r\n    this.applyCSSCustomProperties();\r\n\r\n    // Emit theme change event\r\n    this.emit('themeChanged', this.currentTheme, this.previousTheme);\r\n\r\n    if (this.config.debug) {\r\n      console.log('[ThemeManager] Theme applied:', theme.mode);\r\n    }\r\n  }\r\n\r\n  public getCSSCustomProperties(): Record<string, string> {\r\n    const theme = this.currentTheme;\r\n    \r\n    return {\r\n      // Glassmorphic properties\r\n      '--dino-glass-bg': theme.glassmorphism.background,\r\n      '--dino-glass-backdrop': theme.glassmorphism.backdropBlur,\r\n      '--dino-glass-border': theme.glassmorphism.border,\r\n      '--dino-glass-shadow': theme.glassmorphism.shadow,\r\n      '--dino-glass-text': theme.glassmorphism.text,\r\n      '--dino-glass-text-secondary': theme.glassmorphism.textSecondary,\r\n      '--dino-glass-accent': theme.glassmorphism.accent,\r\n      '--dino-glass-accent-hover': theme.glassmorphism.accentHover,\r\n      '--dino-glass-success': theme.glassmorphism.success,\r\n      '--dino-glass-warning': theme.glassmorphism.warning,\r\n      '--dino-glass-error': theme.glassmorphism.error,\r\n\r\n      // Color properties\r\n      '--dino-color-primary': theme.colors.primary,\r\n      '--dino-color-secondary': theme.colors.secondary,\r\n      '--dino-color-accent': theme.colors.accent,\r\n      '--dino-color-text': theme.colors.text,\r\n      '--dino-color-text-secondary': theme.colors.textSecondary,\r\n      '--dino-color-background': theme.colors.background,\r\n      '--dino-color-surface': theme.colors.surface,\r\n      '--dino-color-border': theme.colors.border,\r\n\r\n      // Animation properties\r\n      '--dino-duration-fast': theme.animations.duration.fast,\r\n      '--dino-duration-normal': theme.animations.duration.normal,\r\n      '--dino-duration-slow': theme.animations.duration.slow,\r\n      '--dino-easing-ease': theme.animations.easing.ease,\r\n      '--dino-easing-ease-in': theme.animations.easing.easeIn,\r\n      '--dino-easing-ease-out': theme.animations.easing.easeOut,\r\n      '--dino-easing-ease-in-out': theme.animations.easing.easeInOut,\r\n    };\r\n  }\r\n\r\n  public on<K extends keyof ThemeManagerEvents>(\r\n    event: K,\r\n    callback: ThemeManagerEvents[K]\r\n  ): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, []);\r\n    }\r\n    this.eventListeners.get(event)!.push(callback);\r\n  }\r\n\r\n  public off<K extends keyof ThemeManagerEvents>(\r\n    event: K,\r\n    callback: ThemeManagerEvents[K]\r\n  ): void {\r\n    const listeners = this.eventListeners.get(event);\r\n    if (listeners) {\r\n      const index = listeners.indexOf(callback);\r\n      if (index > -1) {\r\n        listeners.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  private detectAndApplyTheme(): void {\r\n    let themeToApply: ThemeConfig;\r\n\r\n    if (this.mode === 'auto') {\r\n      const detectionResult = this.detectHostTheme();\r\n      themeToApply = detectionResult.detectedTheme === 'dark' ? DARK_THEME : LIGHT_THEME;\r\n      \r\n      this.emit('detectionCompleted', detectionResult);\r\n      \r\n      if (this.config.debug) {\r\n        console.log('[ThemeManager] Auto-detected theme:', detectionResult);\r\n      }\r\n    } else {\r\n      themeToApply = this.mode === 'dark' ? DARK_THEME : LIGHT_THEME;\r\n    }\r\n\r\n    this.applyTheme(themeToApply);\r\n  }\r\n\r\n  private setupThemeDetection(): void {\r\n    if (this.mode === 'auto') {\r\n      // Listen for system theme changes\r\n      if (window.matchMedia) {\r\n        this.mediaQueryList = window.matchMedia('(prefers-color-scheme: dark)');\r\n        this.mediaQueryList.addEventListener('change', this.handleMediaQueryChange);\r\n      }\r\n\r\n      // Observe host page style changes\r\n      this.setupHostStyleObserver();\r\n    }\r\n  }\r\n\r\n  private setupHostStyleObserver(): void {\r\n    if (!document.body) {\r\n      // Wait for body to be available\r\n      setTimeout(() => this.setupHostStyleObserver(), 100);\r\n      return;\r\n    }\r\n\r\n    this.hostObserver = new MutationObserver(this.handleHostStyleChange);\r\n    \r\n    // Observe changes to style attributes and class names\r\n    this.hostObserver.observe(document.documentElement, {\r\n      attributes: true,\r\n      attributeFilter: ['style', 'class', 'data-theme', 'data-color-scheme']\r\n    });\r\n\r\n    this.hostObserver.observe(document.body, {\r\n      attributes: true,\r\n      attributeFilter: ['style', 'class', 'data-theme', 'data-color-scheme']\r\n    });\r\n  }\r\n\r\n  private handleMediaQueryChange(event: MediaQueryListEvent): void {\r\n    if (this.mode === 'auto') {\r\n      this.detectAndApplyTheme();\r\n    }\r\n  }\r\n\r\n  private handleHostStyleChange(): void {\r\n    if (this.mode === 'auto') {\r\n      // Debounce style change detection\r\n      setTimeout(() => {\r\n        this.detectAndApplyTheme();\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n  private analyzeHostBackground(): ThemeDetectionResult | null {\r\n    try {\r\n      const bodyStyles = window.getComputedStyle(document.body);\r\n      const htmlStyles = window.getComputedStyle(document.documentElement);\r\n      \r\n      const backgroundColor = bodyStyles.backgroundColor || htmlStyles.backgroundColor;\r\n      \r\n      if (backgroundColor && backgroundColor !== 'rgba(0, 0, 0, 0)' && backgroundColor !== 'transparent') {\r\n        const brightness = this.calculateColorBrightness(backgroundColor);\r\n        \r\n        return {\r\n          detectedTheme: brightness > 128 ? 'light' : 'dark',\r\n          confidence: 0.7,\r\n          method: 'background-color',\r\n          details: {\r\n            backgroundColor,\r\n            computedBrightness: brightness\r\n          }\r\n        };\r\n      }\r\n    } catch (error) {\r\n      if (this.config.debug) {\r\n        console.warn('[ThemeManager] Failed to analyze host background:', error);\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  private analyzeComputedStyles(): ThemeDetectionResult | null {\r\n    try {\r\n      // Check common elements for theme indicators\r\n      const selectors = ['body', 'main', '.content', '#content', '.container'];\r\n      \r\n      for (const selector of selectors) {\r\n        const element = document.querySelector(selector);\r\n        if (element) {\r\n          const styles = window.getComputedStyle(element);\r\n          const textColor = styles.color;\r\n          const backgroundColor = styles.backgroundColor;\r\n          \r\n          if (textColor && textColor !== 'rgba(0, 0, 0, 0)') {\r\n            const textBrightness = this.calculateColorBrightness(textColor);\r\n            \r\n            return {\r\n              detectedTheme: textBrightness > 128 ? 'dark' : 'light',\r\n              confidence: 0.6,\r\n              method: 'computed-style',\r\n              details: {\r\n                textColor,\r\n                backgroundColor,\r\n                computedBrightness: textBrightness\r\n              }\r\n            };\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      if (this.config.debug) {\r\n        console.warn('[ThemeManager] Failed to analyze computed styles:', error);\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  private calculateColorBrightness(color: string): number {\r\n    // Convert color to RGB values\r\n    const rgb = this.parseColor(color);\r\n    if (!rgb) return 128; // Default to medium brightness\r\n    \r\n    // Calculate perceived brightness using luminance formula\r\n    return (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;\r\n  }\r\n\r\n  private parseColor(color: string): { r: number; g: number; b: number } | null {\r\n    // Handle rgb() and rgba() formats\r\n    const rgbMatch = color.match(/rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)/);\r\n    if (rgbMatch) {\r\n      return {\r\n        r: parseInt(rgbMatch[1], 10),\r\n        g: parseInt(rgbMatch[2], 10),\r\n        b: parseInt(rgbMatch[3], 10)\r\n      };\r\n    }\r\n\r\n    // Handle hex formats\r\n    const hexMatch = color.match(/^#([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i);\r\n    if (hexMatch) {\r\n      return {\r\n        r: parseInt(hexMatch[1], 16),\r\n        g: parseInt(hexMatch[2], 16),\r\n        b: parseInt(hexMatch[3], 16)\r\n      };\r\n    }\r\n\r\n    // Handle short hex format\r\n    const shortHexMatch = color.match(/^#([a-f\\d])([a-f\\d])([a-f\\d])$/i);\r\n    if (shortHexMatch) {\r\n      return {\r\n        r: parseInt(shortHexMatch[1] + shortHexMatch[1], 16),\r\n        g: parseInt(shortHexMatch[2] + shortHexMatch[2], 16),\r\n        b: parseInt(shortHexMatch[3] + shortHexMatch[3], 16)\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  private applyCSSCustomProperties(): void {\r\n    const properties = this.getCSSCustomProperties();\r\n    \r\n    // Remove existing style element\r\n    if (this.cssVariablesStyleElement && this.cssVariablesStyleElement.parentNode) {\r\n      this.cssVariablesStyleElement.parentNode.removeChild(this.cssVariablesStyleElement);\r\n    }\r\n\r\n    // Create new style element with CSS custom properties\r\n    this.cssVariablesStyleElement = document.createElement('style');\r\n    this.cssVariablesStyleElement.textContent = `\r\n      :host {\r\n        ${Object.entries(properties)\r\n          .map(([key, value]) => `${key}: ${value};`)\r\n          .join('\\n        ')}\r\n      }\r\n    `;\r\n\r\n    // Append to shadow root\r\n    this.shadowRoot.appendChild(this.cssVariablesStyleElement);\r\n  }\r\n\r\n  private emit<K extends keyof ThemeManagerEvents>(\r\n    event: K,\r\n    ...args: Parameters<ThemeManagerEvents[K]>\r\n  ): void {\r\n    const listeners = this.eventListeners.get(event);\r\n    if (listeners) {\r\n      for (const listener of listeners) {\r\n        try {\r\n          (listener as any)(...args);\r\n        } catch (error) {\r\n          console.error(`[ThemeManager] Error in ${event} listener:`, error);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}","import { AnimationConfig } from '../types/overlay';\r\n\r\nexport interface AnimationOptions extends AnimationConfig {\r\n  fill?: FillMode;\r\n  iterations?: number;\r\n  direction?: PlaybackDirection;\r\n}\r\n\r\nexport interface AnimationKeyframe {\r\n  [property: string]: string | number;\r\n}\r\n\r\nexport interface TransitionConfig {\r\n  property: string;\r\n  duration: number;\r\n  easing: string;\r\n  delay?: number;\r\n}\r\n\r\nexport interface AnimationCleanup {\r\n  cancel: () => void;\r\n  finish: () => void;\r\n  pause: () => void;\r\n  play: () => void;\r\n}\r\n\r\nexport class AnimationSystem {\r\n  private activeAnimations: Map<string, Animation> = new Map();\r\n  private animationCounter: number = 0;\r\n  private defaultEasing: string = 'cubic-bezier(0.4, 0, 0.2, 1)';\r\n\r\n  /**\r\n   * Create a slide-in animation from the specified direction\r\n   */\r\n  public slideIn(\r\n    element: HTMLElement,\r\n    direction: 'left' | 'right' | 'up' | 'down' = 'right',\r\n    options: Partial<AnimationOptions> = {}\r\n  ): AnimationCleanup {\r\n    const animationId = this.generateAnimationId('slide-in');\r\n    \r\n    const config: AnimationOptions = {\r\n      duration: 300,\r\n      easing: this.defaultEasing,\r\n      fill: 'forwards',\r\n      ...options\r\n    };\r\n\r\n    const transforms = this.getSlideTransforms(direction);\r\n    \r\n    const keyframes: AnimationKeyframe[] = [\r\n      { \r\n        transform: transforms.from,\r\n        opacity: '0'\r\n      },\r\n      { \r\n        transform: transforms.to,\r\n        opacity: '1'\r\n      }\r\n    ];\r\n\r\n    return this.createAnimation(element, keyframes, config, animationId);\r\n  }\r\n\r\n  /**\r\n   * Create a slide-out animation to the specified direction\r\n   */\r\n  public slideOut(\r\n    element: HTMLElement,\r\n    direction: 'left' | 'right' | 'up' | 'down' = 'right',\r\n    options: Partial<AnimationOptions> = {}\r\n  ): AnimationCleanup {\r\n    const animationId = this.generateAnimationId('slide-out');\r\n    \r\n    const config: AnimationOptions = {\r\n      duration: 300,\r\n      easing: this.defaultEasing,\r\n      fill: 'forwards',\r\n      ...options\r\n    };\r\n\r\n    const transforms = this.getSlideTransforms(direction);\r\n    \r\n    const keyframes: AnimationKeyframe[] = [\r\n      { \r\n        transform: transforms.to,\r\n        opacity: '1'\r\n      },\r\n      { \r\n        transform: transforms.from,\r\n        opacity: '0'\r\n      }\r\n    ];\r\n\r\n    return this.createAnimation(element, keyframes, config, animationId);\r\n  }\r\n\r\n  /**\r\n   * Create a fade-in animation\r\n   */\r\n  public fadeIn(\r\n    element: HTMLElement,\r\n    options: Partial<AnimationOptions> = {}\r\n  ): AnimationCleanup {\r\n    const animationId = this.generateAnimationId('fade-in');\r\n    \r\n    const config: AnimationOptions = {\r\n      duration: 200,\r\n      easing: this.defaultEasing,\r\n      fill: 'forwards',\r\n      ...options\r\n    };\r\n\r\n    const keyframes: AnimationKeyframe[] = [\r\n      { opacity: '0' },\r\n      { opacity: '1' }\r\n    ];\r\n\r\n    return this.createAnimation(element, keyframes, config, animationId);\r\n  }\r\n\r\n  /**\r\n   * Create a fade-out animation\r\n   */\r\n  public fadeOut(\r\n    element: HTMLElement,\r\n    options: Partial<AnimationOptions> = {}\r\n  ): AnimationCleanup {\r\n    const animationId = this.generateAnimationId('fade-out');\r\n    \r\n    const config: AnimationOptions = {\r\n      duration: 200,\r\n      easing: this.defaultEasing,\r\n      fill: 'forwards',\r\n      ...options\r\n    };\r\n\r\n    const keyframes: AnimationKeyframe[] = [\r\n      { opacity: '1' },\r\n      { opacity: '0' }\r\n    ];\r\n\r\n    return this.createAnimation(element, keyframes, config, animationId);\r\n  }\r\n\r\n  /**\r\n   * Create a scale animation\r\n   */\r\n  public scale(\r\n    element: HTMLElement,\r\n    fromScale: number = 0.8,\r\n    toScale: number = 1,\r\n    options: Partial<AnimationOptions> = {}\r\n  ): AnimationCleanup {\r\n    const animationId = this.generateAnimationId('scale');\r\n    \r\n    const config: AnimationOptions = {\r\n      duration: 200,\r\n      easing: this.defaultEasing,\r\n      fill: 'forwards',\r\n      ...options\r\n    };\r\n\r\n    const keyframes: AnimationKeyframe[] = [\r\n      { \r\n        transform: `scale(${fromScale})`,\r\n        opacity: '0'\r\n      },\r\n      { \r\n        transform: `scale(${toScale})`,\r\n        opacity: '1'\r\n      }\r\n    ];\r\n\r\n    return this.createAnimation(element, keyframes, config, animationId);\r\n  }\r\n\r\n  /**\r\n   * Create a glow animation for highlighting elements\r\n   */\r\n  public glow(\r\n    element: HTMLElement,\r\n    color: string = 'rgba(59, 130, 246, 0.5)',\r\n    options: Partial<AnimationOptions> = {}\r\n  ): AnimationCleanup {\r\n    const animationId = this.generateAnimationId('glow');\r\n    \r\n    const config: AnimationOptions = {\r\n      duration: 2000,\r\n      easing: 'ease-in-out',\r\n      iterations: Infinity,\r\n      direction: 'alternate',\r\n      ...options\r\n    };\r\n\r\n    const keyframes: AnimationKeyframe[] = [\r\n      { \r\n        boxShadow: `0 0 5px ${color}`,\r\n        borderColor: color.replace('0.5', '0.3')\r\n      },\r\n      { \r\n        boxShadow: `0 0 20px ${color}, 0 0 30px ${color}`,\r\n        borderColor: color.replace('0.5', '0.8')\r\n      }\r\n    ];\r\n\r\n    return this.createAnimation(element, keyframes, config, animationId);\r\n  }\r\n\r\n  /**\r\n   * Create a pulse animation\r\n   */\r\n  public pulse(\r\n    element: HTMLElement,\r\n    options: Partial<AnimationOptions> = {}\r\n  ): AnimationCleanup {\r\n    const animationId = this.generateAnimationId('pulse');\r\n    \r\n    const config: AnimationOptions = {\r\n      duration: 1000,\r\n      easing: 'ease-in-out',\r\n      iterations: Infinity,\r\n      direction: 'alternate',\r\n      ...options\r\n    };\r\n\r\n    const keyframes: AnimationKeyframe[] = [\r\n      { transform: 'scale(1)', opacity: '1' },\r\n      { transform: 'scale(1.05)', opacity: '0.8' }\r\n    ];\r\n\r\n    return this.createAnimation(element, keyframes, config, animationId);\r\n  }\r\n\r\n  /**\r\n   * Create a bounce animation\r\n   */\r\n  public bounce(\r\n    element: HTMLElement,\r\n    options: Partial<AnimationOptions> = {}\r\n  ): AnimationCleanup {\r\n    const animationId = this.generateAnimationId('bounce');\r\n    \r\n    const config: AnimationOptions = {\r\n      duration: 600,\r\n      easing: 'cubic-bezier(0.68, -0.55, 0.265, 1.55)',\r\n      fill: 'forwards',\r\n      ...options\r\n    };\r\n\r\n    const keyframes: AnimationKeyframe[] = [\r\n      { transform: 'scale(0.3)', opacity: '0' },\r\n      { transform: 'scale(1.05)', opacity: '0.8' },\r\n      { transform: 'scale(0.9)', opacity: '0.9' },\r\n      { transform: 'scale(1)', opacity: '1' }\r\n    ];\r\n\r\n    return this.createAnimation(element, keyframes, config, animationId);\r\n  }\r\n\r\n  /**\r\n   * Create a shake animation for error states\r\n   */\r\n  public shake(\r\n    element: HTMLElement,\r\n    options: Partial<AnimationOptions> = {}\r\n  ): AnimationCleanup {\r\n    const animationId = this.generateAnimationId('shake');\r\n    \r\n    const config: AnimationOptions = {\r\n      duration: 500,\r\n      easing: 'ease-in-out',\r\n      fill: 'forwards',\r\n      ...options\r\n    };\r\n\r\n    const keyframes: AnimationKeyframe[] = [\r\n      { transform: 'translateX(0)' },\r\n      { transform: 'translateX(-10px)' },\r\n      { transform: 'translateX(10px)' },\r\n      { transform: 'translateX(-10px)' },\r\n      { transform: 'translateX(10px)' },\r\n      { transform: 'translateX(-5px)' },\r\n      { transform: 'translateX(5px)' },\r\n      { transform: 'translateX(0)' }\r\n    ];\r\n\r\n    return this.createAnimation(element, keyframes, config, animationId);\r\n  }\r\n\r\n  /**\r\n   * Create a loading spinner animation\r\n   */\r\n  public spin(\r\n    element: HTMLElement,\r\n    options: Partial<AnimationOptions> = {}\r\n  ): AnimationCleanup {\r\n    const animationId = this.generateAnimationId('spin');\r\n    \r\n    const config: AnimationOptions = {\r\n      duration: 1000,\r\n      easing: 'linear',\r\n      iterations: Infinity,\r\n      ...options\r\n    };\r\n\r\n    const keyframes: AnimationKeyframe[] = [\r\n      { transform: 'rotate(0deg)' },\r\n      { transform: 'rotate(360deg)' }\r\n    ];\r\n\r\n    return this.createAnimation(element, keyframes, config, animationId);\r\n  }\r\n\r\n  /**\r\n   * Apply CSS transitions to an element\r\n   */\r\n  public applyTransition(\r\n    element: HTMLElement,\r\n    transitions: TransitionConfig[]\r\n  ): void {\r\n    const transitionStrings = transitions.map(config => {\r\n      const delay = config.delay ? ` ${config.delay}ms` : '';\r\n      return `${config.property} ${config.duration}ms ${config.easing}${delay}`;\r\n    });\r\n\r\n    element.style.transition = transitionStrings.join(', ');\r\n  }\r\n\r\n  /**\r\n   * Create hover animations for interactive elements\r\n   */\r\n  public setupHoverAnimation(\r\n    element: HTMLElement,\r\n    hoverStyles: Partial<CSSStyleDeclaration>,\r\n    options: {\r\n      duration?: number;\r\n      easing?: string;\r\n      scaleOnHover?: boolean;\r\n      glowOnHover?: boolean;\r\n      glowColor?: string;\r\n    } = {}\r\n  ): () => void {\r\n    const {\r\n      duration = 200,\r\n      easing = this.defaultEasing,\r\n      scaleOnHover = false,\r\n      glowOnHover = false,\r\n      glowColor = 'rgba(59, 130, 246, 0.3)'\r\n    } = options;\r\n\r\n    // Store original styles\r\n    const originalStyles: Partial<CSSStyleDeclaration> = {};\r\n    Object.keys(hoverStyles).forEach(key => {\r\n      const styleKey = key as keyof CSSStyleDeclaration;\r\n      originalStyles[styleKey] = element.style[styleKey] as any;\r\n    });\r\n\r\n    // Setup transitions\r\n    const transitionProperties = Object.keys(hoverStyles);\r\n    if (scaleOnHover) transitionProperties.push('transform');\r\n    if (glowOnHover) transitionProperties.push('box-shadow', 'border-color');\r\n\r\n    const transitions: TransitionConfig[] = transitionProperties.map(property => ({\r\n      property,\r\n      duration,\r\n      easing\r\n    }));\r\n\r\n    this.applyTransition(element, transitions);\r\n\r\n    // Mouse enter handler\r\n    const handleMouseEnter = () => {\r\n      Object.assign(element.style, hoverStyles);\r\n      \r\n      if (scaleOnHover) {\r\n        element.style.transform = (element.style.transform || '') + ' scale(1.05)';\r\n      }\r\n      \r\n      if (glowOnHover) {\r\n        element.style.boxShadow = `0 0 15px ${glowColor}`;\r\n        element.style.borderColor = glowColor;\r\n      }\r\n    };\r\n\r\n    // Mouse leave handler\r\n    const handleMouseLeave = () => {\r\n      Object.assign(element.style, originalStyles);\r\n      \r\n      if (scaleOnHover) {\r\n        element.style.transform = (element.style.transform || '').replace(' scale(1.05)', '');\r\n      }\r\n      \r\n      if (glowOnHover) {\r\n        element.style.boxShadow = originalStyles.boxShadow || '';\r\n        element.style.borderColor = originalStyles.borderColor || '';\r\n      }\r\n    };\r\n\r\n    element.addEventListener('mouseenter', handleMouseEnter);\r\n    element.addEventListener('mouseleave', handleMouseLeave);\r\n\r\n    // Return cleanup function\r\n    return () => {\r\n      element.removeEventListener('mouseenter', handleMouseEnter);\r\n      element.removeEventListener('mouseleave', handleMouseLeave);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create focus animations for interactive elements\r\n   */\r\n  public setupFocusAnimation(\r\n    element: HTMLElement,\r\n    focusStyles: Partial<CSSStyleDeclaration>,\r\n    options: {\r\n      duration?: number;\r\n      easing?: string;\r\n      glowOnFocus?: boolean;\r\n      glowColor?: string;\r\n    } = {}\r\n  ): () => void {\r\n    const {\r\n      duration = 200,\r\n      easing = this.defaultEasing,\r\n      glowOnFocus = true,\r\n      glowColor = 'rgba(59, 130, 246, 0.5)'\r\n    } = options;\r\n\r\n    // Store original styles\r\n    const originalStyles: Partial<CSSStyleDeclaration> = {};\r\n    Object.keys(focusStyles).forEach(key => {\r\n      const styleKey = key as keyof CSSStyleDeclaration;\r\n      originalStyles[styleKey] = element.style[styleKey] as any;\r\n    });\r\n\r\n    // Setup transitions\r\n    const transitionProperties = Object.keys(focusStyles);\r\n    if (glowOnFocus) transitionProperties.push('box-shadow', 'border-color');\r\n\r\n    const transitions: TransitionConfig[] = transitionProperties.map(property => ({\r\n      property,\r\n      duration,\r\n      easing\r\n    }));\r\n\r\n    this.applyTransition(element, transitions);\r\n\r\n    // Focus handler\r\n    const handleFocus = () => {\r\n      Object.assign(element.style, focusStyles);\r\n      \r\n      if (glowOnFocus) {\r\n        element.style.boxShadow = `0 0 0 3px ${glowColor}`;\r\n        element.style.borderColor = glowColor.replace('0.5', '0.8');\r\n      }\r\n    };\r\n\r\n    // Blur handler\r\n    const handleBlur = () => {\r\n      Object.assign(element.style, originalStyles);\r\n      \r\n      if (glowOnFocus) {\r\n        element.style.boxShadow = originalStyles.boxShadow || '';\r\n        element.style.borderColor = originalStyles.borderColor || '';\r\n      }\r\n    };\r\n\r\n    element.addEventListener('focus', handleFocus);\r\n    element.addEventListener('blur', handleBlur);\r\n\r\n    // Return cleanup function\r\n    return () => {\r\n      element.removeEventListener('focus', handleFocus);\r\n      element.removeEventListener('blur', handleBlur);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Cancel a specific animation by ID\r\n   */\r\n  public cancelAnimation(animationId: string): void {\r\n    const animation = this.activeAnimations.get(animationId);\r\n    if (animation) {\r\n      animation.cancel();\r\n      this.activeAnimations.delete(animationId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cancel all active animations\r\n   */\r\n  public cancelAllAnimations(): void {\r\n    this.activeAnimations.forEach(animation => {\r\n      animation.cancel();\r\n    });\r\n    this.activeAnimations.clear();\r\n  }\r\n\r\n  /**\r\n   * Get the number of active animations\r\n   */\r\n  public getActiveAnimationCount(): number {\r\n    return this.activeAnimations.size;\r\n  }\r\n\r\n  /**\r\n   * Check if an animation is currently running\r\n   */\r\n  public isAnimationActive(animationId: string): boolean {\r\n    return this.activeAnimations.has(animationId);\r\n  }\r\n\r\n  /**\r\n   * Create a custom animation with keyframes\r\n   */\r\n  public createCustomAnimation(\r\n    element: HTMLElement,\r\n    keyframes: AnimationKeyframe[],\r\n    options: Partial<AnimationOptions> = {}\r\n  ): AnimationCleanup {\r\n    const animationId = this.generateAnimationId('custom');\r\n    \r\n    const config: AnimationOptions = {\r\n      duration: 300,\r\n      easing: this.defaultEasing,\r\n      fill: 'forwards',\r\n      ...options\r\n    };\r\n\r\n    return this.createAnimation(element, keyframes, config, animationId);\r\n  }\r\n\r\n  /**\r\n   * Destroy the animation system and clean up all resources\r\n   */\r\n  public destroy(): void {\r\n    this.cancelAllAnimations();\r\n    this.animationCounter = 0;\r\n  }\r\n\r\n  // Private methods\r\n\r\n  private createAnimation(\r\n    element: HTMLElement,\r\n    keyframes: AnimationKeyframe[],\r\n    config: AnimationOptions,\r\n    animationId: string\r\n  ): AnimationCleanup {\r\n    try {\r\n      const animation = element.animate(keyframes, {\r\n        duration: config.duration,\r\n        easing: config.easing,\r\n        delay: config.delay || 0,\r\n        fill: config.fill || 'forwards',\r\n        iterations: config.iterations || 1,\r\n        direction: config.direction || 'normal'\r\n      });\r\n\r\n      this.activeAnimations.set(animationId, animation);\r\n\r\n      // Clean up when animation finishes\r\n      animation.addEventListener('finish', () => {\r\n        this.activeAnimations.delete(animationId);\r\n      });\r\n\r\n      animation.addEventListener('cancel', () => {\r\n        this.activeAnimations.delete(animationId);\r\n      });\r\n\r\n      return {\r\n        cancel: () => {\r\n          animation.cancel();\r\n          this.activeAnimations.delete(animationId);\r\n        },\r\n        finish: () => {\r\n          animation.finish();\r\n        },\r\n        pause: () => {\r\n          animation.pause();\r\n        },\r\n        play: () => {\r\n          animation.play();\r\n        }\r\n      };\r\n    } catch (error) {\r\n      // Fallback for environments without Web Animations API\r\n      console.warn('Web Animations API not supported, using CSS fallback');\r\n      return this.createCSSFallbackAnimation(element, keyframes, config);\r\n    }\r\n  }\r\n\r\n  private createCSSFallbackAnimation(\r\n    element: HTMLElement,\r\n    keyframes: AnimationKeyframe[],\r\n    config: AnimationOptions\r\n  ): AnimationCleanup {\r\n    // Apply final state immediately as fallback\r\n    const finalKeyframe = keyframes[keyframes.length - 1];\r\n    Object.assign(element.style, finalKeyframe);\r\n\r\n    // Return dummy cleanup object\r\n    return {\r\n      cancel: () => {},\r\n      finish: () => {},\r\n      pause: () => {},\r\n      play: () => {}\r\n    };\r\n  }\r\n\r\n  private getSlideTransforms(direction: 'left' | 'right' | 'up' | 'down') {\r\n    const transforms = {\r\n      left: { from: 'translateX(-100%)', to: 'translateX(0)' },\r\n      right: { from: 'translateX(100%)', to: 'translateX(0)' },\r\n      up: { from: 'translateY(-100%)', to: 'translateY(0)' },\r\n      down: { from: 'translateY(100%)', to: 'translateY(0)' }\r\n    };\r\n\r\n    return transforms[direction];\r\n  }\r\n\r\n  private generateAnimationId(prefix: string): string {\r\n    return `${prefix}-${++this.animationCounter}-${Date.now()}`;\r\n  }\r\n}\r\n\r\n// Export a singleton instance\r\nexport const animationSystem = new AnimationSystem();","import { AnimationSystem, AnimationCleanup, AnimationOptions } from './AnimationSystem';\r\nimport { SelectedImage } from '../types/overlay';\r\n\r\nexport interface OverlayAnimationConfig {\r\n  duration?: number;\r\n  easing?: string;\r\n  stagger?: number;\r\n  respectsReducedMotion?: boolean;\r\n}\r\n\r\nexport class OverlayAnimations {\r\n  private animationSystem: AnimationSystem;\r\n  private activeCleanups: Map<string, AnimationCleanup> = new Map();\r\n  private prefersReducedMotion: boolean = false;\r\n\r\n  constructor(animationSystem: AnimationSystem) {\r\n    this.animationSystem = animationSystem;\r\n    this.detectReducedMotionPreference();\r\n  }\r\n\r\n  /**\r\n   * Animate sidebar slide-in with glassmorphic reveal\r\n   */\r\n  public animateSidebarIn(\r\n    sidebarElement: HTMLElement,\r\n    isMobile: boolean = false,\r\n    config: OverlayAnimationConfig = {}\r\n  ): AnimationCleanup {\r\n    const cleanupId = 'sidebar-in';\r\n    this.cleanupPrevious(cleanupId);\r\n\r\n    if (this.shouldSkipAnimation(config)) {\r\n      return this.createNoOpCleanup();\r\n    }\r\n\r\n    const direction = isMobile ? 'down' : 'right';\r\n    const duration = config.duration || (isMobile ? 400 : 300);\r\n\r\n    // Show the element first\r\n    sidebarElement.style.display = 'block';\r\n    sidebarElement.style.pointerEvents = 'auto';\r\n\r\n    // Animate backdrop\r\n    const backdrop = sidebarElement.querySelector('.dino-sidebar-backdrop') as HTMLElement;\r\n    if (backdrop) {\r\n      this.animationSystem.fadeIn(backdrop, { duration: duration * 0.8 });\r\n    }\r\n\r\n    // Animate panel with slide and scale\r\n    const panel = sidebarElement.querySelector('.dino-sidebar-panel') as HTMLElement;\r\n    if (panel) {\r\n      const cleanup = this.animationSystem.createCustomAnimation(panel, [\r\n        {\r\n          transform: isMobile ? 'translateY(100%) scale(0.95)' : 'translateX(100%) scale(0.95)',\r\n          opacity: '0'\r\n        },\r\n        {\r\n          transform: isMobile ? 'translateY(0) scale(1)' : 'translateX(0) scale(1)',\r\n          opacity: '1'\r\n        }\r\n      ], {\r\n        duration,\r\n        easing: config.easing || 'cubic-bezier(0.34, 1.56, 0.64, 1)',\r\n        delay: config.stagger || 0\r\n      });\r\n\r\n      this.activeCleanups.set(cleanupId, cleanup);\r\n      return cleanup;\r\n    }\r\n\r\n    return this.createNoOpCleanup();\r\n  }\r\n\r\n  /**\r\n   * Animate sidebar slide-out with glassmorphic fade\r\n   */\r\n  public animateSidebarOut(\r\n    sidebarElement: HTMLElement,\r\n    isMobile: boolean = false,\r\n    config: OverlayAnimationConfig = {}\r\n  ): AnimationCleanup {\r\n    const cleanupId = 'sidebar-out';\r\n    this.cleanupPrevious(cleanupId);\r\n\r\n    if (this.shouldSkipAnimation(config)) {\r\n      sidebarElement.style.display = 'none';\r\n      return this.createNoOpCleanup();\r\n    }\r\n\r\n    const duration = config.duration || (isMobile ? 350 : 250);\r\n\r\n    // Animate backdrop fade\r\n    const backdrop = sidebarElement.querySelector('.dino-sidebar-backdrop') as HTMLElement;\r\n    if (backdrop) {\r\n      this.animationSystem.fadeOut(backdrop, { duration: duration * 0.6 });\r\n    }\r\n\r\n    // Animate panel slide out\r\n    const panel = sidebarElement.querySelector('.dino-sidebar-panel') as HTMLElement;\r\n    if (panel) {\r\n      const cleanup = this.animationSystem.createCustomAnimation(panel, [\r\n        {\r\n          transform: isMobile ? 'translateY(0) scale(1)' : 'translateX(0) scale(1)',\r\n          opacity: '1'\r\n        },\r\n        {\r\n          transform: isMobile ? 'translateY(100%) scale(0.95)' : 'translateX(100%) scale(0.95)',\r\n          opacity: '0'\r\n        }\r\n      ], {\r\n        duration,\r\n        easing: config.easing || 'cubic-bezier(0.4, 0, 1, 1)',\r\n        delay: config.stagger || 0\r\n      });\r\n\r\n      // Hide element after animation\r\n      cleanup.cancel = () => {\r\n        sidebarElement.style.display = 'none';\r\n        sidebarElement.style.pointerEvents = 'none';\r\n      };\r\n\r\n      this.activeCleanups.set(cleanupId, cleanup);\r\n      return cleanup;\r\n    }\r\n\r\n    return this.createNoOpCleanup();\r\n  }\r\n\r\n  /**\r\n   * Animate chat bar slide-in from bottom\r\n   */\r\n  public animateChatBarIn(\r\n    chatBarElement: HTMLElement,\r\n    config: OverlayAnimationConfig = {}\r\n  ): AnimationCleanup {\r\n    const cleanupId = 'chatbar-in';\r\n    this.cleanupPrevious(cleanupId);\r\n\r\n    if (this.shouldSkipAnimation(config)) {\r\n      return this.createNoOpCleanup();\r\n    }\r\n\r\n    const duration = config.duration || 300;\r\n\r\n    chatBarElement.style.display = 'block';\r\n    chatBarElement.style.pointerEvents = 'auto';\r\n\r\n    const cleanup = this.animationSystem.createCustomAnimation(chatBarElement, [\r\n      {\r\n        transform: 'translateY(100%) scale(0.9)',\r\n        opacity: '0'\r\n      },\r\n      {\r\n        transform: 'translateY(0) scale(1)',\r\n        opacity: '1'\r\n      }\r\n    ], {\r\n      duration,\r\n      easing: config.easing || 'cubic-bezier(0.34, 1.56, 0.64, 1)',\r\n      delay: config.stagger || 0\r\n    });\r\n\r\n    this.activeCleanups.set(cleanupId, cleanup);\r\n    return cleanup;\r\n  }\r\n\r\n  /**\r\n   * Animate chat bar slide-out to bottom\r\n   */\r\n  public animateChatBarOut(\r\n    chatBarElement: HTMLElement,\r\n    config: OverlayAnimationConfig = {}\r\n  ): AnimationCleanup {\r\n    const cleanupId = 'chatbar-out';\r\n    this.cleanupPrevious(cleanupId);\r\n\r\n    if (this.shouldSkipAnimation(config)) {\r\n      chatBarElement.style.display = 'none';\r\n      return this.createNoOpCleanup();\r\n    }\r\n\r\n    const duration = config.duration || 250;\r\n\r\n    const cleanup = this.animationSystem.createCustomAnimation(chatBarElement, [\r\n      {\r\n        transform: 'translateY(0) scale(1)',\r\n        opacity: '1'\r\n      },\r\n      {\r\n        transform: 'translateY(100%) scale(0.9)',\r\n        opacity: '0'\r\n      }\r\n    ], {\r\n      duration,\r\n      easing: config.easing || 'cubic-bezier(0.4, 0, 1, 1)',\r\n      delay: config.stagger || 0\r\n    });\r\n\r\n    // Hide element after animation\r\n    cleanup.cancel = () => {\r\n      chatBarElement.style.display = 'none';\r\n      chatBarElement.style.pointerEvents = 'none';\r\n    };\r\n\r\n    this.activeCleanups.set(cleanupId, cleanup);\r\n    return cleanup;\r\n  }\r\n\r\n  /**\r\n   * Animate image highlighter appearance with glow effect\r\n   */\r\n  public animateHighlighterIn(\r\n    highlighterElement: HTMLElement,\r\n    selectedImage: SelectedImage,\r\n    config: OverlayAnimationConfig = {}\r\n  ): AnimationCleanup {\r\n    const cleanupId = 'highlighter-in';\r\n    this.cleanupPrevious(cleanupId);\r\n\r\n    if (this.shouldSkipAnimation(config)) {\r\n      return this.createNoOpCleanup();\r\n    }\r\n\r\n    const duration = config.duration || 400;\r\n\r\n    // Position the highlighter to match the image\r\n    this.positionHighlighter(highlighterElement, selectedImage);\r\n\r\n    // Animate the highlighter appearance\r\n    const cleanup = this.animationSystem.createCustomAnimation(highlighterElement, [\r\n      {\r\n        opacity: '0',\r\n        transform: 'scale(0.8)',\r\n        borderWidth: '0px'\r\n      },\r\n      {\r\n        opacity: '1',\r\n        transform: 'scale(1)',\r\n        borderWidth: '2px'\r\n      }\r\n    ], {\r\n      duration,\r\n      easing: config.easing || 'cubic-bezier(0.34, 1.56, 0.64, 1)',\r\n      delay: config.stagger || 0\r\n    });\r\n\r\n    // Start glow animation\r\n    this.startHighlighterGlow(highlighterElement);\r\n\r\n    this.activeCleanups.set(cleanupId, cleanup);\r\n    return cleanup;\r\n  }\r\n\r\n  /**\r\n   * Animate image highlighter removal\r\n   */\r\n  public animateHighlighterOut(\r\n    highlighterElement: HTMLElement,\r\n    config: OverlayAnimationConfig = {}\r\n  ): AnimationCleanup {\r\n    const cleanupId = 'highlighter-out';\r\n    this.cleanupPrevious(cleanupId);\r\n\r\n    if (this.shouldSkipAnimation(config)) {\r\n      highlighterElement.style.display = 'none';\r\n      return this.createNoOpCleanup();\r\n    }\r\n\r\n    const duration = config.duration || 200;\r\n\r\n    const cleanup = this.animationSystem.createCustomAnimation(highlighterElement, [\r\n      {\r\n        opacity: '1',\r\n        transform: 'scale(1)'\r\n      },\r\n      {\r\n        opacity: '0',\r\n        transform: 'scale(0.8)'\r\n      }\r\n    ], {\r\n      duration,\r\n      easing: config.easing || 'cubic-bezier(0.4, 0, 1, 1)',\r\n      delay: config.stagger || 0\r\n    });\r\n\r\n    // Stop glow animation\r\n    this.stopHighlighterGlow(highlighterElement);\r\n\r\n    // Hide element after animation\r\n    cleanup.cancel = () => {\r\n      highlighterElement.style.display = 'none';\r\n    };\r\n\r\n    this.activeCleanups.set(cleanupId, cleanup);\r\n    return cleanup;\r\n  }\r\n\r\n  /**\r\n   * Animate button hover state with scale and glow\r\n   */\r\n  public setupButtonHoverAnimation(\r\n    buttonElement: HTMLElement,\r\n    config: OverlayAnimationConfig = {}\r\n  ): () => void {\r\n    if (this.shouldSkipAnimation(config)) {\r\n      return () => {};\r\n    }\r\n\r\n    return this.animationSystem.setupHoverAnimation(buttonElement, {\r\n      background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08))',\r\n      boxShadow: '0 4px 16px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.2)'\r\n    }, {\r\n      duration: config.duration || 200,\r\n      easing: config.easing || 'cubic-bezier(0.4, 0, 0.2, 1)',\r\n      scaleOnHover: true,\r\n      glowOnHover: true,\r\n      glowColor: 'rgba(59, 130, 246, 0.3)'\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Animate button focus state\r\n   */\r\n  public setupButtonFocusAnimation(\r\n    buttonElement: HTMLElement,\r\n    config: OverlayAnimationConfig = {}\r\n  ): () => void {\r\n    if (this.shouldSkipAnimation(config)) {\r\n      return () => {};\r\n    }\r\n\r\n    return this.animationSystem.setupFocusAnimation(buttonElement, {\r\n      background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08))'\r\n    }, {\r\n      duration: config.duration || 200,\r\n      easing: config.easing || 'cubic-bezier(0.4, 0, 0.2, 1)',\r\n      glowOnFocus: true,\r\n      glowColor: 'rgba(59, 130, 246, 0.5)'\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Animate loading state with pulse and spinner\r\n   */\r\n  public animateLoadingState(\r\n    element: HTMLElement,\r\n    isLoading: boolean,\r\n    config: OverlayAnimationConfig = {}\r\n  ): AnimationCleanup {\r\n    const cleanupId = `loading-${element.className}`;\r\n    this.cleanupPrevious(cleanupId);\r\n\r\n    if (this.shouldSkipAnimation(config)) {\r\n      return this.createNoOpCleanup();\r\n    }\r\n\r\n    if (isLoading) {\r\n      // Add loading spinner if not present\r\n      const existingSpinner = element.querySelector('.dino-loading-spinner');\r\n      if (!existingSpinner) {\r\n        const spinner = this.createLoadingSpinner();\r\n        const iconElement = element.querySelector('.dino-action-icon, .dino-chat-icon');\r\n        if (iconElement) {\r\n          iconElement.innerHTML = '';\r\n          iconElement.appendChild(spinner);\r\n        }\r\n      }\r\n\r\n      // Start pulse animation\r\n      const cleanup = this.animationSystem.pulse(element, {\r\n        duration: config.duration || 1000,\r\n        iterations: Infinity\r\n      });\r\n\r\n      this.activeCleanups.set(cleanupId, cleanup);\r\n      return cleanup;\r\n    } else {\r\n      // Remove loading spinner\r\n      const spinner = element.querySelector('.dino-loading-spinner');\r\n      if (spinner) {\r\n        spinner.remove();\r\n      }\r\n\r\n      return this.createNoOpCleanup();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Animate error state with shake effect\r\n   */\r\n  public animateErrorState(\r\n    element: HTMLElement,\r\n    config: OverlayAnimationConfig = {}\r\n  ): AnimationCleanup {\r\n    const cleanupId = `error-${element.className}`;\r\n    this.cleanupPrevious(cleanupId);\r\n\r\n    if (this.shouldSkipAnimation(config)) {\r\n      return this.createNoOpCleanup();\r\n    }\r\n\r\n    // Add error styling\r\n    const originalBackground = element.style.background;\r\n    const originalBorder = element.style.border;\r\n\r\n    element.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1))';\r\n    element.style.border = '1px solid rgba(239, 68, 68, 0.3)';\r\n\r\n    const cleanup = this.animationSystem.shake(element, {\r\n      duration: config.duration || 500,\r\n      easing: config.easing || 'ease-in-out'\r\n    });\r\n\r\n    // Restore original styling after animation\r\n    setTimeout(() => {\r\n      element.style.background = originalBackground;\r\n      element.style.border = originalBorder;\r\n    }, config.duration || 500);\r\n\r\n    this.activeCleanups.set(cleanupId, cleanup);\r\n    return cleanup;\r\n  }\r\n\r\n  /**\r\n   * Animate staggered list items (for action buttons)\r\n   */\r\n  public animateStaggeredList(\r\n    listElement: HTMLElement,\r\n    config: OverlayAnimationConfig = {}\r\n  ): AnimationCleanup[] {\r\n    if (this.shouldSkipAnimation(config)) {\r\n      return [];\r\n    }\r\n\r\n    const items = Array.from(listElement.children) as HTMLElement[];\r\n    const staggerDelay = config.stagger || 50;\r\n    const cleanups: AnimationCleanup[] = [];\r\n\r\n    items.forEach((item, index) => {\r\n      const cleanup = this.animationSystem.createCustomAnimation(item, [\r\n        {\r\n          opacity: '0',\r\n          transform: 'translateX(20px)'\r\n        },\r\n        {\r\n          opacity: '1',\r\n          transform: 'translateX(0)'\r\n        }\r\n      ], {\r\n        duration: config.duration || 300,\r\n        easing: config.easing || 'cubic-bezier(0.4, 0, 0.2, 1)',\r\n        delay: index * staggerDelay\r\n      });\r\n\r\n      cleanups.push(cleanup);\r\n    });\r\n\r\n    return cleanups;\r\n  }\r\n\r\n  /**\r\n   * Clean up all active animations\r\n   */\r\n  public cleanup(): void {\r\n    this.activeCleanups.forEach(cleanup => {\r\n      cleanup.cancel();\r\n    });\r\n    this.activeCleanups.clear();\r\n  }\r\n\r\n  /**\r\n   * Clean up specific animation\r\n   */\r\n  public cleanupAnimation(cleanupId: string): void {\r\n    const cleanup = this.activeCleanups.get(cleanupId);\r\n    if (cleanup) {\r\n      cleanup.cancel();\r\n      this.activeCleanups.delete(cleanupId);\r\n    }\r\n  }\r\n\r\n  // Private methods\r\n\r\n  private cleanupPrevious(cleanupId: string): void {\r\n    const existingCleanup = this.activeCleanups.get(cleanupId);\r\n    if (existingCleanup) {\r\n      existingCleanup.cancel();\r\n      this.activeCleanups.delete(cleanupId);\r\n    }\r\n  }\r\n\r\n  private shouldSkipAnimation(config: OverlayAnimationConfig): boolean {\r\n    return (config.respectsReducedMotion !== false && this.prefersReducedMotion);\r\n  }\r\n\r\n  private createNoOpCleanup(): AnimationCleanup {\r\n    return {\r\n      cancel: () => {},\r\n      finish: () => {},\r\n      pause: () => {},\r\n      play: () => {}\r\n    };\r\n  }\r\n\r\n  private detectReducedMotionPreference(): void {\r\n    if (typeof window !== 'undefined' && window.matchMedia) {\r\n      const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\r\n      this.prefersReducedMotion = mediaQuery.matches;\r\n\r\n      // Listen for changes\r\n      mediaQuery.addEventListener('change', (e) => {\r\n        this.prefersReducedMotion = e.matches;\r\n      });\r\n    }\r\n  }\r\n\r\n  private positionHighlighter(highlighterElement: HTMLElement, selectedImage: SelectedImage): void {\r\n    const { rect, borderRadius } = selectedImage;\r\n\r\n    Object.assign(highlighterElement.style, {\r\n      position: 'absolute',\r\n      left: `${rect.left}px`,\r\n      top: `${rect.top}px`,\r\n      width: `${rect.width}px`,\r\n      height: `${rect.height}px`,\r\n      borderRadius: borderRadius,\r\n      pointerEvents: 'none',\r\n      zIndex: '999997'\r\n    });\r\n  }\r\n\r\n  private startHighlighterGlow(highlighterElement: HTMLElement): void {\r\n    const glowCleanup = this.animationSystem.glow(highlighterElement, 'rgba(59, 130, 246, 0.6)', {\r\n      duration: 2000,\r\n      iterations: Infinity\r\n    });\r\n\r\n    this.activeCleanups.set('highlighter-glow', glowCleanup);\r\n  }\r\n\r\n  private stopHighlighterGlow(highlighterElement: HTMLElement): void {\r\n    this.cleanupAnimation('highlighter-glow');\r\n  }\r\n\r\n  private createLoadingSpinner(): HTMLElement {\r\n    const spinner = document.createElement('div');\r\n    spinner.className = 'dino-loading-spinner';\r\n    \r\n    Object.assign(spinner.style, {\r\n      width: '20px',\r\n      height: '20px',\r\n      border: '2px solid rgba(255, 255, 255, 0.3)',\r\n      borderTop: '2px solid rgba(255, 255, 255, 0.8)',\r\n      borderRadius: '50%',\r\n      display: 'inline-block'\r\n    });\r\n\r\n    // Start spin animation\r\n    const spinCleanup = this.animationSystem.spin(spinner);\r\n    \r\n    // Store cleanup for later removal\r\n    spinner.addEventListener('remove', () => {\r\n      spinCleanup.cancel();\r\n    });\r\n\r\n    return spinner;\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const overlayAnimations = new OverlayAnimations(new AnimationSystem());","import { Component } from './OverlayManager';\r\nimport { SelectedImage, OverlayState, AnimationConfig } from '../types/overlay';\r\nimport { OverlayAnimations, OverlayAnimationConfig } from './OverlayAnimations';\r\nimport { AnimationCleanup } from './AnimationSystem';\r\n\r\nexport interface HighlighterProps {\r\n  selectedImage: SelectedImage | null;\r\n  onClose: () => void;\r\n  onImageClick?: (image: HTMLImageElement) => void;\r\n}\r\n\r\nexport class ImageHighlighter implements Component {\r\n  private element: HTMLElement | null = null;\r\n  private glowAnimation: Animation | null = null;\r\n  private props: HighlighterProps;\r\n  private isDestroyed: boolean = false;\r\n  private resizeObserver: ResizeObserver | null = null;\r\n  private overlayAnimations: OverlayAnimations;\r\n  private animationCleanups: Map<string, AnimationCleanup> = new Map();\r\n  private hoverCleanups: Map<string, () => void> = new Map();\r\n\r\n  constructor(props: HighlighterProps, overlayAnimations?: OverlayAnimations) {\r\n    this.props = props;\r\n    this.overlayAnimations = overlayAnimations || new OverlayAnimations(new (require('./AnimationSystem').AnimationSystem)());\r\n    this.handleCloseClick = this.handleCloseClick.bind(this);\r\n    this.handleImageClick = this.handleImageClick.bind(this);\r\n  }\r\n\r\n  public render(): HTMLElement {\r\n    if (this.isDestroyed) {\r\n      throw new Error('ImageHighlighter has been destroyed');\r\n    }\r\n\r\n    // Create or update the highlighter element\r\n    if (!this.element) {\r\n      this.element = this.createElement();\r\n    }\r\n\r\n    this.updateElement();\r\n    return this.element;\r\n  }\r\n\r\n  public update(state: OverlayState): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    const newProps: HighlighterProps = {\r\n      ...this.props,\r\n      selectedImage: state.selectedImage\r\n    };\r\n\r\n    this.props = newProps;\r\n\r\n    if (this.element) {\r\n      this.updateElement();\r\n    }\r\n  }\r\n\r\n  public destroy(): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    this.isDestroyed = true;\r\n\r\n    // Stop glow animation\r\n    this.stopGlowAnimation();\r\n\r\n    // Clean up animations\r\n    this.animationCleanups.forEach(cleanup => cleanup.cancel());\r\n    this.animationCleanups.clear();\r\n\r\n    // Clean up hover animations\r\n    this.hoverCleanups.forEach(cleanup => cleanup());\r\n    this.hoverCleanups.clear();\r\n\r\n    // Clean up overlay animations\r\n    this.overlayAnimations.cleanup();\r\n\r\n    // Disconnect resize observer\r\n    if (this.resizeObserver) {\r\n      this.resizeObserver.disconnect();\r\n      this.resizeObserver = null;\r\n    }\r\n\r\n    // Remove element from DOM\r\n    if (this.element && this.element.parentNode) {\r\n      this.element.parentNode.removeChild(this.element);\r\n    }\r\n\r\n    this.element = null;\r\n  }\r\n\r\n  private createElement(): HTMLElement {\r\n    const highlighter = document.createElement('div');\r\n    highlighter.className = 'dino-image-highlighter';\r\n    \r\n    // Apply base styles\r\n    this.applyBaseStyles(highlighter);\r\n\r\n    // Create close button\r\n    const closeButton = this.createCloseButton();\r\n    highlighter.appendChild(closeButton);\r\n\r\n    // Setup resize observer to track image changes\r\n    this.setupResizeObserver();\r\n\r\n    return highlighter;\r\n  }\r\n\r\n  private updateElement(): void {\r\n    if (!this.element || this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    const { selectedImage } = this.props;\r\n\r\n    if (!selectedImage) {\r\n      // Animate highlighter out when no image is selected\r\n      const cleanup = this.overlayAnimations.animateHighlighterOut(this.element, {\r\n        duration: 200,\r\n        respectsReducedMotion: true\r\n      });\r\n      this.animationCleanups.set('hide', cleanup);\r\n      this.stopGlowAnimation();\r\n      return;\r\n    }\r\n\r\n    // Show and position highlighter with animation\r\n    this.positionHighlighter(selectedImage);\r\n    this.updateBorderRadius(selectedImage);\r\n    \r\n    // Animate highlighter in\r\n    const cleanup = this.overlayAnimations.animateHighlighterIn(this.element, selectedImage, {\r\n      duration: 400,\r\n      respectsReducedMotion: true\r\n    });\r\n    this.animationCleanups.set('show', cleanup);\r\n  }\r\n\r\n  private applyBaseStyles(element: HTMLElement): void {\r\n    // Apply glassmorphic styling with CSS-in-JS\r\n    Object.assign(element.style, {\r\n      position: 'fixed',\r\n      pointerEvents: 'none',\r\n      zIndex: '999999',\r\n      display: 'none',\r\n      \r\n      // Glassmorphic border styling\r\n      border: '2px solid rgba(255, 255, 255, 0.3)',\r\n      borderRadius: '8px',\r\n      background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05))',\r\n      backdropFilter: 'blur(10px)',\r\n      WebkitBackdropFilter: 'blur(10px)',\r\n      \r\n      // Shadow and glow effects\r\n      boxShadow: `\r\n        0 8px 32px rgba(0, 0, 0, 0.1),\r\n        0 0 0 1px rgba(255, 255, 255, 0.1),\r\n        inset 0 1px 0 rgba(255, 255, 255, 0.2)\r\n      `,\r\n      \r\n      // Smooth transitions\r\n      transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',\r\n      \r\n      // Ensure proper rendering\r\n      willChange: 'transform, opacity',\r\n      transform: 'translateZ(0)'\r\n    });\r\n  }\r\n\r\n  private createCloseButton(): HTMLElement {\r\n    const button = document.createElement('button');\r\n    button.className = 'dino-highlighter-close';\r\n    button.innerHTML = '';\r\n    button.setAttribute('aria-label', 'Close image highlighter');\r\n    \r\n    // Style the close button\r\n    Object.assign(button.style, {\r\n      position: 'absolute',\r\n      top: '-12px',\r\n      right: '-12px',\r\n      width: '24px',\r\n      height: '24px',\r\n      borderRadius: '50%',\r\n      border: 'none',\r\n      \r\n      // Glassmorphic button styling\r\n      background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1))',\r\n      backdropFilter: 'blur(10px)',\r\n      WebkitBackdropFilter: 'blur(10px)',\r\n      \r\n      // Typography\r\n      color: 'rgba(255, 255, 255, 0.9)',\r\n      fontSize: '16px',\r\n      fontWeight: 'bold',\r\n      lineHeight: '1',\r\n      \r\n      // Interactive styles\r\n      cursor: 'pointer',\r\n      pointerEvents: 'auto',\r\n      \r\n      // Shadow and effects\r\n      boxShadow: `\r\n        0 4px 16px rgba(0, 0, 0, 0.1),\r\n        0 0 0 1px rgba(255, 255, 255, 0.2),\r\n        inset 0 1px 0 rgba(255, 255, 255, 0.3)\r\n      `,\r\n      \r\n      // Smooth transitions\r\n      transition: 'all 0.2s cubic-bezier(0.4, 0, 0.2, 1)',\r\n      transform: 'scale(1)',\r\n      \r\n      // Ensure proper rendering\r\n      willChange: 'transform, box-shadow'\r\n    });\r\n\r\n    // Add hover and active states\r\n    button.addEventListener('mouseenter', () => {\r\n      if (!this.isDestroyed) {\r\n        Object.assign(button.style, {\r\n          transform: 'scale(1.1)',\r\n          boxShadow: `\r\n            0 6px 20px rgba(0, 0, 0, 0.15),\r\n            0 0 0 1px rgba(255, 255, 255, 0.3),\r\n            inset 0 1px 0 rgba(255, 255, 255, 0.4),\r\n            0 0 20px rgba(255, 255, 255, 0.2)\r\n          `\r\n        });\r\n      }\r\n    });\r\n\r\n    button.addEventListener('mouseleave', () => {\r\n      if (!this.isDestroyed) {\r\n        Object.assign(button.style, {\r\n          transform: 'scale(1)',\r\n          boxShadow: `\r\n            0 4px 16px rgba(0, 0, 0, 0.1),\r\n            0 0 0 1px rgba(255, 255, 255, 0.2),\r\n            inset 0 1px 0 rgba(255, 255, 255, 0.3)\r\n          `\r\n        });\r\n      }\r\n    });\r\n\r\n    button.addEventListener('mousedown', () => {\r\n      if (!this.isDestroyed) {\r\n        button.style.transform = 'scale(0.95)';\r\n      }\r\n    });\r\n\r\n    button.addEventListener('mouseup', () => {\r\n      if (!this.isDestroyed) {\r\n        button.style.transform = 'scale(1.1)';\r\n      }\r\n    });\r\n\r\n    button.addEventListener('click', this.handleCloseClick);\r\n\r\n    // Setup hover and focus animations for close button\r\n    const hoverCleanup = this.overlayAnimations.setupButtonHoverAnimation(button, {\r\n      duration: 200,\r\n      respectsReducedMotion: true\r\n    });\r\n    \r\n    const focusCleanup = this.overlayAnimations.setupButtonFocusAnimation(button, {\r\n      duration: 200,\r\n      respectsReducedMotion: true\r\n    });\r\n\r\n    this.hoverCleanups.set('close-hover', hoverCleanup);\r\n    this.hoverCleanups.set('close-focus', focusCleanup);\r\n\r\n    return button;\r\n  }\r\n\r\n  private positionHighlighter(selectedImage: SelectedImage): void {\r\n    if (!this.element || this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    const { rect } = selectedImage;\r\n    \r\n    // Position the highlighter to match the image exactly\r\n    Object.assign(this.element.style, {\r\n      left: `${rect.left}px`,\r\n      top: `${rect.top}px`,\r\n      width: `${rect.width}px`,\r\n      height: `${rect.height}px`\r\n    });\r\n  }\r\n\r\n  private updateBorderRadius(selectedImage: SelectedImage): void {\r\n    if (!this.element || this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    // Match the image's border radius exactly\r\n    this.element.style.borderRadius = selectedImage.borderRadius || '8px';\r\n  }\r\n\r\n  private startGlowAnimation(): void {\r\n    if (!this.element || this.isDestroyed || this.glowAnimation) {\r\n      return;\r\n    }\r\n\r\n    // Create pulsing glow animation\r\n    const keyframes = [\r\n      {\r\n        boxShadow: `\r\n          0 8px 32px rgba(0, 0, 0, 0.1),\r\n          0 0 0 1px rgba(255, 255, 255, 0.1),\r\n          inset 0 1px 0 rgba(255, 255, 255, 0.2),\r\n          0 0 20px rgba(59, 130, 246, 0.3)\r\n        `,\r\n        borderColor: 'rgba(59, 130, 246, 0.4)'\r\n      },\r\n      {\r\n        boxShadow: `\r\n          0 8px 32px rgba(0, 0, 0, 0.1),\r\n          0 0 0 1px rgba(255, 255, 255, 0.1),\r\n          inset 0 1px 0 rgba(255, 255, 255, 0.2),\r\n          0 0 40px rgba(59, 130, 246, 0.5)\r\n        `,\r\n        borderColor: 'rgba(59, 130, 246, 0.6)'\r\n      },\r\n      {\r\n        boxShadow: `\r\n          0 8px 32px rgba(0, 0, 0, 0.1),\r\n          0 0 0 1px rgba(255, 255, 255, 0.1),\r\n          inset 0 1px 0 rgba(255, 255, 255, 0.2),\r\n          0 0 20px rgba(59, 130, 246, 0.3)\r\n        `,\r\n        borderColor: 'rgba(59, 130, 246, 0.4)'\r\n      }\r\n    ];\r\n\r\n    const animationConfig: KeyframeAnimationOptions = {\r\n      duration: 2000,\r\n      iterations: Infinity,\r\n      easing: 'cubic-bezier(0.4, 0, 0.6, 1)'\r\n    };\r\n\r\n    try {\r\n      this.glowAnimation = this.element.animate(keyframes, animationConfig);\r\n    } catch (error) {\r\n      console.warn('[ImageHighlighter] Failed to start glow animation:', error);\r\n    }\r\n  }\r\n\r\n  private stopGlowAnimation(): void {\r\n    if (this.glowAnimation) {\r\n      this.glowAnimation.cancel();\r\n      this.glowAnimation = null;\r\n    }\r\n  }\r\n\r\n  private setupResizeObserver(): void {\r\n    if (!this.props.selectedImage?.element || this.resizeObserver) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.resizeObserver = new ResizeObserver((entries) => {\r\n        if (this.isDestroyed || !this.props.selectedImage) {\r\n          return;\r\n        }\r\n\r\n        // Update highlighter position when image resizes\r\n        for (const entry of entries) {\r\n          if (entry.target === this.props.selectedImage.element) {\r\n            const rect = entry.target.getBoundingClientRect();\r\n            const updatedSelectedImage: SelectedImage = {\r\n              ...this.props.selectedImage,\r\n              rect\r\n            };\r\n            \r\n            this.props = {\r\n              ...this.props,\r\n              selectedImage: updatedSelectedImage\r\n            };\r\n            \r\n            this.positionHighlighter(updatedSelectedImage);\r\n            break;\r\n          }\r\n        }\r\n      });\r\n\r\n      this.resizeObserver.observe(this.props.selectedImage.element);\r\n    } catch (error) {\r\n      console.warn('[ImageHighlighter] ResizeObserver not supported:', error);\r\n    }\r\n  }\r\n\r\n  private handleCloseClick(event: Event): void {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    \r\n    if (!this.isDestroyed) {\r\n      this.props.onClose();\r\n    }\r\n  }\r\n\r\n  private handleImageClick(event: Event): void {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    \r\n    if (!this.isDestroyed && this.props.selectedImage && this.props.onImageClick) {\r\n      this.props.onImageClick(this.props.selectedImage.element);\r\n    }\r\n  }\r\n\r\n  // Static utility methods for border radius calculation\r\n  public static calculateBorderRadius(element: HTMLImageElement): string {\r\n    if (!element) {\r\n      return '8px';\r\n    }\r\n\r\n    try {\r\n      const computedStyle = window.getComputedStyle(element);\r\n      const borderRadius = computedStyle.borderRadius;\r\n      \r\n      // If border radius is set, use it\r\n      if (borderRadius && borderRadius !== '0px') {\r\n        return borderRadius;\r\n      }\r\n\r\n      // Check individual corner properties\r\n      const topLeft = computedStyle.borderTopLeftRadius;\r\n      const topRight = computedStyle.borderTopRightRadius;\r\n      const bottomRight = computedStyle.borderBottomRightRadius;\r\n      const bottomLeft = computedStyle.borderBottomLeftRadius;\r\n\r\n      // If all corners are the same, return single value\r\n      if (topLeft === topRight && topRight === bottomRight && bottomRight === bottomLeft) {\r\n        return topLeft || '8px';\r\n      }\r\n\r\n      // Return individual corner values\r\n      return `${topLeft || '0px'} ${topRight || '0px'} ${bottomRight || '0px'} ${bottomLeft || '0px'}`;\r\n    } catch (error) {\r\n      console.warn('[ImageHighlighter] Failed to calculate border radius:', error);\r\n      return '8px';\r\n    }\r\n  }\r\n\r\n  public static createGlowKeyframes(color: string = 'rgba(59, 130, 246, 0.5)'): Keyframe[] {\r\n    return [\r\n      {\r\n        boxShadow: `\r\n          0 8px 32px rgba(0, 0, 0, 0.1),\r\n          0 0 0 1px rgba(255, 255, 255, 0.1),\r\n          inset 0 1px 0 rgba(255, 255, 255, 0.2),\r\n          0 0 20px ${color}\r\n        `\r\n      },\r\n      {\r\n        boxShadow: `\r\n          0 8px 32px rgba(0, 0, 0, 0.1),\r\n          0 0 0 1px rgba(255, 255, 255, 0.1),\r\n          inset 0 1px 0 rgba(255, 255, 255, 0.2),\r\n          0 0 40px ${color}\r\n        `\r\n      },\r\n      {\r\n        boxShadow: `\r\n          0 8px 32px rgba(0, 0, 0, 0.1),\r\n          0 0 0 1px rgba(255, 255, 255, 0.1),\r\n          inset 0 1px 0 rgba(255, 255, 255, 0.2),\r\n          0 0 20px ${color}\r\n        `\r\n      }\r\n    ];\r\n  }\r\n}","export interface TouchPoint {\r\n  x: number;\r\n  y: number;\r\n  timestamp: number;\r\n}\r\n\r\nexport interface SwipeGesture {\r\n  direction: 'left' | 'right' | 'up' | 'down';\r\n  distance: number;\r\n  velocity: number;\r\n  duration: number;\r\n  startPoint: TouchPoint;\r\n  endPoint: TouchPoint;\r\n}\r\n\r\nexport interface TapGesture {\r\n  point: TouchPoint;\r\n  tapCount: number;\r\n}\r\n\r\nexport interface TouchGestureEvents {\r\n  tap: (gesture: TapGesture, event: TouchEvent) => void;\r\n  doubleTap: (gesture: TapGesture, event: TouchEvent) => void;\r\n  swipe: (gesture: SwipeGesture, event: TouchEvent) => void;\r\n  touchStart: (point: TouchPoint, event: TouchEvent) => void;\r\n  touchMove: (point: TouchPoint, event: TouchEvent) => void;\r\n  touchEnd: (point: TouchPoint, event: TouchEvent) => void;\r\n}\r\n\r\nexport interface TouchGestureConfig {\r\n  swipeThreshold: number;\r\n  swipeVelocityThreshold: number;\r\n  tapTimeout: number;\r\n  doubleTapTimeout: number;\r\n  maxTapDistance: number;\r\n  debug: boolean;\r\n}\r\n\r\nexport class TouchGestureHandler {\r\n  private element: HTMLElement;\r\n  private config: TouchGestureConfig;\r\n  private eventListeners: Map<string, Function[]> = new Map();\r\n  private isDestroyed: boolean = false;\r\n\r\n  // Touch tracking\r\n  private touchStart: TouchPoint | null = null;\r\n  private touchCurrent: TouchPoint | null = null;\r\n  private lastTap: TouchPoint | null = null;\r\n  private tapCount: number = 0;\r\n  private tapTimeout: number | null = null;\r\n  private doubleTapTimeout: number | null = null;\r\n\r\n  constructor(element: HTMLElement, config: Partial<TouchGestureConfig> = {}) {\r\n    this.element = element;\r\n    this.config = {\r\n      swipeThreshold: 50,\r\n      swipeVelocityThreshold: 0.3,\r\n      tapTimeout: 300,\r\n      doubleTapTimeout: 300,\r\n      maxTapDistance: 10,\r\n      debug: false,\r\n      ...config\r\n    };\r\n\r\n    // Bind methods\r\n    this.handleTouchStart = this.handleTouchStart.bind(this);\r\n    this.handleTouchMove = this.handleTouchMove.bind(this);\r\n    this.handleTouchEnd = this.handleTouchEnd.bind(this);\r\n    this.handleTouchCancel = this.handleTouchCancel.bind(this);\r\n  }\r\n\r\n  public initialize(): void {\r\n    if (this.isDestroyed) {\r\n      throw new Error('TouchGestureHandler has been destroyed');\r\n    }\r\n\r\n    this.setupEventListeners();\r\n\r\n    if (this.config.debug) {\r\n      console.log('[TouchGestureHandler] Initialized on element:', this.element);\r\n    }\r\n  }\r\n\r\n  public destroy(): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    this.isDestroyed = true;\r\n\r\n    // Clear timeouts\r\n    if (this.tapTimeout) {\r\n      clearTimeout(this.tapTimeout);\r\n      this.tapTimeout = null;\r\n    }\r\n\r\n    if (this.doubleTapTimeout) {\r\n      clearTimeout(this.doubleTapTimeout);\r\n      this.doubleTapTimeout = null;\r\n    }\r\n\r\n    // Remove event listeners\r\n    this.removeEventListeners();\r\n\r\n    // Clear event listeners\r\n    this.eventListeners.clear();\r\n\r\n    // Reset state\r\n    this.touchStart = null;\r\n    this.touchCurrent = null;\r\n    this.lastTap = null;\r\n    this.tapCount = 0;\r\n\r\n    if (this.config.debug) {\r\n      console.log('[TouchGestureHandler] Destroyed');\r\n    }\r\n  }\r\n\r\n  public on<K extends keyof TouchGestureEvents>(\r\n    event: K,\r\n    callback: TouchGestureEvents[K]\r\n  ): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, []);\r\n    }\r\n    this.eventListeners.get(event)!.push(callback);\r\n  }\r\n\r\n  public off<K extends keyof TouchGestureEvents>(\r\n    event: K,\r\n    callback: TouchGestureEvents[K]\r\n  ): void {\r\n    const listeners = this.eventListeners.get(event);\r\n    if (listeners) {\r\n      const index = listeners.indexOf(callback);\r\n      if (index > -1) {\r\n        listeners.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  public updateConfig(config: Partial<TouchGestureConfig>): void {\r\n    this.config = { ...this.config, ...config };\r\n  }\r\n\r\n  private setupEventListeners(): void {\r\n    const options = { passive: false };\r\n    \r\n    this.element.addEventListener('touchstart', this.handleTouchStart, options);\r\n    this.element.addEventListener('touchmove', this.handleTouchMove, options);\r\n    this.element.addEventListener('touchend', this.handleTouchEnd, options);\r\n    this.element.addEventListener('touchcancel', this.handleTouchCancel, options);\r\n  }\r\n\r\n  private removeEventListeners(): void {\r\n    this.element.removeEventListener('touchstart', this.handleTouchStart);\r\n    this.element.removeEventListener('touchmove', this.handleTouchMove);\r\n    this.element.removeEventListener('touchend', this.handleTouchEnd);\r\n    this.element.removeEventListener('touchcancel', this.handleTouchCancel);\r\n  }\r\n\r\n  private handleTouchStart(event: TouchEvent): void {\r\n    if (this.isDestroyed || event.touches.length !== 1) {\r\n      return;\r\n    }\r\n\r\n    const touch = event.touches[0];\r\n    this.touchStart = this.createTouchPoint(touch);\r\n    this.touchCurrent = { ...this.touchStart };\r\n\r\n    this.emit('touchStart', this.touchStart, event);\r\n\r\n    if (this.config.debug) {\r\n      console.log('[TouchGestureHandler] Touch start:', this.touchStart);\r\n    }\r\n  }\r\n\r\n  private handleTouchMove(event: TouchEvent): void {\r\n    if (this.isDestroyed || !this.touchStart || event.touches.length !== 1) {\r\n      return;\r\n    }\r\n\r\n    const touch = event.touches[0];\r\n    this.touchCurrent = this.createTouchPoint(touch);\r\n\r\n    this.emit('touchMove', this.touchCurrent, event);\r\n\r\n    // Prevent scrolling if we're potentially swiping\r\n    const distance = this.calculateDistance(this.touchStart, this.touchCurrent);\r\n    if (distance > this.config.maxTapDistance) {\r\n      event.preventDefault();\r\n    }\r\n  }\r\n\r\n  private handleTouchEnd(event: TouchEvent): void {\r\n    if (this.isDestroyed || !this.touchStart || !this.touchCurrent) {\r\n      return;\r\n    }\r\n\r\n    const touchEnd = this.touchCurrent;\r\n    this.emit('touchEnd', touchEnd, event);\r\n\r\n    // Calculate gesture metrics\r\n    const distance = this.calculateDistance(this.touchStart, touchEnd);\r\n    const duration = touchEnd.timestamp - this.touchStart.timestamp;\r\n    const velocity = distance / duration;\r\n\r\n    if (this.config.debug) {\r\n      console.log('[TouchGestureHandler] Touch end:', {\r\n        distance,\r\n        duration,\r\n        velocity,\r\n        swipeThreshold: this.config.swipeThreshold,\r\n        velocityThreshold: this.config.swipeVelocityThreshold\r\n      });\r\n    }\r\n\r\n    // Determine gesture type\r\n    if (distance >= this.config.swipeThreshold && velocity >= this.config.swipeVelocityThreshold) {\r\n      this.handleSwipeGesture(this.touchStart, touchEnd, distance, velocity, duration, event);\r\n    } else if (distance <= this.config.maxTapDistance) {\r\n      this.handleTapGesture(touchEnd, event);\r\n    }\r\n\r\n    // Reset touch state\r\n    this.touchStart = null;\r\n    this.touchCurrent = null;\r\n  }\r\n\r\n  private handleTouchCancel(event: TouchEvent): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    // Reset touch state\r\n    this.touchStart = null;\r\n    this.touchCurrent = null;\r\n\r\n    if (this.config.debug) {\r\n      console.log('[TouchGestureHandler] Touch cancelled');\r\n    }\r\n  }\r\n\r\n  private handleSwipeGesture(\r\n    start: TouchPoint,\r\n    end: TouchPoint,\r\n    distance: number,\r\n    velocity: number,\r\n    duration: number,\r\n    event: TouchEvent\r\n  ): void {\r\n    const deltaX = end.x - start.x;\r\n    const deltaY = end.y - start.y;\r\n    \r\n    let direction: SwipeGesture['direction'];\r\n    \r\n    if (Math.abs(deltaX) > Math.abs(deltaY)) {\r\n      direction = deltaX > 0 ? 'right' : 'left';\r\n    } else {\r\n      direction = deltaY > 0 ? 'down' : 'up';\r\n    }\r\n\r\n    const swipeGesture: SwipeGesture = {\r\n      direction,\r\n      distance,\r\n      velocity,\r\n      duration,\r\n      startPoint: start,\r\n      endPoint: end\r\n    };\r\n\r\n    this.emit('swipe', swipeGesture, event);\r\n\r\n    if (this.config.debug) {\r\n      console.log('[TouchGestureHandler] Swipe detected:', swipeGesture);\r\n    }\r\n  }\r\n\r\n  private handleTapGesture(point: TouchPoint, event: TouchEvent): void {\r\n    // Clear existing tap timeout\r\n    if (this.tapTimeout) {\r\n      clearTimeout(this.tapTimeout);\r\n      this.tapTimeout = null;\r\n    }\r\n\r\n    // Check for double tap\r\n    if (this.lastTap && this.isDoubleTap(this.lastTap, point)) {\r\n      this.tapCount = 2;\r\n      \r\n      // Clear double tap timeout\r\n      if (this.doubleTapTimeout) {\r\n        clearTimeout(this.doubleTapTimeout);\r\n        this.doubleTapTimeout = null;\r\n      }\r\n\r\n      const doubleTapGesture: TapGesture = {\r\n        point,\r\n        tapCount: this.tapCount\r\n      };\r\n\r\n      this.emit('doubleTap', doubleTapGesture, event);\r\n\r\n      if (this.config.debug) {\r\n        console.log('[TouchGestureHandler] Double tap detected:', doubleTapGesture);\r\n      }\r\n\r\n      // Reset tap state\r\n      this.lastTap = null;\r\n      this.tapCount = 0;\r\n    } else {\r\n      // Single tap (potentially)\r\n      this.tapCount = 1;\r\n      this.lastTap = point;\r\n\r\n      // Set timeout to emit single tap if no second tap occurs\r\n      this.doubleTapTimeout = window.setTimeout(() => {\r\n        const tapGesture: TapGesture = {\r\n          point,\r\n          tapCount: 1\r\n        };\r\n\r\n        this.emit('tap', tapGesture, event);\r\n\r\n        if (this.config.debug) {\r\n          console.log('[TouchGestureHandler] Single tap detected:', tapGesture);\r\n        }\r\n\r\n        // Reset tap state\r\n        this.lastTap = null;\r\n        this.tapCount = 0;\r\n        this.doubleTapTimeout = null;\r\n      }, this.config.doubleTapTimeout);\r\n    }\r\n  }\r\n\r\n  private isDoubleTap(firstTap: TouchPoint, secondTap: TouchPoint): boolean {\r\n    const distance = this.calculateDistance(firstTap, secondTap);\r\n    const timeDiff = secondTap.timestamp - firstTap.timestamp;\r\n    \r\n    return distance <= this.config.maxTapDistance && \r\n           timeDiff <= this.config.doubleTapTimeout;\r\n  }\r\n\r\n  private createTouchPoint(touch: Touch): TouchPoint {\r\n    return {\r\n      x: touch.clientX,\r\n      y: touch.clientY,\r\n      timestamp: Date.now()\r\n    };\r\n  }\r\n\r\n  private calculateDistance(point1: TouchPoint, point2: TouchPoint): number {\r\n    const deltaX = point2.x - point1.x;\r\n    const deltaY = point2.y - point1.y;\r\n    return Math.sqrt(deltaX * deltaX + deltaY * deltaY);\r\n  }\r\n\r\n  private emit<K extends keyof TouchGestureEvents>(\r\n    event: K,\r\n    ...args: Parameters<TouchGestureEvents[K]>\r\n  ): void {\r\n    const listeners = this.eventListeners.get(event);\r\n    if (listeners) {\r\n      for (const listener of listeners) {\r\n        try {\r\n          (listener as any)(...args);\r\n        } catch (error) {\r\n          console.error(`[TouchGestureHandler] Error in ${event} listener:`, error);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}","import { Component } from './OverlayManager';\r\nimport { OverlayState, QuickAction, SidebarProps } from '../types/overlay';\r\nimport { ThemeConfig } from '../types/theme';\r\nimport { ResponsiveManager, ViewportInfo } from './ResponsiveManager';\r\nimport { TouchGestureHandler, SwipeGesture } from './TouchGestureHandler';\r\nimport { OverlayAnimations, OverlayAnimationConfig } from './OverlayAnimations';\r\nimport { AnimationCleanup } from './AnimationSystem';\r\n\r\nexport class QuickActionSidebar implements Component {\r\n  private element: HTMLElement | null = null;\r\n  private props: SidebarProps;\r\n  private isDestroyed: boolean = false;\r\n  private slideAnimation: Animation | null = null;\r\n  private actions: QuickAction[];\r\n  private responsiveManager: ResponsiveManager | null = null;\r\n  private touchGestureHandler: TouchGestureHandler | null = null;\r\n  private currentViewport: ViewportInfo | null = null;\r\n  private overlayAnimations: OverlayAnimations;\r\n  private animationCleanups: Map<string, AnimationCleanup> = new Map();\r\n  private hoverCleanups: Map<string, () => void> = new Map();\r\n  private currentTheme: ThemeConfig | null = null;\r\n\r\n  constructor(props: SidebarProps, responsiveManager?: ResponsiveManager, overlayAnimations?: OverlayAnimations) {\r\n    this.props = props;\r\n    this.actions = this.getDefaultActions();\r\n    this.responsiveManager = responsiveManager || null;\r\n    this.overlayAnimations = overlayAnimations || new OverlayAnimations(new (require('./AnimationSystem').AnimationSystem)());\r\n    \r\n    if (this.responsiveManager) {\r\n      this.currentViewport = this.responsiveManager.getViewportInfo();\r\n    }\r\n    \r\n    // Bind methods to preserve context\r\n    this.handleActionClick = this.handleActionClick.bind(this);\r\n    this.handleCloseClick = this.handleCloseClick.bind(this);\r\n    this.handleBackdropClick = this.handleBackdropClick.bind(this);\r\n    this.handleSwipeGesture = this.handleSwipeGesture.bind(this);\r\n    this.handleViewportChange = this.handleViewportChange.bind(this);\r\n  }\r\n\r\n  public render(): HTMLElement {\r\n    if (this.isDestroyed) {\r\n      throw new Error('QuickActionSidebar has been destroyed');\r\n    }\r\n\r\n    // Create or update the sidebar element\r\n    if (!this.element) {\r\n      this.element = this.createElement();\r\n      this.setupResponsiveHandling();\r\n      this.setupTouchGestures();\r\n    }\r\n\r\n    this.updateElement();\r\n    return this.element;\r\n  }\r\n\r\n  public update(state: OverlayState): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    const newProps: SidebarProps = {\r\n      ...this.props,\r\n      visible: state.sidebarVisible,\r\n      selectedImage: state.selectedImage,\r\n      isProcessing: state.isProcessing,\r\n      currentAction: state.currentAction\r\n    };\r\n\r\n    const wasVisible = this.props.visible;\r\n    const isVisible = newProps.visible;\r\n\r\n    this.props = newProps;\r\n\r\n    if (this.element) {\r\n      // Handle visibility changes with animations\r\n      if (!wasVisible && isVisible) {\r\n        this.slideIn();\r\n      } else if (wasVisible && !isVisible) {\r\n        this.slideOut();\r\n      } else if (isVisible) {\r\n        this.updateElement();\r\n      }\r\n    }\r\n  }\r\n\r\n  public destroy(): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    this.isDestroyed = true;\r\n\r\n    // Cancel any running animations\r\n    if (this.slideAnimation) {\r\n      this.slideAnimation.cancel();\r\n      this.slideAnimation = null;\r\n    }\r\n\r\n    // Clean up animation system\r\n    this.animationCleanups.forEach(cleanup => cleanup.cancel());\r\n    this.animationCleanups.clear();\r\n\r\n    // Clean up hover animations\r\n    this.hoverCleanups.forEach(cleanup => cleanup());\r\n    this.hoverCleanups.clear();\r\n\r\n    // Clean up overlay animations\r\n    this.overlayAnimations.cleanup();\r\n\r\n    // Destroy touch gesture handler\r\n    if (this.touchGestureHandler) {\r\n      this.touchGestureHandler.destroy();\r\n      this.touchGestureHandler = null;\r\n    }\r\n\r\n    // Remove responsive manager listeners\r\n    if (this.responsiveManager) {\r\n      this.responsiveManager.off('viewportResized', this.handleViewportChange);\r\n      this.responsiveManager.off('breakpointChanged', this.handleViewportChange);\r\n    }\r\n\r\n    // Remove element from DOM\r\n    if (this.element && this.element.parentNode) {\r\n      this.element.parentNode.removeChild(this.element);\r\n    }\r\n\r\n    this.element = null;\r\n    this.currentViewport = null;\r\n  }\r\n\r\n  public updateTheme(theme: ThemeConfig): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    this.currentTheme = theme;\r\n\r\n    if (this.element) {\r\n      this.applyThemeStyles();\r\n    }\r\n  }\r\n\r\n  public setCustomActions(actions: QuickAction[]): void {\r\n    this.actions = [...this.getDefaultActions(), ...actions];\r\n    \r\n    if (this.element && this.props.visible) {\r\n      this.updateActionButtons();\r\n    }\r\n  }\r\n\r\n  private createElement(): HTMLElement {\r\n    const sidebar = document.createElement('div');\r\n    sidebar.className = 'dino-quick-action-sidebar';\r\n    \r\n    // Apply base styles\r\n    this.applyBaseStyles(sidebar);\r\n\r\n    // Create backdrop\r\n    const backdrop = this.createBackdrop();\r\n    sidebar.appendChild(backdrop);\r\n\r\n    // Create sidebar panel\r\n    const panel = this.createSidebarPanel();\r\n    sidebar.appendChild(panel);\r\n\r\n    return sidebar;\r\n  }\r\n\r\n  private createBackdrop(): HTMLElement {\r\n    const backdrop = document.createElement('div');\r\n    backdrop.className = 'dino-sidebar-backdrop';\r\n    \r\n    Object.assign(backdrop.style, {\r\n      position: 'fixed',\r\n      top: '0',\r\n      left: '0',\r\n      right: '0',\r\n      bottom: '0',\r\n      backgroundColor: 'rgba(0, 0, 0, 0.2)',\r\n      backdropFilter: 'blur(2px)',\r\n      WebkitBackdropFilter: 'blur(2px)',\r\n      zIndex: '999998',\r\n      opacity: '0',\r\n      transition: 'opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1)',\r\n      cursor: 'pointer'\r\n    });\r\n\r\n    backdrop.addEventListener('click', this.handleBackdropClick);\r\n\r\n    return backdrop;\r\n  }\r\n\r\n  private createSidebarPanel(): HTMLElement {\r\n    const panel = document.createElement('div');\r\n    panel.className = 'dino-sidebar-panel';\r\n    \r\n    // Apply glassmorphic panel styles\r\n    this.applySidebarPanelStyles(panel);\r\n\r\n    // Create header\r\n    const header = this.createSidebarHeader();\r\n    panel.appendChild(header);\r\n\r\n    // Create actions container\r\n    const actionsContainer = this.createActionsContainer();\r\n    panel.appendChild(actionsContainer);\r\n\r\n    return panel;\r\n  }\r\n\r\n  private createSidebarHeader(): HTMLElement {\r\n    const header = document.createElement('div');\r\n    header.className = 'dino-sidebar-header';\r\n    \r\n    Object.assign(header.style, {\r\n      padding: '20px 24px 16px',\r\n      borderBottom: '1px solid rgba(255, 255, 255, 0.1)',\r\n      marginBottom: '16px'\r\n    });\r\n\r\n    // Create title\r\n    const title = document.createElement('h3');\r\n    title.textContent = 'Quick Actions';\r\n    title.className = 'dino-sidebar-title';\r\n    \r\n    Object.assign(title.style, {\r\n      margin: '0',\r\n      fontSize: '18px',\r\n      fontWeight: '600',\r\n      color: 'var(--dino-glass-text)',\r\n      lineHeight: '1.2'\r\n    });\r\n\r\n    // Create subtitle\r\n    const subtitle = document.createElement('p');\r\n    subtitle.textContent = 'Transform your room with AI';\r\n    subtitle.className = 'dino-sidebar-subtitle';\r\n    \r\n    Object.assign(subtitle.style, {\r\n      margin: '4px 0 0',\r\n      fontSize: '14px',\r\n      color: 'var(--dino-glass-text-secondary)',\r\n      lineHeight: '1.3'\r\n    });\r\n\r\n    // Create close button\r\n    const closeButton = this.createCloseButton();\r\n\r\n    header.appendChild(title);\r\n    header.appendChild(subtitle);\r\n    header.appendChild(closeButton);\r\n\r\n    return header;\r\n  }\r\n\r\n  private createCloseButton(): HTMLElement {\r\n    const button = document.createElement('button');\r\n    button.className = 'dino-sidebar-close';\r\n    button.innerHTML = '';\r\n    button.setAttribute('aria-label', 'Close sidebar');\r\n    \r\n    Object.assign(button.style, {\r\n      position: 'absolute',\r\n      top: '16px',\r\n      right: '16px',\r\n      width: '32px',\r\n      height: '32px',\r\n      borderRadius: '50%',\r\n      border: 'none',\r\n      \r\n      // Glassmorphic button styling\r\n      background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05))',\r\n      backdropFilter: 'blur(10px)',\r\n      WebkitBackdropFilter: 'blur(10px)',\r\n      \r\n      // Typography\r\n      color: 'var(--dino-glass-text)',\r\n      fontSize: '20px',\r\n      fontWeight: 'normal',\r\n      lineHeight: '1',\r\n      \r\n      // Interactive styles\r\n      cursor: 'pointer',\r\n      \r\n      // Shadow and effects\r\n      boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)',\r\n      \r\n      // Smooth transitions\r\n      transition: 'all 0.2s cubic-bezier(0.4, 0, 0.2, 1)',\r\n      transform: 'scale(1)'\r\n    });\r\n\r\n    // Add hover and active states\r\n    button.addEventListener('mouseenter', () => {\r\n      if (!this.isDestroyed) {\r\n        Object.assign(button.style, {\r\n          background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08))',\r\n          transform: 'scale(1.05)',\r\n          color: 'rgba(255, 255, 255, 1)'\r\n        });\r\n      }\r\n    });\r\n\r\n    button.addEventListener('mouseleave', () => {\r\n      if (!this.isDestroyed) {\r\n        Object.assign(button.style, {\r\n          background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05))',\r\n          transform: 'scale(1)',\r\n          color: 'rgba(255, 255, 255, 0.8)'\r\n        });\r\n      }\r\n    });\r\n\r\n    button.addEventListener('click', this.handleCloseClick);\r\n\r\n    return button;\r\n  }\r\n\r\n  private createActionsContainer(): HTMLElement {\r\n    const container = document.createElement('div');\r\n    container.className = 'dino-actions-container';\r\n    \r\n    Object.assign(container.style, {\r\n      padding: '0 24px 24px',\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n      gap: '12px',\r\n      maxHeight: 'calc(100vh - 200px)',\r\n      overflowY: 'auto'\r\n    });\r\n\r\n    // Add custom scrollbar styles\r\n    container.style.scrollbarWidth = 'thin';\r\n    container.style.scrollbarColor = 'rgba(255, 255, 255, 0.3) transparent';\r\n\r\n    this.updateActionButtons(container);\r\n\r\n    return container;\r\n  }\r\n\r\n  private updateActionButtons(container?: HTMLElement): void {\r\n    if (!container) {\r\n      const existingContainer = this.element?.querySelector('.dino-actions-container') as HTMLElement;\r\n      if (!existingContainer) return;\r\n      container = existingContainer;\r\n    }\r\n\r\n    // Clear existing buttons\r\n    container.innerHTML = '';\r\n\r\n    // Create action buttons\r\n    this.actions.forEach(action => {\r\n      const button = this.createActionButton(action);\r\n      container.appendChild(button);\r\n    });\r\n\r\n    // Animate staggered appearance of buttons\r\n    if (this.props.visible) {\r\n      const staggerCleanups = this.overlayAnimations.animateStaggeredList(container, {\r\n        duration: 300,\r\n        stagger: 50,\r\n        respectsReducedMotion: true\r\n      });\r\n      \r\n      staggerCleanups.forEach((cleanup, index) => {\r\n        this.animationCleanups.set(`stagger-${index}`, cleanup);\r\n      });\r\n    }\r\n  }\r\n\r\n  private createActionButton(action: QuickAction): HTMLElement {\r\n    const button = document.createElement('button');\r\n    button.className = 'dino-action-button';\r\n    button.setAttribute('data-action-id', action.id);\r\n    \r\n    // Apply glassmorphic button styles\r\n    this.applyActionButtonStyles(button);\r\n\r\n    // Create button content\r\n    const content = this.createButtonContent(action);\r\n    button.appendChild(content);\r\n\r\n    // Add click handler\r\n    button.addEventListener('click', () => this.handleActionClick(action));\r\n\r\n    // Setup hover and focus animations\r\n    const hoverCleanup = this.overlayAnimations.setupButtonHoverAnimation(button, {\r\n      duration: 200,\r\n      respectsReducedMotion: true\r\n    });\r\n    \r\n    const focusCleanup = this.overlayAnimations.setupButtonFocusAnimation(button, {\r\n      duration: 200,\r\n      respectsReducedMotion: true\r\n    });\r\n\r\n    // Store cleanup functions (ensure they are functions)\r\n    if (typeof hoverCleanup === 'function') {\r\n      this.hoverCleanups.set(`hover-${action.id}`, hoverCleanup);\r\n    }\r\n    if (typeof focusCleanup === 'function') {\r\n      this.hoverCleanups.set(`focus-${action.id}`, focusCleanup);\r\n    }\r\n\r\n    return button;\r\n  }\r\n\r\n  private createButtonContent(action: QuickAction): HTMLElement {\r\n    const content = document.createElement('div');\r\n    content.className = 'dino-button-content';\r\n    \r\n    Object.assign(content.style, {\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      gap: '12px',\r\n      width: '100%'\r\n    });\r\n\r\n    // Create icon\r\n    const icon = document.createElement('div');\r\n    icon.className = 'dino-action-icon';\r\n    icon.innerHTML = action.icon;\r\n    \r\n    Object.assign(icon.style, {\r\n      fontSize: '20px',\r\n      lineHeight: '1',\r\n      flexShrink: '0',\r\n      width: '24px',\r\n      height: '24px',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center'\r\n    });\r\n\r\n    // Create text content\r\n    const textContent = document.createElement('div');\r\n    textContent.className = 'dino-action-text';\r\n    \r\n    Object.assign(textContent.style, {\r\n      flex: '1',\r\n      textAlign: 'left'\r\n    });\r\n\r\n    // Create label\r\n    const label = document.createElement('div');\r\n    label.className = 'dino-action-label';\r\n    label.textContent = action.label;\r\n    \r\n    Object.assign(label.style, {\r\n      fontSize: '16px',\r\n      fontWeight: '500',\r\n      color: 'var(--dino-glass-text)',\r\n      lineHeight: '1.2',\r\n      marginBottom: '2px'\r\n    });\r\n\r\n    // Create description (derived from prompt)\r\n    const description = document.createElement('div');\r\n    description.className = 'dino-action-description';\r\n    description.textContent = this.getActionDescription(action);\r\n    \r\n    Object.assign(description.style, {\r\n      fontSize: '13px',\r\n      color: 'var(--dino-glass-text-secondary)',\r\n      lineHeight: '1.3'\r\n    });\r\n\r\n    textContent.appendChild(label);\r\n    textContent.appendChild(description);\r\n\r\n    content.appendChild(icon);\r\n    content.appendChild(textContent);\r\n\r\n    return content;\r\n  }\r\n\r\n  private applyBaseStyles(element: HTMLElement): void {\r\n    Object.assign(element.style, {\r\n      position: 'fixed',\r\n      top: '0',\r\n      left: '0',\r\n      right: '0',\r\n      bottom: '0',\r\n      zIndex: '999999',\r\n      display: 'none',\r\n      pointerEvents: 'none'\r\n    });\r\n  }\r\n\r\n  private applySidebarPanelStyles(element: HTMLElement): void {\r\n    const isMobile = this.currentViewport?.isMobile || false;\r\n    const isTablet = this.currentViewport?.isTablet || false;\r\n    const isTouchDevice = this.currentViewport?.isTouchDevice || false;\r\n    \r\n    // Get optimal width from responsive manager\r\n    const width = this.responsiveManager?.getOptimalSidebarWidth() || 320;\r\n    \r\n    // Add theme-aware class\r\n    element.className = 'dino-sidebar-panel dino-sidebar';\r\n    \r\n    Object.assign(element.style, {\r\n      position: 'fixed',\r\n      top: '0',\r\n      right: '0',\r\n      width: isMobile ? '100vw' : `${width}px`,\r\n      maxWidth: isMobile ? 'none' : '90vw',\r\n      height: '100vh',\r\n      \r\n      // Use CSS custom properties for theme-aware styling\r\n      background: 'var(--dino-glass-bg)',\r\n      backdropFilter: 'var(--dino-glass-backdrop)',\r\n      WebkitBackdropFilter: 'var(--dino-glass-backdrop)',\r\n      border: '1px solid var(--dino-glass-border)',\r\n      borderRight: isMobile ? '1px solid var(--dino-glass-border)' : 'none',\r\n      \r\n      // Shadow effects using theme variables\r\n      boxShadow: isMobile \r\n        ? '0 -8px 32px var(--dino-glass-shadow)'\r\n        : '-8px 0 32px var(--dino-glass-shadow), inset 1px 0 0 var(--dino-glass-border)',\r\n      \r\n      // Transform for animation\r\n      transform: isMobile ? 'translateY(100%)' : 'translateX(100%)',\r\n      transition: 'transform var(--dino-duration-normal) var(--dino-easing-ease)',\r\n      \r\n      // Ensure proper rendering\r\n      willChange: 'transform',\r\n      pointerEvents: 'auto',\r\n      \r\n      // Mobile-specific positioning\r\n      ...(isMobile && {\r\n        bottom: '0',\r\n        top: 'auto',\r\n        height: 'auto',\r\n        maxHeight: '80vh',\r\n        borderRadius: '16px 16px 0 0',\r\n        borderBottom: 'none'\r\n      }),\r\n      \r\n      // Touch-friendly scrolling\r\n      ...(isTouchDevice && {\r\n        WebkitOverflowScrolling: 'touch',\r\n        overscrollBehavior: 'contain'\r\n      })\r\n    });\r\n  }\r\n\r\n  private applyActionButtonStyles(element: HTMLElement): void {\r\n    const isTouchDevice = this.currentViewport?.isTouchDevice || false;\r\n    const touchTargetSize = this.responsiveManager?.getTouchTargetSize() || 44;\r\n    \r\n    // Add theme-aware class\r\n    element.className = 'dino-action-button dino-button';\r\n    \r\n    Object.assign(element.style, {\r\n      width: '100%',\r\n      padding: isTouchDevice ? '18px 16px' : '16px',\r\n      minHeight: isTouchDevice ? `${touchTargetSize}px` : 'auto',\r\n      border: 'none',\r\n      borderRadius: '12px',\r\n      \r\n      // Use CSS custom properties for theme-aware styling\r\n      background: 'var(--dino-glass-bg)',\r\n      backdropFilter: 'var(--dino-glass-backdrop)',\r\n      WebkitBackdropFilter: 'var(--dino-glass-backdrop)',\r\n      border: '1px solid var(--dino-glass-border)',\r\n      color: 'var(--dino-glass-text)',\r\n      \r\n      // Interactive styles\r\n      cursor: 'pointer',\r\n      \r\n      // Shadow and effects\r\n      boxShadow: '0 2px 8px var(--dino-glass-shadow)',\r\n      \r\n      // Smooth transitions using theme variables\r\n      transition: 'all var(--dino-duration-fast) var(--dino-easing-ease)',\r\n      transform: 'scale(1)',\r\n      \r\n      // Typography\r\n      textAlign: 'left',\r\n      \r\n      // Touch-friendly styles\r\n      ...(isTouchDevice && {\r\n        WebkitTapHighlightColor: 'transparent',\r\n        touchAction: 'manipulation',\r\n        userSelect: 'none',\r\n        WebkitUserSelect: 'none'\r\n      }),\r\n      \r\n      // Ensure proper rendering\r\n      willChange: 'transform, background, box-shadow'\r\n    });\r\n\r\n    // Add hover and active states using theme variables\r\n    element.addEventListener('mouseenter', () => {\r\n      if (!this.isDestroyed && !this.isButtonDisabled(element)) {\r\n        Object.assign(element.style, {\r\n          background: 'var(--dino-glass-accent)',\r\n          transform: 'scale(1.02)',\r\n          boxShadow: '0 4px 16px var(--dino-glass-shadow), 0 0 0 1px var(--dino-glass-border)'\r\n        });\r\n      }\r\n    });\r\n\r\n    element.addEventListener('mouseleave', () => {\r\n      if (!this.isDestroyed && !this.isButtonDisabled(element)) {\r\n        Object.assign(element.style, {\r\n          background: 'var(--dino-glass-bg)',\r\n          transform: 'scale(1)',\r\n          boxShadow: '0 2px 8px var(--dino-glass-shadow)'\r\n        });\r\n      }\r\n    });\r\n\r\n    element.addEventListener('mousedown', () => {\r\n      if (!this.isDestroyed && !this.isButtonDisabled(element)) {\r\n        element.style.transform = 'scale(0.98)';\r\n      }\r\n    });\r\n\r\n    element.addEventListener('mouseup', () => {\r\n      if (!this.isDestroyed && !this.isButtonDisabled(element)) {\r\n        element.style.transform = 'scale(1.02)';\r\n      }\r\n    });\r\n  }\r\n\r\n  private updateElement(): void {\r\n    if (!this.element || this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    const { visible, isProcessing, currentAction } = this.props;\r\n\r\n    if (!visible) {\r\n      this.element.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    this.element.style.display = 'block';\r\n\r\n    // Update processing states\r\n    this.updateProcessingStates(isProcessing, currentAction);\r\n  }\r\n\r\n  private updateProcessingStates(isProcessing?: boolean, currentAction?: string | null): void {\r\n    if (!this.element) return;\r\n\r\n    const buttons = this.element.querySelectorAll('.dino-action-button') as NodeListOf<HTMLElement>;\r\n    \r\n    buttons.forEach(button => {\r\n      const actionId = button.getAttribute('data-action-id');\r\n      const isCurrentAction = actionId === currentAction;\r\n      \r\n      if (isProcessing && isCurrentAction) {\r\n        this.setButtonLoading(button, true);\r\n      } else {\r\n        this.setButtonLoading(button, false);\r\n        this.setButtonDisabled(button, isProcessing || false);\r\n      }\r\n    });\r\n  }\r\n\r\n  private setButtonLoading(button: HTMLElement, loading: boolean): void {\r\n    const actionId = button.getAttribute('data-action-id') || 'unknown';\r\n    \r\n    // Use the new animation system for loading states\r\n    const loadingCleanup = this.overlayAnimations.animateLoadingState(button, loading, {\r\n      duration: 1000,\r\n      respectsReducedMotion: true\r\n    });\r\n\r\n    if (loading) {\r\n      this.animationCleanups.set(`loading-${actionId}`, loadingCleanup);\r\n      \r\n      // Update button styles for loading state\r\n      Object.assign(button.style, {\r\n        background: 'linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.1))',\r\n        border: '1px solid rgba(59, 130, 246, 0.3)',\r\n        cursor: 'not-allowed'\r\n      });\r\n    } else {\r\n      // Clean up loading animation\r\n      this.animationCleanups.delete(`loading-${actionId}`);\r\n      \r\n      // Restore original icon\r\n      const icon = button.querySelector('.dino-action-icon') as HTMLElement;\r\n      const action = this.actions.find(a => a.id === actionId);\r\n      if (action && icon) {\r\n        icon.innerHTML = action.icon;\r\n      }\r\n      \r\n      // Restore normal button styles\r\n      this.applyActionButtonStyles(button);\r\n    }\r\n  }\r\n\r\n  private setButtonDisabled(button: HTMLElement, disabled: boolean): void {\r\n    if (disabled) {\r\n      Object.assign(button.style, {\r\n        opacity: '0.5',\r\n        cursor: 'not-allowed',\r\n        pointerEvents: 'none'\r\n      });\r\n    } else {\r\n      Object.assign(button.style, {\r\n        opacity: '1',\r\n        cursor: 'pointer',\r\n        pointerEvents: 'auto'\r\n      });\r\n    }\r\n  }\r\n\r\n  private isButtonDisabled(button: HTMLElement): boolean {\r\n    return button.style.cursor === 'not-allowed';\r\n  }\r\n\r\n  private createLoadingSpinner(): HTMLElement {\r\n    const spinner = document.createElement('div');\r\n    spinner.className = 'dino-loading-spinner';\r\n    \r\n    Object.assign(spinner.style, {\r\n      width: '20px',\r\n      height: '20px',\r\n      border: '2px solid rgba(255, 255, 255, 0.3)',\r\n      borderTop: '2px solid rgba(255, 255, 255, 0.8)',\r\n      borderRadius: '50%',\r\n      animation: 'spin 1s linear infinite'\r\n    });\r\n\r\n    // Add spin animation\r\n    const style = document.createElement('style');\r\n    style.textContent = `\r\n      @keyframes spin {\r\n        0% { transform: rotate(0deg); }\r\n        100% { transform: rotate(360deg); }\r\n      }\r\n    `;\r\n    \r\n    if (!document.head.querySelector('style[data-dino-spinner]')) {\r\n      style.setAttribute('data-dino-spinner', 'true');\r\n      document.head.appendChild(style);\r\n    }\r\n\r\n    return spinner;\r\n  }\r\n\r\n  private slideIn(): void {\r\n    if (!this.element || this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    // Cancel any existing animation\r\n    if (this.slideAnimation) {\r\n      this.slideAnimation.cancel();\r\n    }\r\n\r\n    const isMobile = this.currentViewport?.isMobile || false;\r\n    \r\n    // Use the new animation system\r\n    const cleanup = this.overlayAnimations.animateSidebarIn(this.element, isMobile, {\r\n      duration: isMobile ? 400 : 300,\r\n      easing: 'cubic-bezier(0.34, 1.56, 0.64, 1)',\r\n      respectsReducedMotion: true\r\n    });\r\n\r\n    this.animationCleanups.set('slide-in', cleanup);\r\n  }\r\n\r\n  private slideOut(): void {\r\n    if (!this.element || this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    // Cancel any existing animation\r\n    if (this.slideAnimation) {\r\n      this.slideAnimation.cancel();\r\n    }\r\n\r\n    const isMobile = this.currentViewport?.isMobile || false;\r\n    \r\n    // Use the new animation system\r\n    const cleanup = this.overlayAnimations.animateSidebarOut(this.element, isMobile, {\r\n      duration: isMobile ? 350 : 250,\r\n      easing: 'cubic-bezier(0.4, 0, 1, 1)',\r\n      respectsReducedMotion: true\r\n    });\r\n\r\n    this.animationCleanups.set('slide-out', cleanup);\r\n\r\n    // Hide element after animation completes\r\n    setTimeout(() => {\r\n      if (!this.isDestroyed && this.element) {\r\n        this.element.style.display = 'none';\r\n        this.element.style.pointerEvents = 'none';\r\n      }\r\n    }, isMobile ? 350 : 250);\r\n  }\r\n\r\n  private getDefaultActions(): QuickAction[] {\r\n    return [\r\n      {\r\n        id: 'minimalist',\r\n        label: 'Minimalist Style',\r\n        icon: '',\r\n        prompt: 'Transform this room into a minimalist style with clean lines, neutral colors, and uncluttered space',\r\n        category: 'style'\r\n      },\r\n      {\r\n        id: 'scandi',\r\n        label: 'Scandinavian Style',\r\n        icon: '',\r\n        prompt: 'Apply Scandinavian design with light woods, cozy textures, and hygge elements',\r\n        category: 'style'\r\n      },\r\n      {\r\n        id: 'modern',\r\n        label: 'Modern Contemporary',\r\n        icon: '',\r\n        prompt: 'Create a modern contemporary look with sleek furniture and bold accents',\r\n        category: 'style'\r\n      },\r\n      {\r\n        id: 'add-sofa',\r\n        label: 'Add Sofa',\r\n        icon: '',\r\n        prompt: 'Add a stylish sofa that complements the room\\'s existing design and color scheme',\r\n        category: 'furniture'\r\n      },\r\n      {\r\n        id: 'add-furniture',\r\n        label: 'Add Furniture',\r\n        icon: '',\r\n        prompt: 'Add appropriate furniture pieces to make this room more functional and inviting',\r\n        category: 'furniture'\r\n      },\r\n      {\r\n        id: 'lighting',\r\n        label: 'Improve Lighting',\r\n        icon: '',\r\n        prompt: 'Enhance the room\\'s lighting with modern fixtures and ambient lighting solutions',\r\n        category: 'lighting'\r\n      },\r\n      {\r\n        id: 'plants',\r\n        label: 'Add Plants',\r\n        icon: '',\r\n        prompt: 'Add indoor plants and greenery to bring life and freshness to the space',\r\n        category: 'decor'\r\n      },\r\n      {\r\n        id: 'artwork',\r\n        label: 'Add Artwork',\r\n        icon: '',\r\n        prompt: 'Add tasteful artwork and wall decorations that complement the room\\'s style',\r\n        category: 'decor'\r\n      }\r\n    ];\r\n  }\r\n\r\n  private getActionDescription(action: QuickAction): string {\r\n    const descriptions: Record<string, string> = {\r\n      'minimalist': 'Clean, uncluttered aesthetic',\r\n      'scandi': 'Cozy Nordic design elements',\r\n      'modern': 'Sleek contemporary styling',\r\n      'add-sofa': 'Perfect seating solution',\r\n      'add-furniture': 'Complete the room setup',\r\n      'lighting': 'Brighten and enhance mood',\r\n      'plants': 'Natural greenery and life',\r\n      'artwork': 'Personalize with wall art'\r\n    };\r\n\r\n    return descriptions[action.id] || 'Transform your space';\r\n  }\r\n\r\n  private handleActionClick(action: QuickAction): void {\r\n    if (this.isDestroyed || this.props.isProcessing) {\r\n      return;\r\n    }\r\n\r\n    this.props.onActionClick(action);\r\n  }\r\n\r\n  private handleCloseClick(event: Event): void {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    \r\n    if (!this.isDestroyed) {\r\n      this.props.onClose();\r\n    }\r\n  }\r\n\r\n  private handleBackdropClick(event: Event): void {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    \r\n    if (!this.isDestroyed) {\r\n      this.props.onClose();\r\n    }\r\n  }\r\n\r\n  private setupResponsiveHandling(): void {\r\n    if (!this.responsiveManager) {\r\n      return;\r\n    }\r\n\r\n    // Listen for viewport changes\r\n    this.responsiveManager.on('viewportResized', this.handleViewportChange);\r\n    this.responsiveManager.on('breakpointChanged', this.handleViewportChange);\r\n  }\r\n\r\n  private setupTouchGestures(): void {\r\n    if (!this.element || !this.currentViewport?.isTouchDevice) {\r\n      return;\r\n    }\r\n\r\n    this.touchGestureHandler = new TouchGestureHandler(this.element, {\r\n      swipeThreshold: 50,\r\n      swipeVelocityThreshold: 0.3,\r\n      debug: false\r\n    });\r\n\r\n    this.touchGestureHandler.on('swipe', this.handleSwipeGesture);\r\n    this.touchGestureHandler.initialize();\r\n  }\r\n\r\n  private handleViewportChange(viewport: ViewportInfo): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    const previousViewport = this.currentViewport;\r\n    this.currentViewport = viewport;\r\n\r\n    // Update styles if breakpoint changed\r\n    if (!previousViewport || \r\n        previousViewport.isMobile !== viewport.isMobile ||\r\n        previousViewport.isTablet !== viewport.isTablet) {\r\n      this.updateResponsiveStyles();\r\n    }\r\n  }\r\n\r\n  private handleSwipeGesture(gesture: SwipeGesture): void {\r\n    if (this.isDestroyed || !this.props.visible) {\r\n      return;\r\n    }\r\n\r\n    const isMobile = this.currentViewport?.isMobile || false;\r\n    \r\n    // Close sidebar on swipe gestures\r\n    if (isMobile && gesture.direction === 'down') {\r\n      // Swipe down to close on mobile (bottom sheet style)\r\n      this.props.onClose();\r\n    } else if (!isMobile && gesture.direction === 'right') {\r\n      // Swipe right to close on desktop/tablet\r\n      this.props.onClose();\r\n    }\r\n  }\r\n\r\n  private updateResponsiveStyles(): void {\r\n    if (!this.element || !this.currentViewport) {\r\n      return;\r\n    }\r\n\r\n    const panel = this.element.querySelector('.dino-sidebar-panel') as HTMLElement;\r\n    if (panel) {\r\n      this.applySidebarPanelStyles(panel);\r\n    }\r\n\r\n    // Update button styles for touch devices\r\n    const buttons = this.element.querySelectorAll('.dino-action-button') as NodeListOf<HTMLElement>;\r\n    buttons.forEach(button => {\r\n      this.applyActionButtonStyles(button);\r\n    });\r\n\r\n    // Update close button for touch devices\r\n    const closeButton = this.element.querySelector('.dino-sidebar-close') as HTMLElement;\r\n    if (closeButton) {\r\n      this.updateCloseButtonForTouch(closeButton);\r\n    }\r\n  }\r\n\r\n  private updateCloseButtonForTouch(button: HTMLElement): void {\r\n    const isTouchDevice = this.currentViewport?.isTouchDevice || false;\r\n    const touchTargetSize = this.responsiveManager?.getTouchTargetSize() || 44;\r\n\r\n    if (isTouchDevice) {\r\n      Object.assign(button.style, {\r\n        width: `${touchTargetSize}px`,\r\n        height: `${touchTargetSize}px`,\r\n        fontSize: '24px',\r\n        WebkitTapHighlightColor: 'transparent',\r\n        touchAction: 'manipulation'\r\n      });\r\n    }\r\n  }\r\n\r\n  private applyThemeStyles(): void {\r\n    if (!this.element || !this.currentTheme) {\r\n      return;\r\n    }\r\n\r\n    // Update panel styles\r\n    const panel = this.element.querySelector('.dino-sidebar-panel') as HTMLElement;\r\n    if (panel) {\r\n      this.applySidebarPanelStyles(panel);\r\n    }\r\n\r\n    // Update backdrop styles\r\n    const backdrop = this.element.querySelector('.dino-sidebar-backdrop') as HTMLElement;\r\n    if (backdrop) {\r\n      Object.assign(backdrop.style, {\r\n        backgroundColor: this.currentTheme.mode === 'dark' \r\n          ? 'rgba(0, 0, 0, 0.4)' \r\n          : 'rgba(0, 0, 0, 0.2)'\r\n      });\r\n    }\r\n\r\n    // Update header text colors\r\n    const title = this.element.querySelector('.dino-sidebar-title') as HTMLElement;\r\n    if (title) {\r\n      title.style.color = 'var(--dino-glass-text)';\r\n    }\r\n\r\n    const subtitle = this.element.querySelector('.dino-sidebar-subtitle') as HTMLElement;\r\n    if (subtitle) {\r\n      subtitle.style.color = 'var(--dino-glass-text-secondary)';\r\n    }\r\n\r\n    // Update close button\r\n    const closeButton = this.element.querySelector('.dino-sidebar-close') as HTMLElement;\r\n    if (closeButton) {\r\n      Object.assign(closeButton.style, {\r\n        background: 'var(--dino-glass-bg)',\r\n        color: 'var(--dino-glass-text)',\r\n        border: '1px solid var(--dino-glass-border)'\r\n      });\r\n    }\r\n\r\n    // Update action buttons\r\n    const buttons = this.element.querySelectorAll('.dino-action-button') as NodeListOf<HTMLElement>;\r\n    buttons.forEach(button => {\r\n      this.applyActionButtonStyles(button);\r\n      \r\n      // Update text colors\r\n      const label = button.querySelector('.dino-action-label') as HTMLElement;\r\n      if (label) {\r\n        label.style.color = 'var(--dino-glass-text)';\r\n      }\r\n      \r\n      const description = button.querySelector('.dino-action-description') as HTMLElement;\r\n      if (description) {\r\n        description.style.color = 'var(--dino-glass-text-secondary)';\r\n      }\r\n    });\r\n  }\r\n}","import { Component } from './OverlayManager';\r\nimport { OverlayState, ChatBarProps, Position } from '../types/overlay';\r\nimport { ResponsiveManager, ViewportInfo } from './ResponsiveManager';\r\nimport { OverlayAnimations, OverlayAnimationConfig } from './OverlayAnimations';\r\nimport { AnimationCleanup } from './AnimationSystem';\r\n\r\nexport class FloatingChatBar implements Component {\r\n  private element: HTMLElement | null = null;\r\n  private inputElement: HTMLInputElement | null = null;\r\n  private sendButton: HTMLButtonElement | null = null;\r\n  private typingIndicator: HTMLElement | null = null;\r\n  private props: ChatBarProps;\r\n  private isVisible: boolean = false;\r\n  private isAnimating: boolean = false;\r\n  private responsiveManager: ResponsiveManager | null = null;\r\n  private currentViewport: ViewportInfo | null = null;\r\n  private overlayAnimations: OverlayAnimations;\r\n  private animationCleanups: Map<string, AnimationCleanup> = new Map();\r\n  private hoverCleanups: Map<string, () => void> = new Map();\r\n\r\n  constructor(props: ChatBarProps, responsiveManager?: ResponsiveManager, overlayAnimations?: OverlayAnimations) {\r\n    this.props = { ...props };\r\n    this.responsiveManager = responsiveManager || null;\r\n    this.overlayAnimations = overlayAnimations || new OverlayAnimations(new (require('./AnimationSystem').AnimationSystem)());\r\n    \r\n    if (this.responsiveManager) {\r\n      this.currentViewport = this.responsiveManager.getViewportInfo();\r\n    }\r\n    \r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n    this.handleKeyPress = this.handleKeyPress.bind(this);\r\n    this.handleInputChange = this.handleInputChange.bind(this);\r\n    this.handleSendClick = this.handleSendClick.bind(this);\r\n    this.handleViewportChange = this.handleViewportChange.bind(this);\r\n  }\r\n\r\n  public render(): HTMLElement {\r\n    if (this.element) {\r\n      return this.element;\r\n    }\r\n\r\n    this.element = this.createElement();\r\n    this.setupResponsiveHandling();\r\n    this.updateVisibility();\r\n    return this.element;\r\n  }\r\n\r\n  public update(state: OverlayState): void {\r\n    const newProps: ChatBarProps = {\r\n      visible: state.chatBarVisible,\r\n      selectedImage: state.selectedImage,\r\n      onSubmit: this.props.onSubmit,\r\n      onClose: this.props.onClose,\r\n      isProcessing: state.isProcessing,\r\n      placeholder: this.props.placeholder\r\n    };\r\n\r\n    this.updateProps(newProps);\r\n  }\r\n\r\n  public destroy(): void {\r\n    // Clean up animations\r\n    this.animationCleanups.forEach(cleanup => cleanup.cancel());\r\n    this.animationCleanups.clear();\r\n\r\n    // Clean up hover animations\r\n    this.hoverCleanups.forEach(cleanup => cleanup());\r\n    this.hoverCleanups.clear();\r\n\r\n    // Clean up overlay animations\r\n    this.overlayAnimations.cleanup();\r\n\r\n    // Remove responsive manager listeners\r\n    if (this.responsiveManager) {\r\n      this.responsiveManager.off('viewportResized', this.handleViewportChange);\r\n      this.responsiveManager.off('breakpointChanged', this.handleViewportChange);\r\n    }\r\n\r\n    if (this.element) {\r\n      this.element.remove();\r\n      this.element = null;\r\n      this.inputElement = null;\r\n      this.sendButton = null;\r\n      this.typingIndicator = null;\r\n    }\r\n\r\n    this.currentViewport = null;\r\n  }\r\n\r\n  public updateProps(newProps: Partial<ChatBarProps>): void {\r\n    const prevVisible = this.props.visible;\r\n    this.props = { ...this.props, ...newProps };\r\n\r\n    if (this.element) {\r\n      this.updateVisibility();\r\n      this.updateProcessingState();\r\n      this.updatePlaceholder();\r\n      \r\n      // Handle visibility changes\r\n      if (prevVisible !== this.props.visible) {\r\n        if (this.props.visible) {\r\n          this.show();\r\n        } else {\r\n          this.hide();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public focusInput(): void {\r\n    if (this.inputElement && this.props.visible) {\r\n      setTimeout(() => {\r\n        this.inputElement?.focus();\r\n      }, 100); // Small delay to ensure element is visible\r\n    }\r\n  }\r\n\r\n  public clearInput(): void {\r\n    if (this.inputElement) {\r\n      this.inputElement.value = '';\r\n      this.updateSendButtonState();\r\n    }\r\n  }\r\n\r\n  private createElement(): HTMLElement {\r\n    const container = document.createElement('div');\r\n    container.className = this.getContainerClasses();\r\n    container.style.cssText = this.getContainerStyles();\r\n\r\n    // Create main chat bar\r\n    const chatBar = document.createElement('div');\r\n    chatBar.className = 'glass-panel flex items-center gap-2 p-3 min-w-80 max-w-md';\r\n    \r\n    // Create input container\r\n    const inputContainer = document.createElement('div');\r\n    inputContainer.className = 'flex-1 relative';\r\n    \r\n    // Create text input\r\n    this.inputElement = document.createElement('input');\r\n    this.inputElement.type = 'text';\r\n    this.inputElement.className = 'glass-input w-full pr-10 text-sm';\r\n    this.inputElement.placeholder = this.props.placeholder || 'Describe your room edit...';\r\n    this.inputElement.addEventListener('keypress', this.handleKeyPress);\r\n    this.inputElement.addEventListener('input', this.handleInputChange);\r\n    \r\n    // Create send button\r\n    this.sendButton = document.createElement('button');\r\n    this.sendButton.className = 'absolute right-2 top-1/2 transform -translate-y-1/2 p-1 rounded-full transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed';\r\n    this.sendButton.innerHTML = this.getSendButtonIcon();\r\n    this.sendButton.addEventListener('click', this.handleSendClick);\r\n    this.sendButton.disabled = true;\r\n\r\n    // Setup hover and focus animations for send button\r\n    const hoverCleanup = this.overlayAnimations.setupButtonHoverAnimation(this.sendButton, {\r\n      duration: 200,\r\n      respectsReducedMotion: true\r\n    });\r\n    \r\n    const focusCleanup = this.overlayAnimations.setupButtonFocusAnimation(this.sendButton, {\r\n      duration: 200,\r\n      respectsReducedMotion: true\r\n    });\r\n\r\n    this.hoverCleanups.set('send-hover', hoverCleanup);\r\n    this.hoverCleanups.set('send-focus', focusCleanup);\r\n    \r\n    // Create typing indicator\r\n    this.typingIndicator = document.createElement('div');\r\n    this.typingIndicator.className = 'hidden items-center gap-1 text-xs text-gray-400 ml-2';\r\n    this.typingIndicator.innerHTML = `\r\n      <div class=\"flex gap-1\">\r\n        <div class=\"w-1 h-1 bg-blue-400 rounded-full animate-bounce\" style=\"animation-delay: 0ms\"></div>\r\n        <div class=\"w-1 h-1 bg-blue-400 rounded-full animate-bounce\" style=\"animation-delay: 150ms\"></div>\r\n        <div class=\"w-1 h-1 bg-blue-400 rounded-full animate-bounce\" style=\"animation-delay: 300ms\"></div>\r\n      </div>\r\n      <span>Processing...</span>\r\n    `;\r\n    \r\n    // Ensure initial state is properly set\r\n    this.typingIndicator.classList.add('hidden');\r\n    this.typingIndicator.classList.remove('flex');\r\n\r\n    // Assemble components\r\n    inputContainer.appendChild(this.inputElement);\r\n    inputContainer.appendChild(this.sendButton);\r\n    \r\n    chatBar.appendChild(inputContainer);\r\n    chatBar.appendChild(this.typingIndicator);\r\n    \r\n    container.appendChild(chatBar);\r\n\r\n    return container;\r\n  }\r\n\r\n  private getContainerClasses(): string {\r\n    return [\r\n      'fixed',\r\n      'z-50',\r\n      'transition-all',\r\n      'duration-300',\r\n      'ease-out',\r\n      'pointer-events-auto'\r\n    ].join(' ');\r\n  }\r\n\r\n  private getContainerStyles(): string {\r\n    const position = this.calculatePosition();\r\n    const isMobile = this.currentViewport?.isMobile || false;\r\n    \r\n    const styles = [\r\n      `bottom: ${position.bottom}px`,\r\n      `right: ${position.right}px`,\r\n      'transform: translateY(0)',\r\n      this.isVisible ? 'opacity: 1' : 'opacity: 0',\r\n      this.isVisible ? 'pointer-events: auto' : 'pointer-events: none'\r\n    ];\r\n\r\n    // Add left positioning for mobile full-width\r\n    if (position.left !== undefined) {\r\n      styles.push(`left: ${position.left}px`);\r\n    }\r\n\r\n    // Mobile-specific styles\r\n    if (isMobile) {\r\n      styles.push('width: calc(100vw - 24px)');\r\n      styles.push('max-width: none');\r\n    }\r\n\r\n    return styles.join('; ');\r\n  }\r\n\r\n  private calculatePosition(): { bottom: number; right: number; left?: number } {\r\n    // Use responsive manager for optimal positioning\r\n    if (this.responsiveManager) {\r\n      return this.responsiveManager.getOptimalChatBarPosition();\r\n    }\r\n\r\n    // Fallback positioning\r\n    const isMobile = this.currentViewport?.isMobile || false;\r\n    \r\n    if (isMobile) {\r\n      return {\r\n        bottom: 12,\r\n        right: 12,\r\n        left: 12\r\n      };\r\n    } else {\r\n      return {\r\n        bottom: 20,\r\n        right: 20\r\n      };\r\n    }\r\n  }\r\n\r\n  private updateVisibility(): void {\r\n    if (!this.element) return;\r\n\r\n    const shouldBeVisible = this.props.visible && this.props.selectedImage !== null;\r\n    \r\n    if (shouldBeVisible !== this.isVisible) {\r\n      this.isVisible = shouldBeVisible;\r\n      this.element.style.opacity = this.isVisible ? '1' : '0';\r\n      this.element.style.pointerEvents = this.isVisible ? 'auto' : 'none';\r\n      \r\n      if (this.isVisible) {\r\n        this.focusInput();\r\n      }\r\n    }\r\n  }\r\n\r\n  private updateProcessingState(): void {\r\n    if (!this.inputElement || !this.sendButton || !this.typingIndicator) return;\r\n\r\n    const isProcessing = this.props.isProcessing || false;\r\n    \r\n    // Update input and button states\r\n    this.inputElement.disabled = isProcessing;\r\n    this.sendButton.disabled = isProcessing || this.inputElement.value.trim() === '';\r\n    \r\n    // Use animation system for loading state\r\n    const loadingCleanup = this.overlayAnimations.animateLoadingState(this.typingIndicator, isProcessing, {\r\n      duration: 1000,\r\n      respectsReducedMotion: true\r\n    });\r\n\r\n    if (isProcessing) {\r\n      this.animationCleanups.set('processing', loadingCleanup);\r\n      this.typingIndicator.classList.remove('hidden');\r\n      this.typingIndicator.classList.add('flex');\r\n    } else {\r\n      this.animationCleanups.delete('processing');\r\n      this.typingIndicator.classList.remove('flex');\r\n      this.typingIndicator.classList.add('hidden');\r\n    }\r\n    \r\n    // Update input opacity with smooth transition\r\n    this.inputElement.style.transition = 'opacity 0.2s ease';\r\n    this.inputElement.style.opacity = isProcessing ? '0.6' : '1';\r\n  }\r\n\r\n  private updatePlaceholder(): void {\r\n    if (!this.inputElement) return;\r\n    \r\n    if (!this.props.selectedImage) {\r\n      this.inputElement.placeholder = 'Select an image first...';\r\n    } else if (this.props.placeholder) {\r\n      this.inputElement.placeholder = this.props.placeholder;\r\n    } else {\r\n      this.inputElement.placeholder = 'Describe your room edit...';\r\n    }\r\n  }\r\n\r\n  private updateSendButtonState(): void {\r\n    if (!this.sendButton || !this.inputElement) return;\r\n    \r\n    const hasText = this.inputElement.value.trim().length > 0;\r\n    const isProcessing = this.props.isProcessing || false;\r\n    \r\n    this.sendButton.disabled = !hasText || isProcessing;\r\n    \r\n    // Update button styling based on state\r\n    if (hasText && !isProcessing) {\r\n      this.sendButton.className = this.sendButton.className.replace(\r\n        'text-gray-400',\r\n        'text-blue-400 hover:text-blue-300 hover:bg-blue-400/10'\r\n      );\r\n    } else {\r\n      this.sendButton.className = this.sendButton.className.replace(\r\n        'text-blue-400 hover:text-blue-300 hover:bg-blue-400/10',\r\n        'text-gray-400'\r\n      );\r\n    }\r\n  }\r\n\r\n  private getSendButtonIcon(): string {\r\n    return `\r\n      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n        <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"></line>\r\n        <polygon points=\"22,2 15,22 11,13 2,9 22,2\"></polygon>\r\n      </svg>\r\n    `;\r\n  }\r\n\r\n  private show(): void {\r\n    if (!this.element || this.isAnimating) return;\r\n    \r\n    this.isAnimating = true;\r\n    \r\n    // Use the new animation system\r\n    const cleanup = this.overlayAnimations.animateChatBarIn(this.element, {\r\n      duration: 300,\r\n      easing: 'cubic-bezier(0.34, 1.56, 0.64, 1)',\r\n      respectsReducedMotion: true\r\n    });\r\n\r\n    this.animationCleanups.set('show', cleanup);\r\n    \r\n    setTimeout(() => {\r\n      this.isAnimating = false;\r\n      this.focusInput();\r\n    }, 300);\r\n  }\r\n\r\n  private hide(): void {\r\n    if (!this.element || this.isAnimating) return;\r\n    \r\n    this.isAnimating = true;\r\n    \r\n    // Use the new animation system\r\n    const cleanup = this.overlayAnimations.animateChatBarOut(this.element, {\r\n      duration: 250,\r\n      easing: 'cubic-bezier(0.4, 0, 1, 1)',\r\n      respectsReducedMotion: true\r\n    });\r\n\r\n    this.animationCleanups.set('hide', cleanup);\r\n    \r\n    setTimeout(() => {\r\n      this.isAnimating = false;\r\n    }, 250);\r\n  }\r\n\r\n  private handleSubmit(message: string): void {\r\n    if (!message.trim() || this.props.isProcessing) return;\r\n    \r\n    if (!this.props.selectedImage) {\r\n      // Could show a toast or error message here\r\n      console.warn('[FloatingChatBar] No image selected for chat message');\r\n      return;\r\n    }\r\n    \r\n    this.props.onSubmit(message.trim());\r\n    this.clearInput();\r\n  }\r\n\r\n  private handleKeyPress(event: KeyboardEvent): void {\r\n    if (event.key === 'Enter' && !event.shiftKey) {\r\n      event.preventDefault();\r\n      const message = (event.target as HTMLInputElement).value;\r\n      this.handleSubmit(message);\r\n    } else if (event.key === 'Escape') {\r\n      this.props.onClose();\r\n    }\r\n  }\r\n\r\n  private handleInputChange(): void {\r\n    this.updateSendButtonState();\r\n  }\r\n\r\n  private handleSendClick(): void {\r\n    if (this.inputElement) {\r\n      const message = this.inputElement.value;\r\n      this.handleSubmit(message);\r\n    }\r\n  }\r\n\r\n  private setupResponsiveHandling(): void {\r\n    if (!this.responsiveManager) {\r\n      return;\r\n    }\r\n\r\n    // Listen for viewport changes\r\n    this.responsiveManager.on('viewportResized', this.handleViewportChange);\r\n    this.responsiveManager.on('breakpointChanged', this.handleViewportChange);\r\n  }\r\n\r\n  private handleViewportChange(viewport: ViewportInfo): void {\r\n    const previousViewport = this.currentViewport;\r\n    this.currentViewport = viewport;\r\n\r\n    // Update styles if breakpoint changed\r\n    if (!previousViewport || \r\n        previousViewport.isMobile !== viewport.isMobile ||\r\n        previousViewport.isTablet !== viewport.isTablet) {\r\n      this.updateResponsiveStyles();\r\n    }\r\n  }\r\n\r\n  private updateResponsiveStyles(): void {\r\n    if (!this.element || !this.currentViewport) {\r\n      return;\r\n    }\r\n\r\n    // Update container styles\r\n    this.element.style.cssText = this.getContainerStyles();\r\n\r\n    // Update input and button styles for touch devices\r\n    if (this.inputElement) {\r\n      this.updateInputForTouch();\r\n    }\r\n\r\n    if (this.sendButton) {\r\n      this.updateSendButtonForTouch();\r\n    }\r\n  }\r\n\r\n  private updateInputForTouch(): void {\r\n    if (!this.inputElement || !this.currentViewport) {\r\n      return;\r\n    }\r\n\r\n    const isTouchDevice = this.currentViewport.isTouchDevice;\r\n    const touchTargetSize = this.responsiveManager?.getTouchTargetSize() || 44;\r\n\r\n    if (isTouchDevice) {\r\n      Object.assign(this.inputElement.style, {\r\n        minHeight: `${touchTargetSize}px`,\r\n        fontSize: '16px', // Prevent zoom on iOS\r\n        WebkitTapHighlightColor: 'transparent',\r\n        touchAction: 'manipulation'\r\n      });\r\n    }\r\n  }\r\n\r\n  private updateSendButtonForTouch(): void {\r\n    if (!this.sendButton || !this.currentViewport) {\r\n      return;\r\n    }\r\n\r\n    const isTouchDevice = this.currentViewport.isTouchDevice;\r\n    const touchTargetSize = this.responsiveManager?.getTouchTargetSize() || 44;\r\n\r\n    if (isTouchDevice) {\r\n      Object.assign(this.sendButton.style, {\r\n        width: `${touchTargetSize}px`,\r\n        height: `${touchTargetSize}px`,\r\n        WebkitTapHighlightColor: 'transparent',\r\n        touchAction: 'manipulation'\r\n      });\r\n    }\r\n  }\r\n}","import type { APIError } from '../types/api';\r\n\r\n// Error category types\r\nexport type ErrorCategory = 'network' | 'image' | 'dom' | 'config' | 'api' | 'rate_limit';\r\n\r\nexport interface ErrorDetails {\r\n  category: ErrorCategory;\r\n  code: string;\r\n  message: string;\r\n  userMessage: string;\r\n  retryable: boolean;\r\n  retryAfter?: number;\r\n  context?: Record<string, any>;\r\n}\r\n\r\nexport interface RetryAttempt {\r\n  timestamp: number;\r\n  error: ErrorDetails;\r\n  attempt: number;\r\n}\r\n\r\nexport interface ErrorManagerConfig {\r\n  maxRetryAttempts: number;\r\n  retryBaseDelay: number;\r\n  retryMaxDelay: number;\r\n  rateLimitWindow: number;\r\n  maxErrorsPerWindow: number;\r\n  enableUserNotifications: boolean;\r\n  enableErrorReporting: boolean;\r\n  debug: boolean;\r\n}\r\n\r\nexport interface NetworkStatus {\r\n  isOnline: boolean;\r\n  lastChecked: number;\r\n  connectionType?: string;\r\n}\r\n\r\nexport interface RateLimitInfo {\r\n  remaining: number;\r\n  resetTime: number;\r\n  limit: number;\r\n}\r\n\r\n/**\r\n * Centralized error handling and user feedback system\r\n */\r\nexport class ErrorManager {\r\n  private config: ErrorManagerConfig;\r\n  private errorQueue: ErrorDetails[] = [];\r\n  private retryAttempts: Map<string, RetryAttempt[]> = new Map();\r\n  private networkStatus: NetworkStatus = {\r\n    isOnline: navigator.onLine,\r\n    lastChecked: Date.now()\r\n  };\r\n  private rateLimitInfo: RateLimitInfo | null = null;\r\n  private errorCounts: Map<string, number> = new Map();\r\n  private windowStartTime: number = Date.now();\r\n\r\n  constructor(config: Partial<ErrorManagerConfig> = {}) {\r\n    this.config = {\r\n      maxRetryAttempts: 3,\r\n      retryBaseDelay: 1000,\r\n      retryMaxDelay: 30000,\r\n      rateLimitWindow: 60000, // 1 minute\r\n      maxErrorsPerWindow: 10,\r\n      enableUserNotifications: true,\r\n      enableErrorReporting: true,\r\n      debug: false,\r\n      ...config\r\n    };\r\n\r\n    this.setupNetworkMonitoring();\r\n    this.setupErrorReporting();\r\n  }\r\n\r\n  /**\r\n   * Handle network-related errors\r\n   */\r\n  public handleNetworkError(error: Error | APIError): ErrorDetails {\r\n    const errorDetails: ErrorDetails = {\r\n      category: 'network',\r\n      code: this.getNetworkErrorCode(error),\r\n      message: error.message,\r\n      userMessage: this.getNetworkErrorMessage(error),\r\n      retryable: true,\r\n      context: {\r\n        isOnline: this.networkStatus.isOnline,\r\n        timestamp: Date.now(),\r\n        originalError: error\r\n      }\r\n    };\r\n\r\n    this.processError(errorDetails);\r\n    return errorDetails;\r\n  }\r\n\r\n  /**\r\n   * Handle image processing errors\r\n   */\r\n  public handleImageError(error: Error, imageContext?: any): ErrorDetails {\r\n    const errorDetails: ErrorDetails = {\r\n      category: 'image',\r\n      code: this.getImageErrorCode(error),\r\n      message: error.message,\r\n      userMessage: this.getImageErrorMessage(error),\r\n      retryable: this.isImageErrorRetryable(error),\r\n      context: {\r\n        imageContext,\r\n        timestamp: Date.now(),\r\n        originalError: error\r\n      }\r\n    };\r\n\r\n    this.processError(errorDetails);\r\n    return errorDetails;\r\n  }\r\n\r\n  /**\r\n   * Handle DOM-related errors\r\n   */\r\n  public handleDOMError(error: Error, domContext?: any): ErrorDetails {\r\n    const errorDetails: ErrorDetails = {\r\n      category: 'dom',\r\n      code: this.getDOMErrorCode(error),\r\n      message: error.message,\r\n      userMessage: this.getDOMErrorMessage(error),\r\n      retryable: false, // DOM errors are typically not retryable\r\n      context: {\r\n        domContext,\r\n        userAgent: navigator.userAgent,\r\n        timestamp: Date.now(),\r\n        originalError: error\r\n      }\r\n    };\r\n\r\n    this.processError(errorDetails);\r\n    return errorDetails;\r\n  }\r\n\r\n  /**\r\n   * Handle configuration errors\r\n   */\r\n  public handleConfigError(error: Error, configContext?: any): ErrorDetails {\r\n    const errorDetails: ErrorDetails = {\r\n      category: 'config',\r\n      code: this.getConfigErrorCode(error),\r\n      message: error.message,\r\n      userMessage: this.getConfigErrorMessage(error),\r\n      retryable: false, // Config errors require manual intervention\r\n      context: {\r\n        configContext,\r\n        timestamp: Date.now(),\r\n        originalError: error\r\n      }\r\n    };\r\n\r\n    this.processError(errorDetails);\r\n    return errorDetails;\r\n  }\r\n\r\n  /**\r\n   * Handle API errors with rate limiting support\r\n   */\r\n  public handleAPIError(error: APIError): ErrorDetails {\r\n    const isRateLimit = this.isRateLimitError(error);\r\n    \r\n    const errorDetails: ErrorDetails = {\r\n      category: isRateLimit ? 'rate_limit' : 'api',\r\n      code: this.getAPIErrorCode(error),\r\n      message: error.message,\r\n      userMessage: this.getAPIErrorMessage(error),\r\n      retryable: error.retryable || isRateLimit,\r\n      retryAfter: isRateLimit ? this.extractRetryAfter(error) : undefined,\r\n      context: {\r\n        status: error.status,\r\n        apiCode: error.code,\r\n        timestamp: Date.now(),\r\n        originalError: error\r\n      }\r\n    };\r\n\r\n    if (isRateLimit) {\r\n      this.updateRateLimitInfo(error);\r\n    }\r\n\r\n    this.processError(errorDetails);\r\n    return errorDetails;\r\n  }\r\n\r\n  /**\r\n   * Check if an error should be retried\r\n   */\r\n  public shouldRetry(errorDetails: ErrorDetails): boolean {\r\n    if (!errorDetails.retryable) {\r\n      return false;\r\n    }\r\n\r\n    const errorKey = `${errorDetails.category}:${errorDetails.code}`;\r\n    const attempts = this.retryAttempts.get(errorKey) || [];\r\n    \r\n    if (attempts.length >= this.config.maxRetryAttempts) {\r\n      return false;\r\n    }\r\n\r\n    // Check rate limiting\r\n    if (errorDetails.category === 'rate_limit' && this.rateLimitInfo) {\r\n      return Date.now() >= this.rateLimitInfo.resetTime;\r\n    }\r\n\r\n    // Check network status for network errors\r\n    if (errorDetails.category === 'network' && !this.networkStatus.isOnline) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Calculate retry delay\r\n   */\r\n  public calculateRetryDelay(errorDetails: ErrorDetails): number {\r\n    if (errorDetails.retryAfter) {\r\n      return errorDetails.retryAfter * 1000; // Convert to milliseconds\r\n    }\r\n\r\n    const errorKey = `${errorDetails.category}:${errorDetails.code}`;\r\n    const attempts = this.retryAttempts.get(errorKey) || [];\r\n    const attemptNumber = attempts.length;\r\n\r\n    // Exponential backoff with jitter\r\n    const baseDelay = this.config.retryBaseDelay;\r\n    const exponentialDelay = baseDelay * Math.pow(2, attemptNumber);\r\n    const jitter = Math.random() * 0.1 * exponentialDelay;\r\n    const delay = Math.min(exponentialDelay + jitter, this.config.retryMaxDelay);\r\n\r\n    return Math.floor(delay);\r\n  }\r\n\r\n  /**\r\n   * Record a retry attempt\r\n   */\r\n  public recordRetryAttempt(errorDetails: ErrorDetails): void {\r\n    const errorKey = `${errorDetails.category}:${errorDetails.code}`;\r\n    const attempts = this.retryAttempts.get(errorKey) || [];\r\n    \r\n    attempts.push({\r\n      timestamp: Date.now(),\r\n      error: errorDetails,\r\n      attempt: attempts.length + 1\r\n    });\r\n\r\n    this.retryAttempts.set(errorKey, attempts);\r\n  }\r\n\r\n  /**\r\n   * Clear retry attempts for a specific error\r\n   */\r\n  public clearRetryAttempts(errorDetails: ErrorDetails): void {\r\n    const errorKey = `${errorDetails.category}:${errorDetails.code}`;\r\n    this.retryAttempts.delete(errorKey);\r\n  }\r\n\r\n  /**\r\n   * Get current network status\r\n   */\r\n  public getNetworkStatus(): NetworkStatus {\r\n    return { ...this.networkStatus };\r\n  }\r\n\r\n  /**\r\n   * Get current rate limit information\r\n   */\r\n  public getRateLimitInfo(): RateLimitInfo | null {\r\n    return this.rateLimitInfo ? { ...this.rateLimitInfo } : null;\r\n  }\r\n\r\n  /**\r\n   * Show user-friendly error notification\r\n   */\r\n  public showUserError(errorDetails: ErrorDetails): void {\r\n    if (!this.config.enableUserNotifications) {\r\n      return;\r\n    }\r\n\r\n    // Create error notification element\r\n    const notification = this.createErrorNotification(errorDetails);\r\n    this.displayNotification(notification);\r\n  }\r\n\r\n  /**\r\n   * Process and categorize error\r\n   */\r\n  private processError(errorDetails: ErrorDetails): void {\r\n    // Add to error queue\r\n    this.errorQueue.push(errorDetails);\r\n    \r\n    // Limit queue size\r\n    if (this.errorQueue.length > 100) {\r\n      this.errorQueue.shift();\r\n    }\r\n\r\n    // Update error counts for rate limiting\r\n    this.updateErrorCounts(errorDetails);\r\n\r\n    // Log error if debug enabled\r\n    if (this.config.debug) {\r\n      console.error('[ErrorManager]', errorDetails);\r\n    }\r\n\r\n    // Report error if enabled\r\n    if (this.config.enableErrorReporting) {\r\n      this.reportError(errorDetails);\r\n    }\r\n\r\n    // Show user notification\r\n    this.showUserError(errorDetails);\r\n  }\r\n\r\n  /**\r\n   * Update error counts for internal rate limiting\r\n   */\r\n  private updateErrorCounts(errorDetails: ErrorDetails): void {\r\n    const now = Date.now();\r\n    \r\n    // Reset window if needed\r\n    if (now - this.windowStartTime > this.config.rateLimitWindow) {\r\n      this.errorCounts.clear();\r\n      this.windowStartTime = now;\r\n    }\r\n\r\n    const errorKey = `${errorDetails.category}:${errorDetails.code}`;\r\n    const currentCount = this.errorCounts.get(errorKey) || 0;\r\n    this.errorCounts.set(errorKey, currentCount + 1);\r\n  }\r\n\r\n  /**\r\n   * Setup network status monitoring\r\n   */\r\n  private setupNetworkMonitoring(): void {\r\n    window.addEventListener('online', () => {\r\n      this.networkStatus.isOnline = true;\r\n      this.networkStatus.lastChecked = Date.now();\r\n    });\r\n\r\n    window.addEventListener('offline', () => {\r\n      this.networkStatus.isOnline = false;\r\n      this.networkStatus.lastChecked = Date.now();\r\n    });\r\n\r\n    // Detect connection type if available\r\n    if ('connection' in navigator) {\r\n      const connection = (navigator as any).connection;\r\n      this.networkStatus.connectionType = connection.effectiveType;\r\n      \r\n      connection.addEventListener('change', () => {\r\n        this.networkStatus.connectionType = connection.effectiveType;\r\n        this.networkStatus.lastChecked = Date.now();\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup error reporting\r\n   */\r\n  private setupErrorReporting(): void {\r\n    // Global error handler\r\n    window.addEventListener('error', (event) => {\r\n      this.handleDOMError(event.error, {\r\n        filename: event.filename,\r\n        lineno: event.lineno,\r\n        colno: event.colno\r\n      });\r\n    });\r\n\r\n    // Unhandled promise rejection handler\r\n    window.addEventListener('unhandledrejection', (event) => {\r\n      this.handleDOMError(new Error(event.reason), {\r\n        type: 'unhandledrejection',\r\n        reason: event.reason\r\n      });\r\n    });\r\n  }\r\n\r\n  // Error code determination methods\r\n  private getNetworkErrorCode(error: Error | APIError): string {\r\n    const message = error.message.toLowerCase();\r\n    \r\n    if (message.includes('timeout')) return 'NETWORK_TIMEOUT';\r\n    if (message.includes('fetch')) return 'FETCH_ERROR';\r\n    if (message.includes('cors')) return 'CORS_ERROR';\r\n    if (message.includes('econnreset')) return 'CONNECTION_RESET';\r\n    if (message.includes('enotfound')) return 'DNS_ERROR';\r\n    if ('status' in error && error.status) return `HTTP_${error.status}`;\r\n    \r\n    return 'NETWORK_UNKNOWN';\r\n  }\r\n\r\n  private getImageErrorCode(error: Error): string {\r\n    const message = error.message.toLowerCase();\r\n    \r\n    if (message.includes('format')) return 'INVALID_FORMAT';\r\n    if (message.includes('size')) return 'SIZE_ERROR';\r\n    if (message.includes('corrupt')) return 'CORRUPTED_IMAGE';\r\n    if (message.includes('base64')) return 'INVALID_BASE64';\r\n    if (message.includes('processing')) return 'PROCESSING_FAILED';\r\n    \r\n    return 'IMAGE_UNKNOWN';\r\n  }\r\n\r\n  private getDOMErrorCode(error: Error): string {\r\n    const message = error.message.toLowerCase();\r\n    \r\n    if (message.includes('permission')) return 'PERMISSION_DENIED';\r\n    if (message.includes('not found')) return 'ELEMENT_NOT_FOUND';\r\n    if (message.includes('shadow')) return 'SHADOW_DOM_ERROR';\r\n    if (message.includes('mutation')) return 'MUTATION_ERROR';\r\n    \r\n    return 'DOM_UNKNOWN';\r\n  }\r\n\r\n  private getConfigErrorCode(error: Error): string {\r\n    const message = error.message.toLowerCase();\r\n    \r\n    if (message.includes('api key')) return 'INVALID_API_KEY';\r\n    if (message.includes('endpoint')) return 'INVALID_ENDPOINT';\r\n    if (message.includes('required')) return 'MISSING_CONFIG';\r\n    if (message.includes('format')) return 'INVALID_FORMAT';\r\n    \r\n    return 'CONFIG_UNKNOWN';\r\n  }\r\n\r\n  private getAPIErrorCode(error: APIError): string {\r\n    if (error.code) return error.code;\r\n    if (error.status) return `HTTP_${error.status}`;\r\n    return 'API_UNKNOWN';\r\n  }\r\n\r\n  // User message generation methods\r\n  private getNetworkErrorMessage(error: Error | APIError): string {\r\n    const code = this.getNetworkErrorCode(error);\r\n    \r\n    switch (code) {\r\n      case 'NETWORK_TIMEOUT':\r\n        return 'Request timed out. Please check your connection and try again.';\r\n      case 'CORS_ERROR':\r\n        return 'Unable to connect to the service. Please contact support.';\r\n      case 'DNS_ERROR':\r\n        return 'Unable to reach the server. Please check your internet connection.';\r\n      case 'HTTP_429':\r\n        return 'Too many requests. Please wait a moment before trying again.';\r\n      case 'HTTP_500':\r\n      case 'HTTP_502':\r\n      case 'HTTP_503':\r\n      case 'HTTP_504':\r\n        return 'Service temporarily unavailable. Please try again in a few moments.';\r\n      default:\r\n        return 'Unable to connect to AI service. Please check your connection.';\r\n    }\r\n  }\r\n\r\n  private getImageErrorMessage(error: Error): string {\r\n    const code = this.getImageErrorCode(error);\r\n    \r\n    switch (code) {\r\n      case 'INVALID_FORMAT':\r\n        return 'Image format not supported. Please use JPG, PNG, or WebP images.';\r\n      case 'SIZE_ERROR':\r\n        return 'Image is too large. Please use an image smaller than 10MB.';\r\n      case 'CORRUPTED_IMAGE':\r\n        return 'Image appears to be corrupted. Please try a different image.';\r\n      case 'INVALID_BASE64':\r\n        return 'Image data is invalid. Please try uploading the image again.';\r\n      case 'PROCESSING_FAILED':\r\n        return 'Image processing failed. Please try a different image or prompt.';\r\n      default:\r\n        return 'Image processing failed. Please try a different image.';\r\n    }\r\n  }\r\n\r\n  private getDOMErrorMessage(error: Error): string {\r\n    const code = this.getDOMErrorCode(error);\r\n    \r\n    switch (code) {\r\n      case 'PERMISSION_DENIED':\r\n        return 'Browser permissions required. Please allow the requested permissions.';\r\n      case 'ELEMENT_NOT_FOUND':\r\n        return 'Page element not found. Please refresh the page and try again.';\r\n      case 'SHADOW_DOM_ERROR':\r\n        return 'Browser compatibility issue. Please try a different browser.';\r\n      default:\r\n        return 'Browser compatibility issue. Please update or try a different browser.';\r\n    }\r\n  }\r\n\r\n  private getConfigErrorMessage(error: Error): string {\r\n    const code = this.getConfigErrorCode(error);\r\n    \r\n    switch (code) {\r\n      case 'INVALID_API_KEY':\r\n        return 'Invalid API configuration. Please contact the website administrator.';\r\n      case 'INVALID_ENDPOINT':\r\n        return 'Service configuration error. Please contact support.';\r\n      case 'MISSING_CONFIG':\r\n        return 'Missing configuration. Please contact the website administrator.';\r\n      default:\r\n        return 'Configuration error. Please contact the website administrator.';\r\n    }\r\n  }\r\n\r\n  private getAPIErrorMessage(error: APIError): string {\r\n    if (error.status === 429) {\r\n      return 'Too many requests. Please wait a moment before trying again.';\r\n    }\r\n    if (error.status === 401) {\r\n      return 'Authentication failed. Please contact the website administrator.';\r\n    }\r\n    if (error.status === 403) {\r\n      return 'Access denied. Please contact the website administrator.';\r\n    }\r\n    if (error.status && error.status >= 500) {\r\n      return 'Service temporarily unavailable. Please try again in a few moments.';\r\n    }\r\n    \r\n    return 'Request failed. Please try again or contact support if the problem persists.';\r\n  }\r\n\r\n  // Helper methods\r\n  private isImageErrorRetryable(error: Error): boolean {\r\n    const code = this.getImageErrorCode(error);\r\n    return code === 'PROCESSING_FAILED';\r\n  }\r\n\r\n  private isRateLimitError(error: APIError): boolean {\r\n    return error.status === 429 || error.code === 'RATE_LIMIT_EXCEEDED';\r\n  }\r\n\r\n  private extractRetryAfter(error: APIError): number | undefined {\r\n    if (error.details && error.details.retryAfter) {\r\n      return parseInt(error.details.retryAfter, 10);\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  private updateRateLimitInfo(error: APIError): void {\r\n    if (error.details) {\r\n      this.rateLimitInfo = {\r\n        remaining: parseInt(error.details.remaining || '0', 10),\r\n        resetTime: Date.now() + (parseInt(error.details.retryAfter || '60', 10) * 1000),\r\n        limit: parseInt(error.details.limit || '100', 10)\r\n      };\r\n    }\r\n  }\r\n\r\n  private createErrorNotification(errorDetails: ErrorDetails): HTMLElement {\r\n    const notification = document.createElement('div');\r\n    notification.className = 'dino-error-notification';\r\n    notification.style.cssText = `\r\n      position: fixed;\r\n      top: 20px;\r\n      right: 20px;\r\n      background: rgba(239, 68, 68, 0.95);\r\n      backdrop-filter: blur(10px);\r\n      color: white;\r\n      padding: 16px 20px;\r\n      border-radius: 12px;\r\n      border: 1px solid rgba(255, 255, 255, 0.2);\r\n      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\r\n      max-width: 400px;\r\n      z-index: 10000;\r\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n      font-size: 14px;\r\n      line-height: 1.4;\r\n      animation: slideIn 0.3s ease-out;\r\n    `;\r\n\r\n    const message = document.createElement('div');\r\n    message.textContent = errorDetails.userMessage;\r\n    notification.appendChild(message);\r\n\r\n    if (errorDetails.retryable) {\r\n      const retryInfo = document.createElement('div');\r\n      retryInfo.style.cssText = `\r\n        margin-top: 8px;\r\n        font-size: 12px;\r\n        opacity: 0.8;\r\n      `;\r\n      retryInfo.textContent = 'Retrying automatically...';\r\n      notification.appendChild(retryInfo);\r\n    }\r\n\r\n    // Add close button\r\n    const closeButton = document.createElement('button');\r\n    closeButton.innerHTML = '';\r\n    closeButton.style.cssText = `\r\n      position: absolute;\r\n      top: 8px;\r\n      right: 12px;\r\n      background: none;\r\n      border: none;\r\n      color: white;\r\n      font-size: 18px;\r\n      cursor: pointer;\r\n      opacity: 0.7;\r\n    `;\r\n    closeButton.onclick = () => notification.remove();\r\n    notification.appendChild(closeButton);\r\n\r\n    return notification;\r\n  }\r\n\r\n  private displayNotification(notification: HTMLElement): void {\r\n    document.body.appendChild(notification);\r\n\r\n    // Auto-remove after 5 seconds\r\n    setTimeout(() => {\r\n      if (notification.parentNode) {\r\n        notification.style.animation = 'slideOut 0.3s ease-in';\r\n        setTimeout(() => notification.remove(), 300);\r\n      }\r\n    }, 5000);\r\n  }\r\n\r\n  private reportError(errorDetails: ErrorDetails): void {\r\n    // This would typically send error data to an analytics service\r\n    // For now, we'll just log it\r\n    if (this.config.debug) {\r\n      console.log('[ErrorManager] Reporting error:', {\r\n        category: errorDetails.category,\r\n        code: errorDetails.code,\r\n        message: errorDetails.message,\r\n        timestamp: Date.now(),\r\n        userAgent: navigator.userAgent,\r\n        url: window.location.href\r\n      });\r\n    }\r\n  }\r\n}","/**\r\n * Performance monitoring and metrics collection system\r\n * Tracks bundle size, load times, API response times, and user engagement\r\n */\r\n\r\nexport interface PerformanceMetrics {\r\n  loadTime: number;\r\n  bundleSize: number;\r\n  apiResponseTime: number;\r\n  errorRate: number;\r\n  memoryUsage: number;\r\n  userEngagement: {\r\n    imagesSelected: number;\r\n    actionsTriggered: number;\r\n    chatMessages: number;\r\n    sessionDuration: number;\r\n  };\r\n}\r\n\r\nexport interface PerformanceThresholds {\r\n  maxLoadTime: number; // 2000ms\r\n  maxBundleSize: number; // 200KB\r\n  maxApiResponseTime: number; // 5000ms\r\n  maxErrorRate: number; // 0.05 (5%)\r\n  maxMemoryUsage: number; // 50MB\r\n}\r\n\r\nexport class PerformanceMonitor {\r\n  private metrics: PerformanceMetrics;\r\n  private thresholds: PerformanceThresholds;\r\n  private startTime: number;\r\n  private apiRequestTimes: number[] = [];\r\n  private errorCount: number = 0;\r\n  private totalRequests: number = 0;\r\n  private observers: PerformanceObserver[] = [];\r\n\r\n  constructor(thresholds?: Partial<PerformanceThresholds>) {\r\n    this.startTime = performance.now();\r\n    this.thresholds = {\r\n      maxLoadTime: 2000,\r\n      maxBundleSize: 200 * 1024, // 200KB\r\n      maxApiResponseTime: 5000,\r\n      maxErrorRate: 0.05,\r\n      maxMemoryUsage: 50 * 1024 * 1024, // 50MB\r\n      ...thresholds\r\n    };\r\n\r\n    this.metrics = {\r\n      loadTime: 0,\r\n      bundleSize: 0,\r\n      apiResponseTime: 0,\r\n      errorRate: 0,\r\n      memoryUsage: 0,\r\n      userEngagement: {\r\n        imagesSelected: 0,\r\n        actionsTriggered: 0,\r\n        chatMessages: 0,\r\n        sessionDuration: 0\r\n      }\r\n    };\r\n\r\n    this.initializeMonitoring();\r\n  }\r\n\r\n  private initializeMonitoring(): void {\r\n    // Monitor resource loading\r\n    if ('PerformanceObserver' in window) {\r\n      this.setupResourceObserver();\r\n      this.setupNavigationObserver();\r\n      this.setupMemoryObserver();\r\n    }\r\n\r\n    // Track initial load time\r\n    if (document.readyState === 'complete') {\r\n      this.calculateLoadTime();\r\n    } else {\r\n      window.addEventListener('load', () => this.calculateLoadTime());\r\n    }\r\n  }\r\n\r\n  private setupResourceObserver(): void {\r\n    const resourceObserver = new PerformanceObserver((list) => {\r\n      for (const entry of list.getEntries()) {\r\n        if (entry.name.includes('dino-overlay')) {\r\n          this.metrics.bundleSize = (entry as PerformanceResourceTiming).transferSize || 0;\r\n        }\r\n      }\r\n    });\r\n\r\n    resourceObserver.observe({ entryTypes: ['resource'] });\r\n    this.observers.push(resourceObserver);\r\n  }\r\n\r\n  private setupNavigationObserver(): void {\r\n    const navigationObserver = new PerformanceObserver((list) => {\r\n      for (const entry of list.getEntries()) {\r\n        const navEntry = entry as PerformanceNavigationTiming;\r\n        this.metrics.loadTime = navEntry.loadEventEnd - navEntry.navigationStart;\r\n      }\r\n    });\r\n\r\n    navigationObserver.observe({ entryTypes: ['navigation'] });\r\n    this.observers.push(navigationObserver);\r\n  }\r\n\r\n  private setupMemoryObserver(): void {\r\n    // Monitor memory usage if available\r\n    if ('memory' in performance) {\r\n      setInterval(() => {\r\n        const memory = (performance as any).memory;\r\n        this.metrics.memoryUsage = memory.usedJSHeapSize;\r\n      }, 5000);\r\n    }\r\n  }\r\n\r\n  private calculateLoadTime(): void {\r\n    this.metrics.loadTime = performance.now() - this.startTime;\r\n    this.metrics.userEngagement.sessionDuration = this.metrics.loadTime;\r\n  }\r\n\r\n  public trackApiRequest(responseTime: number, isError: boolean = false): void {\r\n    this.apiRequestTimes.push(responseTime);\r\n    this.totalRequests++;\r\n    \r\n    if (isError) {\r\n      this.errorCount++;\r\n    }\r\n\r\n    // Calculate average API response time\r\n    this.metrics.apiResponseTime = this.apiRequestTimes.reduce((a, b) => a + b, 0) / this.apiRequestTimes.length;\r\n    \r\n    // Calculate error rate\r\n    this.metrics.errorRate = this.errorCount / this.totalRequests;\r\n  }\r\n\r\n  public trackUserEngagement(event: keyof PerformanceMetrics['userEngagement'], increment: number = 1): void {\r\n    if (event === 'sessionDuration') {\r\n      this.metrics.userEngagement.sessionDuration = performance.now() - this.startTime;\r\n    } else {\r\n      this.metrics.userEngagement[event] += increment;\r\n    }\r\n  }\r\n\r\n  public getMetrics(): PerformanceMetrics {\r\n    // Update session duration\r\n    this.metrics.userEngagement.sessionDuration = performance.now() - this.startTime;\r\n    return { ...this.metrics };\r\n  }\r\n\r\n  public checkThresholds(): { [key: string]: boolean } {\r\n    const results = {\r\n      loadTime: this.metrics.loadTime <= this.thresholds.maxLoadTime,\r\n      bundleSize: this.metrics.bundleSize <= this.thresholds.maxBundleSize,\r\n      apiResponseTime: this.metrics.apiResponseTime <= this.thresholds.maxApiResponseTime,\r\n      errorRate: this.metrics.errorRate <= this.thresholds.maxErrorRate,\r\n      memoryUsage: this.metrics.memoryUsage <= this.thresholds.maxMemoryUsage\r\n    };\r\n\r\n    return results;\r\n  }\r\n\r\n  public generateReport(): string {\r\n    const metrics = this.getMetrics();\r\n    const thresholdResults = this.checkThresholds();\r\n    \r\n    return `\r\nDinoOverlay Performance Report\r\n=============================\r\nLoad Time: ${metrics.loadTime.toFixed(2)}ms ${thresholdResults.loadTime ? '' : ''}\r\nBundle Size: ${(metrics.bundleSize / 1024).toFixed(2)}KB ${thresholdResults.bundleSize ? '' : ''}\r\nAPI Response Time: ${metrics.apiResponseTime.toFixed(2)}ms ${thresholdResults.apiResponseTime ? '' : ''}\r\nError Rate: ${(metrics.errorRate * 100).toFixed(2)}% ${thresholdResults.errorRate ? '' : ''}\r\nMemory Usage: ${(metrics.memoryUsage / 1024 / 1024).toFixed(2)}MB ${thresholdResults.memoryUsage ? '' : ''}\r\n\r\nUser Engagement:\r\n- Images Selected: ${metrics.userEngagement.imagesSelected}\r\n- Actions Triggered: ${metrics.userEngagement.actionsTriggered}\r\n- Chat Messages: ${metrics.userEngagement.chatMessages}\r\n- Session Duration: ${(metrics.userEngagement.sessionDuration / 1000).toFixed(2)}s\r\n    `.trim();\r\n  }\r\n\r\n  public destroy(): void {\r\n    this.observers.forEach(observer => observer.disconnect());\r\n    this.observers = [];\r\n  }\r\n}\r\n\r\n// Global performance monitor instance\r\nexport const performanceMonitor = new PerformanceMonitor();","/**\r\n * Image optimization utility with WebP support and compression\r\n * Handles format conversion, quality optimization, and lazy loading\r\n */\r\n\r\nexport interface ImageOptimizationOptions {\r\n  quality: number; // 0.1 to 1.0\r\n  maxWidth?: number;\r\n  maxHeight?: number;\r\n  format?: 'webp' | 'jpeg' | 'png' | 'auto';\r\n  enableLazyLoading?: boolean;\r\n  compressionLevel?: number; // 0-9 for PNG\r\n}\r\n\r\nexport interface OptimizedImage {\r\n  data: string; // base64 or blob URL\r\n  format: string;\r\n  originalSize: number;\r\n  optimizedSize: number;\r\n  compressionRatio: number;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport class ImageOptimizer {\r\n  private canvas: HTMLCanvasElement;\r\n  private ctx: CanvasRenderingContext2D;\r\n  private supportsWebP: boolean = false;\r\n\r\n  constructor() {\r\n    this.canvas = document.createElement('canvas');\r\n    this.ctx = this.canvas.getContext('2d')!;\r\n    this.detectWebPSupport();\r\n  }\r\n\r\n  private async detectWebPSupport(): Promise<void> {\r\n    return new Promise((resolve) => {\r\n      const webP = new Image();\r\n      webP.onload = webP.onerror = () => {\r\n        this.supportsWebP = webP.height === 2;\r\n        resolve();\r\n      };\r\n      webP.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';\r\n    });\r\n  }\r\n\r\n  public async optimizeImage(\r\n    imageElement: HTMLImageElement,\r\n    options: ImageOptimizationOptions = { quality: 0.8 }\r\n  ): Promise<OptimizedImage> {\r\n    const originalSize = await this.getImageSize(imageElement.src);\r\n    \r\n    // Load image into canvas\r\n    await this.loadImageToCanvas(imageElement, options);\r\n    \r\n    // Determine optimal format\r\n    const format = this.determineOptimalFormat(options.format);\r\n    \r\n    // Convert and compress\r\n    const optimizedData = this.compressImage(format, options.quality);\r\n    const optimizedSize = this.calculateDataSize(optimizedData);\r\n    \r\n    return {\r\n      data: optimizedData,\r\n      format,\r\n      originalSize,\r\n      optimizedSize,\r\n      compressionRatio: originalSize / optimizedSize,\r\n      width: this.canvas.width,\r\n      height: this.canvas.height\r\n    };\r\n  }\r\n\r\n  private async loadImageToCanvas(\r\n    imageElement: HTMLImageElement,\r\n    options: ImageOptimizationOptions\r\n  ): Promise<void> {\r\n    return new Promise((resolve, reject) => {\r\n      const img = new Image();\r\n      img.crossOrigin = 'anonymous';\r\n      \r\n      img.onload = () => {\r\n        const { width, height } = this.calculateOptimalDimensions(\r\n          img.naturalWidth,\r\n          img.naturalHeight,\r\n          options\r\n        );\r\n        \r\n        this.canvas.width = width;\r\n        this.canvas.height = height;\r\n        \r\n        // Clear canvas and draw image\r\n        this.ctx.clearRect(0, 0, width, height);\r\n        this.ctx.drawImage(img, 0, 0, width, height);\r\n        \r\n        resolve();\r\n      };\r\n      \r\n      img.onerror = () => reject(new Error('Failed to load image'));\r\n      img.src = imageElement.src;\r\n    });\r\n  }\r\n\r\n  private calculateOptimalDimensions(\r\n    originalWidth: number,\r\n    originalHeight: number,\r\n    options: ImageOptimizationOptions\r\n  ): { width: number; height: number } {\r\n    let { width, height } = { width: originalWidth, height: originalHeight };\r\n    \r\n    // Apply max width constraint\r\n    if (options.maxWidth && width > options.maxWidth) {\r\n      height = (height * options.maxWidth) / width;\r\n      width = options.maxWidth;\r\n    }\r\n    \r\n    // Apply max height constraint\r\n    if (options.maxHeight && height > options.maxHeight) {\r\n      width = (width * options.maxHeight) / height;\r\n      height = options.maxHeight;\r\n    }\r\n    \r\n    return { width: Math.round(width), height: Math.round(height) };\r\n  }\r\n\r\n  private determineOptimalFormat(requestedFormat?: string): string {\r\n    if (requestedFormat && requestedFormat !== 'auto') {\r\n      return requestedFormat;\r\n    }\r\n    \r\n    // Use WebP if supported, otherwise fall back to JPEG\r\n    return this.supportsWebP ? 'webp' : 'jpeg';\r\n  }\r\n\r\n  private compressImage(format: string, quality: number): string {\r\n    const mimeType = `image/${format}`;\r\n    return this.canvas.toDataURL(mimeType, quality);\r\n  }\r\n\r\n  private async getImageSize(src: string): Promise<number> {\r\n    try {\r\n      const response = await fetch(src);\r\n      const blob = await response.blob();\r\n      return blob.size;\r\n    } catch {\r\n      // Fallback: estimate size from data URL if it's base64\r\n      if (src.startsWith('data:')) {\r\n        const base64 = src.split(',')[1];\r\n        return Math.round((base64.length * 3) / 4);\r\n      }\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  private calculateDataSize(dataUrl: string): number {\r\n    if (dataUrl.startsWith('data:')) {\r\n      const base64 = dataUrl.split(',')[1];\r\n      return Math.round((base64.length * 3) / 4);\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  public createLazyLoadObserver(\r\n    callback: (entries: IntersectionObserverEntry[]) => void,\r\n    options: IntersectionObserverInit = {}\r\n  ): IntersectionObserver {\r\n    const defaultOptions = {\r\n      root: null,\r\n      rootMargin: '50px',\r\n      threshold: 0.1,\r\n      ...options\r\n    };\r\n\r\n    return new IntersectionObserver(callback, defaultOptions);\r\n  }\r\n\r\n  public async preloadImage(src: string): Promise<HTMLImageElement> {\r\n    return new Promise((resolve, reject) => {\r\n      const img = new Image();\r\n      img.onload = () => resolve(img);\r\n      img.onerror = () => reject(new Error(`Failed to preload image: ${src}`));\r\n      img.src = src;\r\n    });\r\n  }\r\n\r\n  public generateSrcSet(\r\n    baseSrc: string,\r\n    sizes: number[] = [320, 640, 1024, 1920]\r\n  ): string {\r\n    return sizes\r\n      .map(size => `${baseSrc}?w=${size} ${size}w`)\r\n      .join(', ');\r\n  }\r\n\r\n  public generateSizes(breakpoints: { [key: string]: string } = {}): string {\r\n    const defaultBreakpoints = {\r\n      '(max-width: 320px)': '280px',\r\n      '(max-width: 640px)': '600px',\r\n      '(max-width: 1024px)': '960px',\r\n      ...breakpoints\r\n    };\r\n\r\n    const sizeEntries = Object.entries(defaultBreakpoints);\r\n    const mediaQueries = sizeEntries.slice(0, -1)\r\n      .map(([query, size]) => `${query} ${size}`)\r\n      .join(', ');\r\n    \r\n    const fallbackSize = sizeEntries[sizeEntries.length - 1][1];\r\n    \r\n    return mediaQueries ? `${mediaQueries}, ${fallbackSize}` : fallbackSize;\r\n  }\r\n\r\n  public destroy(): void {\r\n    // Clean up canvas\r\n    this.canvas.width = 0;\r\n    this.canvas.height = 0;\r\n  }\r\n}\r\n\r\n// Utility functions for lazy loading\r\nexport class LazyImageLoader {\r\n  private observer: IntersectionObserver;\r\n  private optimizer: ImageOptimizer;\r\n  private loadedImages: Set<HTMLImageElement> = new Set();\r\n\r\n  constructor(optimizer: ImageOptimizer) {\r\n    this.optimizer = optimizer;\r\n    this.observer = this.optimizer.createLazyLoadObserver(\r\n      this.handleIntersection.bind(this)\r\n    );\r\n  }\r\n\r\n  private handleIntersection(entries: IntersectionObserverEntry[]): void {\r\n    entries.forEach(entry => {\r\n      if (entry.isIntersecting) {\r\n        const img = entry.target as HTMLImageElement;\r\n        this.loadImage(img);\r\n        this.observer.unobserve(img);\r\n      }\r\n    });\r\n  }\r\n\r\n  private async loadImage(img: HTMLImageElement): Promise<void> {\r\n    if (this.loadedImages.has(img)) return;\r\n\r\n    const dataSrc = img.dataset.src;\r\n    if (!dataSrc) return;\r\n\r\n    try {\r\n      // Show loading placeholder\r\n      img.style.filter = 'blur(5px)';\r\n      \r\n      // Preload the image\r\n      await this.optimizer.preloadImage(dataSrc);\r\n      \r\n      // Update src and remove blur\r\n      img.src = dataSrc;\r\n      img.style.filter = '';\r\n      img.classList.add('loaded');\r\n      \r\n      this.loadedImages.add(img);\r\n    } catch (error) {\r\n      console.error('Failed to lazy load image:', error);\r\n      img.classList.add('error');\r\n    }\r\n  }\r\n\r\n  public observe(img: HTMLImageElement): void {\r\n    this.observer.observe(img);\r\n  }\r\n\r\n  public unobserve(img: HTMLImageElement): void {\r\n    this.observer.unobserve(img);\r\n  }\r\n\r\n  public destroy(): void {\r\n    this.observer.disconnect();\r\n    this.loadedImages.clear();\r\n  }\r\n}\r\n\r\n// Global image optimizer instance\r\nexport const imageOptimizer = new ImageOptimizer();","/**\r\n * Lazy loading manager for non-critical components\r\n * Implements code splitting and dynamic imports for optimal bundle size\r\n */\r\n\r\nexport interface LazyComponentConfig {\r\n  name: string;\r\n  loader: () => Promise<any>;\r\n  preload?: boolean;\r\n  priority?: 'high' | 'medium' | 'low';\r\n  dependencies?: string[];\r\n}\r\n\r\nexport interface ComponentLoadResult<T = any> {\r\n  component: T;\r\n  loadTime: number;\r\n  fromCache: boolean;\r\n}\r\n\r\nexport class LazyComponentLoader {\r\n  private componentCache = new Map<string, any>();\r\n  private loadingPromises = new Map<string, Promise<any>>();\r\n  private preloadQueue: string[] = [];\r\n  private loadedComponents = new Set<string>();\r\n\r\n  constructor() {\r\n    this.initializePreloading();\r\n  }\r\n\r\n  private initializePreloading(): void {\r\n    // Preload high-priority components when browser is idle\r\n    if ('requestIdleCallback' in window) {\r\n      requestIdleCallback(() => this.processPreloadQueue());\r\n    } else {\r\n      // Fallback for browsers without requestIdleCallback\r\n      setTimeout(() => this.processPreloadQueue(), 100);\r\n    }\r\n  }\r\n\r\n  public registerComponent(config: LazyComponentConfig): void {\r\n    if (config.preload) {\r\n      this.preloadQueue.push(config.name);\r\n    }\r\n  }\r\n\r\n  public async loadComponent<T = any>(\r\n    name: string,\r\n    loader: () => Promise<any>\r\n  ): Promise<ComponentLoadResult<T>> {\r\n    const startTime = performance.now();\r\n\r\n    // Return from cache if available\r\n    if (this.componentCache.has(name)) {\r\n      return {\r\n        component: this.componentCache.get(name),\r\n        loadTime: performance.now() - startTime,\r\n        fromCache: true\r\n      };\r\n    }\r\n\r\n    // Return existing loading promise if component is already being loaded\r\n    if (this.loadingPromises.has(name)) {\r\n      const component = await this.loadingPromises.get(name)!;\r\n      return {\r\n        component,\r\n        loadTime: performance.now() - startTime,\r\n        fromCache: false\r\n      };\r\n    }\r\n\r\n    // Start loading the component\r\n    const loadingPromise = this.loadComponentInternal(loader);\r\n    this.loadingPromises.set(name, loadingPromise);\r\n\r\n    try {\r\n      const component = await loadingPromise;\r\n      this.componentCache.set(name, component);\r\n      this.loadedComponents.add(name);\r\n      \r\n      return {\r\n        component,\r\n        loadTime: performance.now() - startTime,\r\n        fromCache: false\r\n      };\r\n    } finally {\r\n      this.loadingPromises.delete(name);\r\n    }\r\n  }\r\n\r\n  private async loadComponentInternal(loader: () => Promise<any>): Promise<any> {\r\n    try {\r\n      const module = await loader();\r\n      return module.default || module;\r\n    } catch (error) {\r\n      console.error('Failed to load component:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async processPreloadQueue(): void {\r\n    // Process preload queue in batches to avoid overwhelming the browser\r\n    const batchSize = 2;\r\n    \r\n    while (this.preloadQueue.length > 0) {\r\n      const batch = this.preloadQueue.splice(0, batchSize);\r\n      \r\n      await Promise.allSettled(\r\n        batch.map(async (componentName) => {\r\n          try {\r\n            // This would need to be configured with actual loaders\r\n            // For now, we'll just mark as processed\r\n            console.log(`Preloading component: ${componentName}`);\r\n          } catch (error) {\r\n            console.warn(`Failed to preload component ${componentName}:`, error);\r\n          }\r\n        })\r\n      );\r\n\r\n      // Yield control to prevent blocking\r\n      await new Promise(resolve => setTimeout(resolve, 10));\r\n    }\r\n  }\r\n\r\n  public preloadComponent(name: string, loader: () => Promise<any>): void {\r\n    if (!this.loadedComponents.has(name) && !this.loadingPromises.has(name)) {\r\n      this.loadComponent(name, loader).catch(error => {\r\n        console.warn(`Failed to preload component ${name}:`, error);\r\n      });\r\n    }\r\n  }\r\n\r\n  public isComponentLoaded(name: string): boolean {\r\n    return this.loadedComponents.has(name);\r\n  }\r\n\r\n  public getLoadedComponents(): string[] {\r\n    return Array.from(this.loadedComponents);\r\n  }\r\n\r\n  public clearCache(): void {\r\n    this.componentCache.clear();\r\n    this.loadedComponents.clear();\r\n    this.loadingPromises.clear();\r\n  }\r\n\r\n  public getCacheSize(): number {\r\n    return this.componentCache.size;\r\n  }\r\n}\r\n\r\n// Component loaders for lazy loading\r\nexport const componentLoaders = {\r\n  // Core components that can be lazy loaded\r\n  quickActionSidebar: () => import('./QuickActionSidebar').then(m => m.QuickActionSidebar),\r\n  floatingChatBar: () => import('./FloatingChatBar').then(m => m.FloatingChatBar),\r\n  imageHighlighter: () => import('./ImageHighlighter').then(m => m.ImageHighlighter),\r\n  \r\n  // Advanced features that can be lazy loaded\r\n  animationSystem: () => import('./AnimationSystem').then(m => m.AnimationSystem),\r\n  themeManager: () => import('./ThemeManager').then(m => m.ThemeManager),\r\n  responsiveManager: () => import('./ResponsiveManager').then(m => m.ResponsiveManager),\r\n  touchGestureHandler: () => import('./TouchGestureHandler').then(m => m.TouchGestureHandler),\r\n  \r\n  // Utility components\r\n  imageOptimizer: () => import('./ImageOptimizer').then(m => m.ImageOptimizer),\r\n  performanceMonitor: () => import('./PerformanceMonitor').then(m => m.PerformanceMonitor)\r\n};\r\n\r\n// Component configurations\r\nexport const componentConfigs: LazyComponentConfig[] = [\r\n  {\r\n    name: 'quickActionSidebar',\r\n    loader: componentLoaders.quickActionSidebar,\r\n    priority: 'high',\r\n    preload: true\r\n  },\r\n  {\r\n    name: 'floatingChatBar',\r\n    loader: componentLoaders.floatingChatBar,\r\n    priority: 'high',\r\n    preload: true\r\n  },\r\n  {\r\n    name: 'imageHighlighter',\r\n    loader: componentLoaders.imageHighlighter,\r\n    priority: 'high',\r\n    preload: true\r\n  },\r\n  {\r\n    name: 'animationSystem',\r\n    loader: componentLoaders.animationSystem,\r\n    priority: 'medium',\r\n    preload: false\r\n  },\r\n  {\r\n    name: 'themeManager',\r\n    loader: componentLoaders.themeManager,\r\n    priority: 'medium',\r\n    preload: false\r\n  },\r\n  {\r\n    name: 'responsiveManager',\r\n    loader: componentLoaders.responsiveManager,\r\n    priority: 'medium',\r\n    preload: false\r\n  },\r\n  {\r\n    name: 'touchGestureHandler',\r\n    loader: componentLoaders.touchGestureHandler,\r\n    priority: 'low',\r\n    preload: false\r\n  },\r\n  {\r\n    name: 'imageOptimizer',\r\n    loader: componentLoaders.imageOptimizer,\r\n    priority: 'low',\r\n    preload: false\r\n  },\r\n  {\r\n    name: 'performanceMonitor',\r\n    loader: componentLoaders.performanceMonitor,\r\n    priority: 'high',\r\n    preload: true\r\n  }\r\n];\r\n\r\n// Global lazy component loader instance\r\nexport const lazyComponentLoader = new LazyComponentLoader();\r\n\r\n// Register all component configurations\r\ncomponentConfigs.forEach(config => {\r\n  lazyComponentLoader.registerComponent(config);\r\n});","/**\r\n * Performance configuration and optimization settings\r\n * Centralizes all performance-related configurations\r\n */\r\n\r\nexport interface PerformanceConfig {\r\n  bundleOptimization: {\r\n    maxBundleSize: number;\r\n    maxGzipSize: number;\r\n    enableTreeShaking: boolean;\r\n    enableCodeSplitting: boolean;\r\n    enableMinification: boolean;\r\n  };\r\n  lazyLoading: {\r\n    enableComponentLazyLoading: boolean;\r\n    enableImageLazyLoading: boolean;\r\n    intersectionThreshold: number;\r\n    rootMargin: string;\r\n    preloadCriticalComponents: boolean;\r\n  };\r\n  imageOptimization: {\r\n    enableWebP: boolean;\r\n    defaultQuality: number;\r\n    maxWidth: number;\r\n    maxHeight: number;\r\n    enableCompression: boolean;\r\n  };\r\n  monitoring: {\r\n    enablePerformanceMonitoring: boolean;\r\n    enableUserEngagementTracking: boolean;\r\n    enableErrorTracking: boolean;\r\n    sampleRate: number;\r\n  };\r\n  caching: {\r\n    enableComponentCache: boolean;\r\n    enableImageCache: boolean;\r\n    cacheMaxAge: number;\r\n    maxCacheSize: number;\r\n  };\r\n  thresholds: {\r\n    maxLoadTime: number;\r\n    maxInitTime: number;\r\n    maxApiResponseTime: number;\r\n    maxMemoryUsage: number;\r\n    maxErrorRate: number;\r\n  };\r\n}\r\n\r\nexport const defaultPerformanceConfig: PerformanceConfig = {\r\n  bundleOptimization: {\r\n    maxBundleSize: 200 * 1024, // 200KB\r\n    maxGzipSize: 50 * 1024,    // 50KB\r\n    enableTreeShaking: true,\r\n    enableCodeSplitting: true,\r\n    enableMinification: true\r\n  },\r\n  lazyLoading: {\r\n    enableComponentLazyLoading: true,\r\n    enableImageLazyLoading: true,\r\n    intersectionThreshold: 0.1,\r\n    rootMargin: '50px',\r\n    preloadCriticalComponents: true\r\n  },\r\n  imageOptimization: {\r\n    enableWebP: true,\r\n    defaultQuality: 0.8,\r\n    maxWidth: 1920,\r\n    maxHeight: 1080,\r\n    enableCompression: true\r\n  },\r\n  monitoring: {\r\n    enablePerformanceMonitoring: true,\r\n    enableUserEngagementTracking: true,\r\n    enableErrorTracking: true,\r\n    sampleRate: 1.0 // 100% sampling in development\r\n  },\r\n  caching: {\r\n    enableComponentCache: true,\r\n    enableImageCache: true,\r\n    cacheMaxAge: 3600000, // 1 hour\r\n    maxCacheSize: 50 * 1024 * 1024 // 50MB\r\n  },\r\n  thresholds: {\r\n    maxLoadTime: 2000,      // 2 seconds\r\n    maxInitTime: 500,       // 500ms\r\n    maxApiResponseTime: 5000, // 5 seconds\r\n    maxMemoryUsage: 50 * 1024 * 1024, // 50MB\r\n    maxErrorRate: 0.05      // 5%\r\n  }\r\n};\r\n\r\nexport const productionPerformanceConfig: PerformanceConfig = {\r\n  ...defaultPerformanceConfig,\r\n  monitoring: {\r\n    ...defaultPerformanceConfig.monitoring,\r\n    sampleRate: 0.1 // 10% sampling in production\r\n  },\r\n  bundleOptimization: {\r\n    ...defaultPerformanceConfig.bundleOptimization,\r\n    maxBundleSize: 150 * 1024, // Stricter limit for production\r\n    maxGzipSize: 40 * 1024\r\n  }\r\n};\r\n\r\nexport class PerformanceConfigManager {\r\n  private config: PerformanceConfig;\r\n  private isProduction: boolean;\r\n\r\n  constructor(customConfig?: Partial<PerformanceConfig>) {\r\n    this.isProduction = process.env.NODE_ENV === 'production';\r\n    this.config = {\r\n      ...(this.isProduction ? productionPerformanceConfig : defaultPerformanceConfig),\r\n      ...customConfig\r\n    };\r\n  }\r\n\r\n  public getConfig(): PerformanceConfig {\r\n    return { ...this.config };\r\n  }\r\n\r\n  public updateConfig(updates: Partial<PerformanceConfig>): void {\r\n    this.config = { ...this.config, ...updates };\r\n  }\r\n\r\n  public getBundleConfig() {\r\n    return this.config.bundleOptimization;\r\n  }\r\n\r\n  public getLazyLoadingConfig() {\r\n    return this.config.lazyLoading;\r\n  }\r\n\r\n  public getImageOptimizationConfig() {\r\n    return this.config.imageOptimization;\r\n  }\r\n\r\n  public getMonitoringConfig() {\r\n    return this.config.monitoring;\r\n  }\r\n\r\n  public getCachingConfig() {\r\n    return this.config.caching;\r\n  }\r\n\r\n  public getThresholds() {\r\n    return this.config.thresholds;\r\n  }\r\n\r\n  public shouldEnableFeature(feature: keyof PerformanceConfig): boolean {\r\n    const featureConfig = this.config[feature];\r\n    \r\n    // Check if feature has an enable flag\r\n    if (typeof featureConfig === 'object' && featureConfig !== null) {\r\n      const enableKey = Object.keys(featureConfig).find(key => key.startsWith('enable'));\r\n      if (enableKey) {\r\n        return (featureConfig as any)[enableKey];\r\n      }\r\n    }\r\n    \r\n    return true;\r\n  }\r\n\r\n  public validateThresholds(metrics: {\r\n    loadTime?: number;\r\n    bundleSize?: number;\r\n    apiResponseTime?: number;\r\n    memoryUsage?: number;\r\n    errorRate?: number;\r\n  }): { [key: string]: boolean } {\r\n    const thresholds = this.getThresholds();\r\n    const results: { [key: string]: boolean } = {};\r\n\r\n    if (metrics.loadTime !== undefined) {\r\n      results.loadTime = metrics.loadTime <= thresholds.maxLoadTime;\r\n    }\r\n\r\n    if (metrics.bundleSize !== undefined) {\r\n      results.bundleSize = metrics.bundleSize <= this.config.bundleOptimization.maxBundleSize;\r\n    }\r\n\r\n    if (metrics.apiResponseTime !== undefined) {\r\n      results.apiResponseTime = metrics.apiResponseTime <= thresholds.maxApiResponseTime;\r\n    }\r\n\r\n    if (metrics.memoryUsage !== undefined) {\r\n      results.memoryUsage = metrics.memoryUsage <= thresholds.maxMemoryUsage;\r\n    }\r\n\r\n    if (metrics.errorRate !== undefined) {\r\n      results.errorRate = metrics.errorRate <= thresholds.maxErrorRate;\r\n    }\r\n\r\n    return results;\r\n  }\r\n}\r\n\r\n// Global performance config manager\r\nexport const performanceConfigManager = new PerformanceConfigManager();","// DinoOverlay Widget Entry Point\r\nexport { DinoOverlayLoader } from './core/DinoOverlayLoader';\r\nexport { ImageDetector } from './core/ImageDetector';\r\nexport { OverlayManager } from './core/OverlayManager';\r\nexport { ImageHighlighter } from './core/ImageHighlighter';\r\nexport { QuickActionSidebar } from './core/QuickActionSidebar';\r\nexport { FloatingChatBar } from './core/FloatingChatBar';\r\nexport { APIClient } from './core/APIClient';\r\nexport { ErrorManager } from './core/ErrorManager';\r\nexport { AnimationSystem, animationSystem } from './core/AnimationSystem';\r\nexport { OverlayAnimations, overlayAnimations } from './core/OverlayAnimations';\r\n\r\n// Performance and optimization exports\r\nexport { PerformanceMonitor, performanceMonitor } from './core/PerformanceMonitor';\r\nexport { ImageOptimizer, imageOptimizer, LazyImageLoader } from './core/ImageOptimizer';\r\nexport { LazyComponentLoader, lazyComponentLoader, componentLoaders } from './core/LazyComponentLoader';\r\nexport { PerformanceConfigManager, performanceConfigManager, defaultPerformanceConfig, productionPerformanceConfig } from './config/performance';\r\n\r\nexport type { DinoOverlayConfig } from './types/config';\r\nexport type { DetectionConfig, ImageDetectorEvents } from './core/ImageDetector';\r\nexport type { OverlayManagerEvents, Component } from './core/OverlayManager';\r\nexport type { HighlighterProps } from './core/ImageHighlighter';\r\nexport type { SelectedImage, OverlayState, Position, AnimationConfig, QuickAction, SidebarProps, ChatBarProps } from './types/overlay';\r\nexport type { \r\n  AnimationOptions, \r\n  AnimationKeyframe, \r\n  TransitionConfig, \r\n  AnimationCleanup \r\n} from './core/AnimationSystem';\r\nexport type { OverlayAnimationConfig } from './core/OverlayAnimations';\r\nexport type { \r\n  APIClientConfig, \r\n  EditImageRequest, \r\n  EditImageResponse, \r\n  ChatRequest, \r\n  ChatResponse, \r\n  APIError \r\n} from './types/api';\r\n\r\n// Performance types\r\nexport type { \r\n  PerformanceMetrics, \r\n  PerformanceThresholds \r\n} from './core/PerformanceMonitor';\r\nexport type { \r\n  ImageOptimizationOptions, \r\n  OptimizedImage \r\n} from './core/ImageOptimizer';\r\nexport type { \r\n  LazyComponentConfig, \r\n  ComponentLoadResult \r\n} from './core/LazyComponentLoader';\r\nexport type { \r\n  PerformanceConfig \r\n} from './config/performance';\r\n\r\n// Initialize global DinoOverlay object for script tag usage\r\ndeclare global {\r\n  interface Window {\r\n    DinoOverlay: {\r\n      init: (config: any) => void;\r\n      performanceMonitor: typeof performanceMonitor;\r\n      lazyComponentLoader: typeof lazyComponentLoader;\r\n      loadedComponents?: string[];\r\n    };\r\n  }\r\n}\r\n\r\n// Auto-initialize if config is provided via window\r\nif (typeof window !== 'undefined') {\r\n  window.DinoOverlay = {\r\n    init: (config) => {\r\n      // Start performance monitoring\r\n      performanceMonitor.trackUserEngagement('sessionDuration');\r\n      \r\n      const loader = new DinoOverlayLoader(config);\r\n      loader.initialize().then(() => {\r\n        // Track successful initialization\r\n        performanceMonitor.trackUserEngagement('actionsTriggered');\r\n      }).catch((error) => {\r\n        // Track initialization errors\r\n        performanceMonitor.trackApiRequest(0, true);\r\n        console.error('DinoOverlay initialization failed:', error);\r\n      });\r\n    },\r\n    performanceMonitor,\r\n    lazyComponentLoader,\r\n    get loadedComponents() {\r\n      return lazyComponentLoader.getLoadedComponents();\r\n    }\r\n  };\r\n}","import type {\r\n  APIClientConfig,\r\n  APIError,\r\n  APIRequest,\r\n  APIResponse,\r\n  EditImageRequest,\r\n  EditImageResponse,\r\n  ChatRequest,\r\n  ChatResponse,\r\n  RetryConfig,\r\n  RequestOptions\r\n} from '../types/api';\r\nimport { ErrorManager } from './ErrorManager';\r\n\r\nexport class APIClient {\r\n  private config: Required<APIClientConfig>;\r\n  private errorManager: ErrorManager;\r\n  private defaultRetryConfig: RetryConfig = {\r\n    maxRetries: 3,\r\n    baseDelay: 1000,\r\n    maxDelay: 10000,\r\n    backoffMultiplier: 2,\r\n    retryableStatuses: [408, 429, 500, 502, 503, 504]\r\n  };\r\n\r\n  constructor(config: APIClientConfig, errorManager?: ErrorManager) {\r\n    this.config = {\r\n      timeout: 30000,\r\n      retryConfig: { ...this.defaultRetryConfig, ...config.retryConfig },\r\n      debug: false,\r\n      ...config\r\n    };\r\n\r\n    this.errorManager = errorManager || new ErrorManager({\r\n      debug: this.config.debug,\r\n      enableUserNotifications: true,\r\n      enableErrorReporting: true\r\n    });\r\n\r\n    if (!this.config.baseUrl) {\r\n      throw new Error('APIClient: baseUrl is required');\r\n    }\r\n    if (!this.config.apiKey) {\r\n      throw new Error('APIClient: apiKey is required');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Edit an image using AI processing\r\n   */\r\n  public async editImage(request: EditImageRequest): Promise<EditImageResponse> {\r\n    this.validateEditImageRequest(request);\r\n\r\n    try {\r\n      const response = await this.makeRequest<EditImageResponse>({\r\n        method: 'POST',\r\n        endpoint: '/overlay/edit-image',\r\n        data: request,\r\n        options: {\r\n          timeout: 60000, // Longer timeout for image processing\r\n          retries: 2 // Fewer retries for expensive operations\r\n        }\r\n      });\r\n\r\n      return response.data;\r\n    } catch (error) {\r\n      this.logError('editImage', error);\r\n      const apiError = this.createAPIError(error, 'Failed to edit image');\r\n      this.errorManager.handleAPIError(apiError);\r\n      throw apiError;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send a chat message with optional image context\r\n   */\r\n  public async sendChatMessage(request: ChatRequest): Promise<ChatResponse> {\r\n    this.validateChatRequest(request);\r\n\r\n    try {\r\n      const response = await this.makeRequest<ChatResponse>({\r\n        method: 'POST',\r\n        endpoint: '/overlay/chat',\r\n        data: request\r\n      });\r\n\r\n      return response.data;\r\n    } catch (error) {\r\n      this.logError('sendChatMessage', error);\r\n      const apiError = this.createAPIError(error, 'Failed to send chat message');\r\n      this.errorManager.handleAPIError(apiError);\r\n      throw apiError;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Make an HTTP request with retry logic and error handling\r\n   */\r\n  private async makeRequest<T>(request: APIRequest): Promise<APIResponse<T>> {\r\n    const { method, endpoint, data, options = {} } = request;\r\n    const url = `${this.config.baseUrl}${endpoint}`;\r\n    const timeout = options.timeout || this.config.timeout;\r\n    const maxRetries = options.retries !== undefined ? options.retries : this.config.retryConfig.maxRetries;\r\n\r\n    let lastError: Error;\r\n    \r\n    for (let attempt = 0; attempt <= maxRetries; attempt++) {\r\n      try {\r\n        if (attempt > 0) {\r\n          const delay = this.calculateBackoffDelay(attempt);\r\n          await this.sleep(delay);\r\n          this.log(`Retrying request (attempt ${attempt + 1}/${maxRetries + 1}): ${method} ${url}`);\r\n        }\r\n\r\n        const response = await this.executeRequest<T>(method, url, data, timeout, options.headers);\r\n        \r\n        if (this.isSuccessStatus(response.status)) {\r\n          return response;\r\n        }\r\n\r\n        // Handle non-success status codes\r\n        const error = new Error(`HTTP ${response.status}: Request failed`);\r\n        (error as any).status = response.status;\r\n        (error as any).response = response;\r\n        \r\n        if (!this.isRetryableStatus(response.status) || attempt === maxRetries) {\r\n          throw error;\r\n        }\r\n        \r\n        lastError = error;\r\n        continue;\r\n\r\n      } catch (error) {\r\n        lastError = error as Error;\r\n        \r\n        // Don't retry on non-retryable errors\r\n        if (!this.isRetryableError(error as Error) || attempt === maxRetries) {\r\n          throw error;\r\n        }\r\n      }\r\n    }\r\n\r\n    throw lastError!;\r\n  }\r\n\r\n  /**\r\n   * Execute the actual HTTP request\r\n   */\r\n  private async executeRequest<T>(\r\n    method: string,\r\n    url: string,\r\n    data?: any,\r\n    timeout?: number,\r\n    customHeaders?: Record<string, string>\r\n  ): Promise<APIResponse<T>> {\r\n    const controller = new AbortController();\r\n    const timeoutId = timeout ? setTimeout(() => controller.abort(), timeout) : null;\r\n\r\n    try {\r\n      const headers: Record<string, string> = {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${this.config.apiKey}`,\r\n        'User-Agent': 'DinoOverlay/1.0',\r\n        ...customHeaders\r\n      };\r\n\r\n      const requestOptions: RequestInit = {\r\n        method,\r\n        headers,\r\n        signal: controller.signal\r\n      };\r\n\r\n      if (data && (method === 'POST' || method === 'PUT')) {\r\n        requestOptions.body = JSON.stringify(data);\r\n      }\r\n\r\n      this.log(`Making request: ${method} ${url}`);\r\n      \r\n      const response = await fetch(url, requestOptions);\r\n      \r\n      if (timeoutId) {\r\n        clearTimeout(timeoutId);\r\n      }\r\n\r\n      const responseHeaders: Record<string, string> = {};\r\n      response.headers.forEach((value, key) => {\r\n        responseHeaders[key] = value;\r\n      });\r\n\r\n      let responseData: T;\r\n      const contentType = response.headers.get('content-type');\r\n      \r\n      if (contentType && contentType.includes('application/json')) {\r\n        responseData = await response.json();\r\n      } else {\r\n        responseData = await response.text() as unknown as T;\r\n      }\r\n\r\n      return {\r\n        data: responseData,\r\n        status: response.status,\r\n        headers: responseHeaders,\r\n        requestId: responseHeaders['x-request-id']\r\n      };\r\n\r\n    } catch (error) {\r\n      if (timeoutId) {\r\n        clearTimeout(timeoutId);\r\n      }\r\n\r\n      if (controller.signal.aborted) {\r\n        throw new Error('Request timeout');\r\n      }\r\n\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate exponential backoff delay\r\n   */\r\n  private calculateBackoffDelay(attempt: number): number {\r\n    const { baseDelay, maxDelay, backoffMultiplier } = this.config.retryConfig;\r\n    const delay = baseDelay * Math.pow(backoffMultiplier, attempt - 1);\r\n    return Math.min(delay, maxDelay);\r\n  }\r\n\r\n  /**\r\n   * Sleep for specified milliseconds\r\n   */\r\n  private sleep(ms: number): Promise<void> {\r\n    return new Promise(resolve => setTimeout(resolve, ms));\r\n  }\r\n\r\n  /**\r\n   * Check if status code indicates success\r\n   */\r\n  private isSuccessStatus(status: number): boolean {\r\n    return status >= 200 && status < 300;\r\n  }\r\n\r\n  /**\r\n   * Check if status code is retryable\r\n   */\r\n  private isRetryableStatus(status: number): boolean {\r\n    return this.config.retryConfig.retryableStatuses.includes(status);\r\n  }\r\n\r\n  /**\r\n   * Check if error is retryable\r\n   */\r\n  private isRetryableError(error: Error): boolean {\r\n    const message = error.message.toLowerCase();\r\n    \r\n    // Network errors are generally retryable\r\n    if (message.includes('fetch') || \r\n        message.includes('network') ||\r\n        message.includes('timeout') ||\r\n        message.includes('econnreset') ||\r\n        message.includes('enotfound')) {\r\n      return true;\r\n    }\r\n\r\n    // Check if it's an HTTP error with retryable status\r\n    const status = (error as any).status;\r\n    if (status && this.isRetryableStatus(status)) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Create a standardized API error\r\n   */\r\n  private createAPIError(originalError: any, message: string): APIError {\r\n    const error = new Error(message) as APIError;\r\n    error.name = 'APIError';\r\n    \r\n    if (originalError.status) {\r\n      error.status = originalError.status;\r\n      error.code = `HTTP_${originalError.status}`;\r\n    } else if (originalError.message.includes('timeout')) {\r\n      error.code = 'TIMEOUT';\r\n      error.retryable = true;\r\n    } else if (originalError.message.includes('network')) {\r\n      error.code = 'NETWORK_ERROR';\r\n      error.retryable = true;\r\n    } else {\r\n      error.code = 'UNKNOWN_ERROR';\r\n    }\r\n\r\n    error.details = originalError;\r\n    return error;\r\n  }\r\n\r\n  /**\r\n   * Validate edit image request\r\n   */\r\n  private validateEditImageRequest(request: EditImageRequest): void {\r\n    if (!request.prompt || request.prompt.trim().length === 0) {\r\n      throw new Error('EditImageRequest: prompt is required');\r\n    }\r\n\r\n    if (!request.imageData && !request.imageUrl) {\r\n      throw new Error('EditImageRequest: either imageData or imageUrl is required');\r\n    }\r\n\r\n    if (request.imageData && !this.isValidBase64(request.imageData)) {\r\n      throw new Error('EditImageRequest: imageData must be valid base64');\r\n    }\r\n\r\n    if (request.prompt.length > 1000) {\r\n      throw new Error('EditImageRequest: prompt must be less than 1000 characters');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validate chat request\r\n   */\r\n  private validateChatRequest(request: ChatRequest): void {\r\n    if (!request.message || request.message.trim().length === 0) {\r\n      throw new Error('ChatRequest: message is required');\r\n    }\r\n\r\n    if (request.message.length > 2000) {\r\n      throw new Error('ChatRequest: message must be less than 2000 characters');\r\n    }\r\n\r\n    if (request.imageContext && !this.isValidBase64(request.imageContext)) {\r\n      throw new Error('ChatRequest: imageContext must be valid base64');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if string is valid base64\r\n   */\r\n  private isValidBase64(str: string): boolean {\r\n    try {\r\n      // Remove data URL prefix if present\r\n      const base64Data = str.replace(/^data:image\\/[a-z]+;base64,/, '');\r\n      \r\n      // Check if it's a valid base64 string\r\n      if (!/^[A-Za-z0-9+/]*={0,2}$/.test(base64Data)) {\r\n        return false;\r\n      }\r\n      \r\n      // Try to decode and re-encode\r\n      return btoa(atob(base64Data)) === base64Data;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Log debug messages\r\n   */\r\n  private log(message: string): void {\r\n    if (this.config.debug) {\r\n      console.log(`[APIClient] ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Log errors\r\n   */\r\n  private logError(operation: string, error: any): void {\r\n    if (this.config.debug) {\r\n      console.error(`[APIClient] ${operation} error:`, error);\r\n    }\r\n  }\r\n}","import { DinoOverlayConfig, DEFAULT_CONFIG, LoaderError } from '../types/config';\r\n\r\nexport class DinoOverlayLoader {\r\n  private config: Required<DinoOverlayConfig>;\r\n  private shadowRoot: ShadowRoot | null = null;\r\n  private container: HTMLElement | null = null;\r\n  private isInitialized: boolean = false;\r\n  private initializationPromise: Promise<void> | null = null;\r\n\r\n  constructor(config: DinoOverlayConfig) {\r\n    this.config = this.validateAndMergeConfig(config);\r\n  }\r\n\r\n  public async initialize(): Promise<void> {\r\n    // Prevent multiple initializations\r\n    if (this.initializationPromise) {\r\n      return this.initializationPromise;\r\n    }\r\n\r\n    if (this.isInitialized) {\r\n      // Return the cached promise if already initialized\r\n      if (!this.initializationPromise) {\r\n        this.initializationPromise = Promise.resolve();\r\n      }\r\n      return this.initializationPromise;\r\n    }\r\n\r\n    this.initializationPromise = this.performInitialization();\r\n    return this.initializationPromise;\r\n  }\r\n\r\n  public destroy(): void {\r\n    if (this.container && this.container.parentNode) {\r\n      this.container.parentNode.removeChild(this.container);\r\n    }\r\n    this.shadowRoot = null;\r\n    this.container = null;\r\n    this.isInitialized = false;\r\n    this.initializationPromise = null;\r\n  }\r\n\r\n  public getShadowRoot(): ShadowRoot | null {\r\n    return this.shadowRoot;\r\n  }\r\n\r\n  public getConfig(): Required<DinoOverlayConfig> {\r\n    return { ...this.config };\r\n  }\r\n\r\n  public isReady(): boolean {\r\n    return this.isInitialized && this.shadowRoot !== null;\r\n  }\r\n\r\n  private async performInitialization(): Promise<void> {\r\n    try {\r\n      this.validateEnvironment();\r\n      await this.createShadowDOM();\r\n      await this.loadStyles();\r\n      await this.mountOverlay();\r\n      this.isInitialized = true;\r\n      \r\n      if (this.config.debug) {\r\n        console.log('[DinoOverlay] Successfully initialized', this.config);\r\n      }\r\n    } catch (error) {\r\n      const loaderError = this.createLoaderError('INITIALIZATION_FAILED', error);\r\n      if (this.config.debug) {\r\n        console.error('[DinoOverlay] Initialization failed:', loaderError);\r\n      }\r\n      throw loaderError;\r\n    }\r\n  }\r\n\r\n  private validateAndMergeConfig(config: DinoOverlayConfig): Required<DinoOverlayConfig> {\r\n    if (!config || typeof config !== 'object') {\r\n      throw this.createLoaderError('INVALID_CONFIG', 'Configuration must be an object');\r\n    }\r\n\r\n    // Validate API key if provided\r\n    if (config.apiKey !== undefined && (typeof config.apiKey !== 'string' || config.apiKey.trim().length === 0)) {\r\n      throw this.createLoaderError('INVALID_API_KEY', 'API key must be a non-empty string');\r\n    }\r\n\r\n    // Validate API endpoint if provided\r\n    if (config.apiEndpoint) {\r\n      try {\r\n        new URL(config.apiEndpoint);\r\n      } catch {\r\n        throw this.createLoaderError('INVALID_API_ENDPOINT', 'API endpoint must be a valid URL');\r\n      }\r\n    }\r\n\r\n    // Validate theme\r\n    if (config.theme && !['light', 'dark', 'auto'].includes(config.theme)) {\r\n      throw this.createLoaderError('INVALID_THEME', 'Theme must be \"light\", \"dark\", or \"auto\"');\r\n    }\r\n\r\n    // Validate custom actions\r\n    if (config.customActions) {\r\n      if (!Array.isArray(config.customActions)) {\r\n        throw this.createLoaderError('INVALID_CUSTOM_ACTIONS', 'Custom actions must be an array');\r\n      }\r\n      \r\n      config.customActions.forEach((action, index) => {\r\n        if (!action.id || typeof action.id !== 'string') {\r\n          throw this.createLoaderError('INVALID_CUSTOM_ACTION', `Custom action at index ${index} must have a valid id`);\r\n        }\r\n        if (!action.label || typeof action.label !== 'string') {\r\n          throw this.createLoaderError('INVALID_CUSTOM_ACTION', `Custom action at index ${index} must have a valid label`);\r\n        }\r\n        if (!action.prompt || typeof action.prompt !== 'string') {\r\n          throw this.createLoaderError('INVALID_CUSTOM_ACTION', `Custom action at index ${index} must have a valid prompt`);\r\n        }\r\n      });\r\n    }\r\n\r\n    return {\r\n      ...DEFAULT_CONFIG,\r\n      ...config,\r\n      customActions: config.customActions || [],\r\n    } as Required<DinoOverlayConfig>;\r\n  }\r\n\r\n  private validateEnvironment(): void {\r\n    if (typeof window === 'undefined') {\r\n      throw this.createLoaderError('NO_WINDOW', 'DinoOverlay requires a browser environment');\r\n    }\r\n\r\n    if (typeof document === 'undefined') {\r\n      throw this.createLoaderError('NO_DOCUMENT', 'DinoOverlay requires DOM access');\r\n    }\r\n\r\n    if (!document.body) {\r\n      throw this.createLoaderError('NO_BODY', 'DinoOverlay requires document.body to be available');\r\n    }\r\n\r\n    // Check Shadow DOM support\r\n    if (!HTMLElement.prototype.attachShadow) {\r\n      throw this.createLoaderError('NO_SHADOW_DOM', 'DinoOverlay requires Shadow DOM support');\r\n    }\r\n  }\r\n\r\n  private async createShadowDOM(): Promise<void> {\r\n    try {\r\n      // Create container element\r\n      this.container = document.createElement('div');\r\n      this.container.id = 'dino-overlay-container';\r\n      this.container.style.cssText = `\r\n        position: fixed;\r\n        top: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n        pointer-events: none;\r\n        z-index: 2147483647;\r\n      `;\r\n\r\n      // Attach shadow root with closed mode for complete isolation\r\n      this.shadowRoot = this.container.attachShadow({ mode: 'closed' });\r\n\r\n      // Add container to DOM\r\n      document.body.appendChild(this.container);\r\n\r\n      if (this.config.debug) {\r\n        console.log('[DinoOverlay] Shadow DOM container created');\r\n      }\r\n    } catch (error) {\r\n      throw this.createLoaderError('SHADOW_DOM_CREATION_FAILED', error);\r\n    }\r\n  }\r\n\r\n  private async loadStyles(): Promise<void> {\r\n    if (!this.shadowRoot) {\r\n      throw this.createLoaderError('NO_SHADOW_ROOT', 'Shadow root not available for style loading');\r\n    }\r\n\r\n    try {\r\n      // Create style element with CSS reset and glassmorphic utilities\r\n      const styleElement = document.createElement('style');\r\n      styleElement.textContent = this.getBaseStyles();\r\n      \r\n      this.shadowRoot.appendChild(styleElement);\r\n\r\n      if (this.config.debug) {\r\n        console.log('[DinoOverlay] Base styles loaded');\r\n      }\r\n    } catch (error) {\r\n      throw this.createLoaderError('STYLE_LOADING_FAILED', error);\r\n    }\r\n  }\r\n\r\n  private async mountOverlay(): Promise<void> {\r\n    if (!this.shadowRoot) {\r\n      throw this.createLoaderError('NO_SHADOW_ROOT', 'Shadow root not available for overlay mounting');\r\n    }\r\n\r\n    try {\r\n      // Create root overlay container\r\n      const overlayRoot = document.createElement('div');\r\n      overlayRoot.id = 'overlay-root';\r\n      overlayRoot.className = 'dino-overlay-root';\r\n      \r\n      this.shadowRoot.appendChild(overlayRoot);\r\n\r\n      if (this.config.debug) {\r\n        console.log('[DinoOverlay] Overlay root mounted');\r\n      }\r\n    } catch (error) {\r\n      throw this.createLoaderError('OVERLAY_MOUNTING_FAILED', error);\r\n    }\r\n  }\r\n\r\n  private getBaseStyles(): string {\r\n    return `\r\n      /* CSS Reset for Shadow DOM */\r\n      *, *::before, *::after {\r\n        box-sizing: border-box;\r\n        margin: 0;\r\n        padding: 0;\r\n      }\r\n\r\n      /* Base overlay styles */\r\n      .dino-overlay-root {\r\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n        font-size: 14px;\r\n        line-height: 1.5;\r\n        color: #333;\r\n        pointer-events: none;\r\n        position: relative;\r\n        width: 100%;\r\n        height: 100%;\r\n      }\r\n\r\n      /* Glassmorphic utilities */\r\n      .glass {\r\n        background: rgba(255, 255, 255, 0.1);\r\n        backdrop-filter: blur(10px);\r\n        -webkit-backdrop-filter: blur(10px);\r\n        border: 1px solid rgba(255, 255, 255, 0.2);\r\n        border-radius: 12px;\r\n      }\r\n\r\n      .glass-dark {\r\n        background: rgba(0, 0, 0, 0.1);\r\n        backdrop-filter: blur(10px);\r\n        -webkit-backdrop-filter: blur(10px);\r\n        border: 1px solid rgba(255, 255, 255, 0.1);\r\n        border-radius: 12px;\r\n      }\r\n\r\n      /* Interactive elements */\r\n      .interactive {\r\n        pointer-events: auto;\r\n        cursor: pointer;\r\n        transition: all 0.2s ease;\r\n      }\r\n\r\n      .interactive:hover {\r\n        transform: scale(1.02);\r\n        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\r\n      }\r\n\r\n      /* Animation utilities */\r\n      .fade-in {\r\n        animation: fadeIn 0.3s ease-out;\r\n      }\r\n\r\n      .slide-in-right {\r\n        animation: slideInRight 0.3s ease-out;\r\n      }\r\n\r\n      @keyframes fadeIn {\r\n        from { opacity: 0; }\r\n        to { opacity: 1; }\r\n      }\r\n\r\n      @keyframes slideInRight {\r\n        from { \r\n          opacity: 0;\r\n          transform: translateX(100%);\r\n        }\r\n        to { \r\n          opacity: 1;\r\n          transform: translateX(0);\r\n        }\r\n      }\r\n\r\n      /* Responsive utilities */\r\n      @media (max-width: 768px) {\r\n        .dino-overlay-root {\r\n          font-size: 12px;\r\n        }\r\n      }\r\n    `;\r\n  }\r\n\r\n  private createLoaderError(code: string, error: any): LoaderError {\r\n    const message = error instanceof Error ? error.message : String(error);\r\n    const loaderError = new Error(`[DinoOverlay] ${message}`) as LoaderError;\r\n    loaderError.code = code;\r\n    loaderError.details = error;\r\n    return loaderError;\r\n  }\r\n}","import { OverlayState, SelectedImage, Position } from '../types/overlay';\r\nimport { DinoOverlayConfig } from '../types/config';\r\nimport { ThemeConfig, ThemeMode } from '../types/theme';\r\nimport { ImageDetector, DetectionConfig } from './ImageDetector';\r\nimport { ResponsiveManager } from './ResponsiveManager';\r\nimport { ThemeManager } from './ThemeManager';\r\n\r\nexport interface OverlayManagerEvents {\r\n  stateChanged: (state: OverlayState, previousState: OverlayState) => void;\r\n  imageSelected: (selectedImage: SelectedImage) => void;\r\n  imageDeselected: (previousImage: SelectedImage) => void;\r\n  imagePositionUpdated: (selectedImage: SelectedImage) => void;\r\n  sidebarToggled: (visible: boolean) => void;\r\n  chatBarToggled: (visible: boolean) => void;\r\n  processingStateChanged: (isProcessing: boolean, action?: string) => void;\r\n  themeChanged: (theme: ThemeConfig, previousTheme: ThemeConfig) => void;\r\n}\r\n\r\nexport interface Component {\r\n  render(): HTMLElement;\r\n  destroy(): void;\r\n  update?(state: OverlayState): void;\r\n  updateTheme?(theme: ThemeConfig): void;\r\n}\r\n\r\nexport class OverlayManager {\r\n  private state: OverlayState;\r\n  private previousState: OverlayState;\r\n  private components: Map<string, Component> = new Map();\r\n  private eventListeners: Map<string, Function[]> = new Map();\r\n  private imageDetector: ImageDetector;\r\n  private responsiveManager: ResponsiveManager;\r\n  private themeManager: ThemeManager;\r\n  private shadowRoot: ShadowRoot;\r\n  private config: Required<DinoOverlayConfig>;\r\n  private positionUpdateTimer: number | null = null;\r\n  private isDestroyed: boolean = false;\r\n\r\n  constructor(\r\n    shadowRoot: ShadowRoot,\r\n    config: Required<DinoOverlayConfig>\r\n  ) {\r\n    this.shadowRoot = shadowRoot;\r\n    this.config = config;\r\n\r\n    // Initialize state\r\n    this.state = this.createInitialState();\r\n    this.previousState = { ...this.state };\r\n\r\n    // Initialize image detector\r\n    const detectionConfig: DetectionConfig = {\r\n      className: 'editable-room',\r\n      observeChanges: true,\r\n      debounceMs: 150,\r\n      debug: config.debug\r\n    };\r\n\r\n    this.imageDetector = new ImageDetector(detectionConfig);\r\n    this.setupImageDetectorListeners();\r\n\r\n    // Initialize responsive manager\r\n    this.responsiveManager = new ResponsiveManager(config);\r\n    this.setupResponsiveManagerListeners();\r\n\r\n    // Initialize theme manager\r\n    this.themeManager = new ThemeManager(shadowRoot, config);\r\n    this.setupThemeManagerListeners();\r\n\r\n    // Bind methods to preserve context\r\n    this.handleWindowResize = this.handleWindowResize.bind(this);\r\n    this.handleWindowScroll = this.handleWindowScroll.bind(this);\r\n    this.handleDocumentClick = this.handleDocumentClick.bind(this);\r\n  }\r\n\r\n  public initialize(): void {\r\n    if (this.isDestroyed) {\r\n      throw new Error('OverlayManager has been destroyed');\r\n    }\r\n\r\n    // Start image detection\r\n    this.imageDetector.startDetection();\r\n\r\n    // Initialize responsive manager\r\n    this.responsiveManager.initialize();\r\n\r\n    // Initialize theme manager\r\n    this.themeManager.initialize();\r\n\r\n    // Setup global event listeners\r\n    this.setupGlobalEventListeners();\r\n\r\n    if (this.config.debug) {\r\n      console.log('[OverlayManager] Initialized');\r\n    }\r\n  }\r\n\r\n  public destroy(): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    this.isDestroyed = true;\r\n\r\n    // Clear position update timer\r\n    if (this.positionUpdateTimer) {\r\n      clearTimeout(this.positionUpdateTimer);\r\n      this.positionUpdateTimer = null;\r\n    }\r\n\r\n    // Destroy image detector\r\n    this.imageDetector.destroy();\r\n\r\n    // Destroy responsive manager\r\n    this.responsiveManager.destroy();\r\n\r\n    // Destroy theme manager\r\n    this.themeManager.destroy();\r\n\r\n    // Remove global event listeners\r\n    this.removeGlobalEventListeners();\r\n\r\n    // Destroy all components\r\n    for (const component of this.components.values()) {\r\n      component.destroy();\r\n    }\r\n    this.components.clear();\r\n\r\n    // Clear event listeners\r\n    this.eventListeners.clear();\r\n\r\n    if (this.config.debug) {\r\n      console.log('[OverlayManager] Destroyed');\r\n    }\r\n  }\r\n\r\n  public getState(): OverlayState {\r\n    return { ...this.state };\r\n  }\r\n\r\n  public selectImage(image: HTMLImageElement): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const selectedImage = this.imageDetector.createSelectedImage(image);\r\n      const previousImage = this.state.selectedImage;\r\n\r\n      this.setState({\r\n        selectedImage,\r\n        sidebarVisible: true,\r\n        chatBarVisible: true\r\n      });\r\n\r\n      // Emit specific events\r\n      this.emit('imageSelected', selectedImage);\r\n      \r\n      if (previousImage) {\r\n        this.emit('imageDeselected', previousImage);\r\n      }\r\n\r\n      if (this.config.debug) {\r\n        console.log('[OverlayManager] Image selected:', image);\r\n      }\r\n    } catch (error) {\r\n      console.error('[OverlayManager] Failed to select image:', error);\r\n    }\r\n  }\r\n\r\n  public clearSelection(): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    const previousImage = this.state.selectedImage;\r\n    \r\n    this.setState({\r\n      selectedImage: null,\r\n      sidebarVisible: false,\r\n      chatBarVisible: false,\r\n      currentAction: null\r\n    });\r\n\r\n    if (previousImage) {\r\n      this.emit('imageDeselected', previousImage);\r\n    }\r\n\r\n    if (this.config.debug) {\r\n      console.log('[OverlayManager] Selection cleared');\r\n    }\r\n  }\r\n\r\n  public updateImagePosition(): void {\r\n    if (this.isDestroyed || !this.state.selectedImage) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const updatedRect = this.imageDetector.calculateImageBounds(\r\n        this.state.selectedImage.element\r\n      );\r\n\r\n      const updatedSelectedImage: SelectedImage = {\r\n        ...this.state.selectedImage,\r\n        rect: updatedRect\r\n      };\r\n\r\n      this.setState({\r\n        selectedImage: updatedSelectedImage\r\n      });\r\n\r\n      this.emit('imagePositionUpdated', updatedSelectedImage);\r\n\r\n      if (this.config.debug) {\r\n        console.log('[OverlayManager] Image position updated');\r\n      }\r\n    } catch (error) {\r\n      console.error('[OverlayManager] Failed to update image position:', error);\r\n      // If image is no longer valid, clear selection\r\n      this.clearSelection();\r\n    }\r\n  }\r\n\r\n  public setSidebarVisible(visible: boolean): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    if (this.state.sidebarVisible !== visible) {\r\n      this.setState({ sidebarVisible: visible });\r\n      this.emit('sidebarToggled', visible);\r\n    }\r\n  }\r\n\r\n  public setChatBarVisible(visible: boolean): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    if (this.state.chatBarVisible !== visible) {\r\n      this.setState({ chatBarVisible: visible });\r\n      this.emit('chatBarToggled', visible);\r\n    }\r\n  }\r\n\r\n  public setProcessingState(isProcessing: boolean, action?: string): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    this.setState({\r\n      isProcessing,\r\n      currentAction: isProcessing ? action || null : null\r\n    });\r\n\r\n    this.emit('processingStateChanged', isProcessing, action);\r\n  }\r\n\r\n  public setState(updates: Partial<OverlayState>): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    this.previousState = { ...this.state };\r\n    this.state = { ...this.state, ...updates };\r\n\r\n    // Update all components with new state\r\n    this.updateComponents();\r\n\r\n    // Emit state change event\r\n    this.emit('stateChanged', this.state, this.previousState);\r\n\r\n    if (this.config.debug) {\r\n      console.log('[OverlayManager] State updated:', updates);\r\n    }\r\n  }\r\n\r\n  public registerComponent(name: string, component: Component): void {\r\n    if (this.isDestroyed) {\r\n      throw new Error('Cannot register component on destroyed OverlayManager');\r\n    }\r\n\r\n    if (this.components.has(name)) {\r\n      console.warn(`[OverlayManager] Component '${name}' already registered, replacing`);\r\n      this.components.get(name)?.destroy();\r\n    }\r\n\r\n    this.components.set(name, component);\r\n\r\n    // Update component with current state\r\n    if (component.update) {\r\n      component.update(this.state);\r\n    }\r\n\r\n    if (this.config.debug) {\r\n      console.log(`[OverlayManager] Component '${name}' registered`);\r\n    }\r\n  }\r\n\r\n  public unregisterComponent(name: string): void {\r\n    const component = this.components.get(name);\r\n    if (component) {\r\n      component.destroy();\r\n      this.components.delete(name);\r\n\r\n      if (this.config.debug) {\r\n        console.log(`[OverlayManager] Component '${name}' unregistered`);\r\n      }\r\n    }\r\n  }\r\n\r\n  public getComponent<T extends Component>(name: string): T | undefined {\r\n    return this.components.get(name) as T | undefined;\r\n  }\r\n\r\n  public on<K extends keyof OverlayManagerEvents>(\r\n    event: K,\r\n    callback: OverlayManagerEvents[K]\r\n  ): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, []);\r\n    }\r\n    this.eventListeners.get(event)!.push(callback);\r\n  }\r\n\r\n  public off<K extends keyof OverlayManagerEvents>(\r\n    event: K,\r\n    callback: OverlayManagerEvents[K]\r\n  ): void {\r\n    const listeners = this.eventListeners.get(event);\r\n    if (listeners) {\r\n      const index = listeners.indexOf(callback);\r\n      if (index > -1) {\r\n        listeners.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  public getImageDetector(): ImageDetector {\r\n    return this.imageDetector;\r\n  }\r\n\r\n  public getShadowRoot(): ShadowRoot {\r\n    return this.shadowRoot;\r\n  }\r\n\r\n  public getConfig(): Required<DinoOverlayConfig> {\r\n    return { ...this.config };\r\n  }\r\n\r\n  public getResponsiveManager(): ResponsiveManager {\r\n    return this.responsiveManager;\r\n  }\r\n\r\n  public getThemeManager(): ThemeManager {\r\n    return this.themeManager;\r\n  }\r\n\r\n  public getCurrentTheme(): ThemeConfig {\r\n    return this.themeManager.getCurrentTheme();\r\n  }\r\n\r\n  public setThemeMode(mode: ThemeMode): void {\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    this.themeManager.setMode(mode);\r\n  }\r\n\r\n  private createInitialState(): OverlayState {\r\n    return {\r\n      selectedImage: null,\r\n      sidebarVisible: false,\r\n      chatBarVisible: false,\r\n      isProcessing: false,\r\n      currentAction: null\r\n    };\r\n  }\r\n\r\n  private setupImageDetectorListeners(): void {\r\n    this.imageDetector.on('imageDetected', (image) => {\r\n      // Add click listener to detected images\r\n      this.attachImageClickListener(image);\r\n    });\r\n\r\n    this.imageDetector.on('imageRemoved', (image) => {\r\n      // If the removed image was selected, clear selection\r\n      if (this.state.selectedImage?.element === image) {\r\n        this.clearSelection();\r\n      }\r\n      \r\n      this.detachImageClickListener(image);\r\n    });\r\n\r\n    this.imageDetector.on('imageUpdated', (image) => {\r\n      // If the updated image is selected, update its position\r\n      if (this.state.selectedImage?.element === image) {\r\n        this.schedulePositionUpdate();\r\n      }\r\n    });\r\n  }\r\n\r\n  private setupResponsiveManagerListeners(): void {\r\n    this.responsiveManager.on('breakpointChanged', (viewport, previousViewport) => {\r\n      if (this.config.debug) {\r\n        console.log('[OverlayManager] Breakpoint changed:', { viewport, previousViewport });\r\n      }\r\n      \r\n      // Update component positioning if needed\r\n      if (this.state.selectedImage) {\r\n        this.schedulePositionUpdate();\r\n      }\r\n    });\r\n\r\n    this.responsiveManager.on('orientationChanged', (orientation) => {\r\n      if (this.config.debug) {\r\n        console.log('[OverlayManager] Orientation changed:', orientation);\r\n      }\r\n      \r\n      // Update positioning after orientation change\r\n      setTimeout(() => {\r\n        if (this.state.selectedImage) {\r\n          this.updateImagePosition();\r\n        }\r\n      }, 100);\r\n    });\r\n  }\r\n\r\n  private setupThemeManagerListeners(): void {\r\n    this.themeManager.on('themeChanged', (theme, previousTheme) => {\r\n      if (this.config.debug) {\r\n        console.log('[OverlayManager] Theme changed:', { \r\n          from: previousTheme.mode, \r\n          to: theme.mode \r\n        });\r\n      }\r\n      \r\n      // Emit theme change event for components\r\n      this.emit('themeChanged', theme, previousTheme);\r\n      \r\n      // Update all components with new theme\r\n      this.updateComponents();\r\n    });\r\n\r\n    this.themeManager.on('modeChanged', (mode, previousMode) => {\r\n      if (this.config.debug) {\r\n        console.log('[OverlayManager] Theme mode changed:', { \r\n          from: previousMode, \r\n          to: mode \r\n        });\r\n      }\r\n    });\r\n\r\n    this.themeManager.on('detectionCompleted', (result) => {\r\n      if (this.config.debug) {\r\n        console.log('[OverlayManager] Theme detection completed:', result);\r\n      }\r\n    });\r\n  }\r\n\r\n  private attachImageClickListener(image: HTMLImageElement): void {\r\n    const handleClick = (event: Event) => {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      this.selectImage(image);\r\n    };\r\n\r\n    image.addEventListener('click', handleClick);\r\n    (image as any).__dinoClickListener = handleClick;\r\n  }\r\n\r\n  private detachImageClickListener(image: HTMLImageElement): void {\r\n    const listener = (image as any).__dinoClickListener;\r\n    if (listener) {\r\n      image.removeEventListener('click', listener);\r\n      delete (image as any).__dinoClickListener;\r\n    }\r\n  }\r\n\r\n  private setupGlobalEventListeners(): void {\r\n    window.addEventListener('resize', this.handleWindowResize, { passive: true });\r\n    window.addEventListener('scroll', this.handleWindowScroll, { passive: true });\r\n    document.addEventListener('click', this.handleDocumentClick);\r\n  }\r\n\r\n  private removeGlobalEventListeners(): void {\r\n    window.removeEventListener('resize', this.handleWindowResize);\r\n    window.removeEventListener('scroll', this.handleWindowScroll);\r\n    document.removeEventListener('click', this.handleDocumentClick);\r\n  }\r\n\r\n  private handleWindowResize(): void {\r\n    this.schedulePositionUpdate();\r\n  }\r\n\r\n  private handleWindowScroll(): void {\r\n    this.schedulePositionUpdate();\r\n  }\r\n\r\n  private handleDocumentClick(event: Event): void {\r\n    // Check if click is outside the overlay system\r\n    const target = event.target as Element;\r\n    \r\n    // Don't close if clicking on an editable image\r\n    if (target instanceof HTMLImageElement && \r\n        target.classList.contains('editable-room')) {\r\n      return;\r\n    }\r\n\r\n    // Don't close if clicking inside the shadow DOM\r\n    if (this.shadowRoot.contains(target)) {\r\n      return;\r\n    }\r\n\r\n    // Close sidebar and chat bar if clicking outside\r\n    if (this.state.sidebarVisible || this.state.chatBarVisible) {\r\n      this.setState({\r\n        sidebarVisible: false,\r\n        chatBarVisible: false\r\n      });\r\n    }\r\n  }\r\n\r\n  private schedulePositionUpdate(): void {\r\n    if (this.positionUpdateTimer) {\r\n      clearTimeout(this.positionUpdateTimer);\r\n    }\r\n\r\n    this.positionUpdateTimer = window.setTimeout(() => {\r\n      this.updateImagePosition();\r\n    }, 16); // ~60fps\r\n  }\r\n\r\n  private updateComponents(): void {\r\n    const currentTheme = this.themeManager.getCurrentTheme();\r\n    \r\n    for (const component of this.components.values()) {\r\n      if (component.update) {\r\n        try {\r\n          component.update(this.state);\r\n        } catch (error) {\r\n          console.error('[OverlayManager] Error updating component:', error);\r\n        }\r\n      }\r\n      \r\n      if (component.updateTheme) {\r\n        try {\r\n          component.updateTheme(currentTheme);\r\n        } catch (error) {\r\n          console.error('[OverlayManager] Error updating component theme:', error);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private emit<K extends keyof OverlayManagerEvents>(\r\n    event: K,\r\n    ...args: Parameters<OverlayManagerEvents[K]>\r\n  ): void {\r\n    const listeners = this.eventListeners.get(event);\r\n    if (listeners) {\r\n      for (const listener of listeners) {\r\n        try {\r\n          (listener as any)(...args);\r\n        } catch (error) {\r\n          console.error(`[OverlayManager] Error in ${event} listener:`, error);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}"],"names":["DEFAULT_CONFIG","apiEndpoint","theme","enableAnalytics","debug","ImageDetector","constructor","config","this","observer","detectedImages","Set","eventListeners","Map","resizeObserver","scrollDebounceTimer","resizeDebounceTimer","isActive","className","observeChanges","debounceMs","handleScroll","bind","handleResize","handleMutation","startDetection","setupMutationObserver","setupEventListeners","performInitialScan","error","Error","stopDetection","cleanup","getDetectedImages","Array","from","isImageDetected","image","has","calculateImageBounds","isConnected","getBoundingClientRect","getImageBorderRadius","window","getComputedStyle","borderRadius","createSelectedImage","element","rect","on","event","callback","set","get","push","off","listeners","index","indexOf","splice","MutationObserver","observe","document","body","childList","subtree","attributes","attributeFilter","addEventListener","passive","ResizeObserver","entries","entry","target","emit","images","scanForImages","addDetectedImage","selector","elements","querySelectorAll","filter","HTMLImageElement","isValidImage","offsetWidth","offsetHeight","complete","naturalWidth","computedStyle","display","visibility","add","attachImageListeners","removeDetectedImage","delete","detachImageListeners","unobserve","handleLoad","handleError","__dinoListeners","removeEventListener","mutations","hasChanges","mutation","type","node","addedNodes","nodeType","Node","ELEMENT_NODE","classList","contains","img","removedNodes","hadClass","hasClass","clearTimeout","setTimeout","args","listener","disconnect","clear","destroy","ResponsiveManager","mediaQueries","isDestroyed","breakpoints","mobile","tablet","desktop","currentViewport","calculateViewportInfo","previousViewport","handleOrientationChange","handleMediaQueryChange","initialize","setupMediaQueries","setupResizeObserver","key","mediaQuery","getViewportInfo","isMobile","isTablet","isDesktop","isTouchDevice","getBreakpoints","setBreakpoints","updateViewportInfo","getOptimalSidebarWidth","Math","min","width","getOptimalChatBarPosition","padding","bottom","right","left","shouldUseMobileLayout","orientation","getTouchTargetSize","innerWidth","height","innerHeight","devicePixelRatio","detectTouchDevice","navigator","maxTouchPoints","msMaxTouchPoints","hasBreakpointChanged","queries","portrait","landscape","touch","hover","query","Object","matchMedia","resizeTimeout","LIGHT_THEME","mode","glassmorphism","background","backdropBlur","border","shadow","text","textSecondary","accent","accentHover","success","warning","colors","primary","secondary","surface","animations","duration","fast","normal","slow","easing","ease","easeIn","easeOut","easeInOut","DARK_THEME","DEFAULT_THEME","ThemeManager","shadowRoot","mediaQueryList","hostObserver","cssVariablesStyleElement","currentTheme","previousTheme","handleHostStyleChange","detectAndApplyTheme","setupThemeDetection","applyCSSCustomProperties","parentNode","removeChild","getCurrentTheme","getMode","setMode","previousMode","detectHostTheme","matches","detectedTheme","confidence","method","hostBackgroundResult","analyzeHostBackground","analyzeComputedStyles","applyTheme","getCSSCustomProperties","themeToApply","detectionResult","setupHostStyleObserver","documentElement","bodyStyles","htmlStyles","backgroundColor","brightness","calculateColorBrightness","details","computedBrightness","selectors","querySelector","styles","textColor","color","textBrightness","rgb","parseColor","r","g","b","rgbMatch","match","parseInt","hexMatch","shortHexMatch","properties","createElement","textContent","map","value","join","appendChild","AnimationSystem","activeAnimations","animationCounter","defaultEasing","slideIn","direction","options","animationId","generateAnimationId","fill","transforms","getSlideTransforms","keyframes","transform","opacity","to","createAnimation","slideOut","fadeIn","fadeOut","scale","fromScale","toScale","glow","iterations","Infinity","boxShadow","borderColor","replace","pulse","bounce","shake","spin","applyTransition","transitions","transitionStrings","delay","property","style","transition","setupHoverAnimation","hoverStyles","scaleOnHover","glowOnHover","glowColor","originalStyles","keys","forEach","styleKey","transitionProperties","handleMouseEnter","assign","handleMouseLeave","setupFocusAnimation","focusStyles","glowOnFocus","handleFocus","handleBlur","cancelAnimation","animation","cancel","cancelAllAnimations","getActiveAnimationCount","size","isAnimationActive","createCustomAnimation","animate","finish","pause","play","createCSSFallbackAnimation","finalKeyframe","length","up","down","prefix","Date","now","animationSystem","OverlayAnimations","activeCleanups","prefersReducedMotion","detectReducedMotionPreference","animateSidebarIn","sidebarElement","cleanupId","cleanupPrevious","shouldSkipAnimation","createNoOpCleanup","pointerEvents","backdrop","panel","stagger","animateSidebarOut","animateChatBarIn","chatBarElement","animateChatBarOut","animateHighlighterIn","highlighterElement","selectedImage","positionHighlighter","borderWidth","startHighlighterGlow","animateHighlighterOut","stopHighlighterGlow","setupButtonHoverAnimation","buttonElement","setupButtonFocusAnimation","animateLoadingState","isLoading","spinner","createLoadingSpinner","iconElement","innerHTML","remove","animateErrorState","originalBackground","originalBorder","animateStaggeredList","listElement","items","children","staggerDelay","cleanups","item","cleanupAnimation","existingCleanup","respectsReducedMotion","e","position","top","zIndex","glowCleanup","borderTop","spinCleanup","overlayAnimations","ImageHighlighter","props","glowAnimation","animationCleanups","hoverCleanups","require","handleCloseClick","handleImageClick","render","updateElement","update","state","newProps","stopGlowAnimation","highlighter","applyBaseStyles","closeButton","createCloseButton","updateBorderRadius","backdropFilter","WebkitBackdropFilter","willChange","button","setAttribute","fontSize","fontWeight","lineHeight","cursor","hoverCleanup","focusCleanup","startGlowAnimation","animationConfig","updatedSelectedImage","preventDefault","stopPropagation","onClose","onImageClick","calculateBorderRadius","topLeft","borderTopLeftRadius","topRight","borderTopRightRadius","bottomRight","borderBottomRightRadius","bottomLeft","borderBottomLeftRadius","createGlowKeyframes","TouchGestureHandler","touchStart","touchCurrent","lastTap","tapCount","tapTimeout","doubleTapTimeout","swipeThreshold","swipeVelocityThreshold","maxTapDistance","handleTouchStart","handleTouchMove","handleTouchEnd","handleTouchCancel","removeEventListeners","updateConfig","touches","createTouchPoint","calculateDistance","touchEnd","distance","timestamp","velocity","handleSwipeGesture","handleTapGesture","start","end","deltaX","x","deltaY","y","abs","swipeGesture","startPoint","endPoint","point","isDoubleTap","doubleTapGesture","tapGesture","firstTap","secondTap","timeDiff","clientX","clientY","point1","point2","sqrt","QuickActionSidebar","responsiveManager","slideAnimation","touchGestureHandler","actions","getDefaultActions","handleActionClick","handleBackdropClick","handleViewportChange","setupResponsiveHandling","setupTouchGestures","visible","sidebarVisible","isProcessing","currentAction","wasVisible","isVisible","updateTheme","applyThemeStyles","setCustomActions","updateActionButtons","sidebar","createBackdrop","createSidebarPanel","applySidebarPanelStyles","header","createSidebarHeader","actionsContainer","createActionsContainer","borderBottom","marginBottom","title","margin","subtitle","container","flexDirection","gap","maxHeight","overflowY","scrollbarWidth","scrollbarColor","existingContainer","action","createActionButton","id","applyActionButtonStyles","content","createButtonContent","alignItems","icon","flexShrink","justifyContent","flex","textAlign","label","description","getActionDescription","maxWidth","borderRight","WebkitOverflowScrolling","overscrollBehavior","touchTargetSize","minHeight","WebkitTapHighlightColor","touchAction","userSelect","WebkitUserSelect","isButtonDisabled","updateProcessingStates","actionId","getAttribute","setButtonLoading","setButtonDisabled","loading","loadingCleanup","find","a","disabled","head","prompt","category","minimalist","scandi","modern","lighting","plants","artwork","onActionClick","viewport","updateResponsiveStyles","gesture","updateCloseButtonForTouch","FloatingChatBar","inputElement","sendButton","typingIndicator","isAnimating","handleSubmit","handleKeyPress","handleInputChange","handleSendClick","updateVisibility","chatBarVisible","onSubmit","placeholder","updateProps","prevVisible","updateProcessingState","updatePlaceholder","show","hide","focusInput","focus","clearInput","updateSendButtonState","getContainerClasses","cssText","getContainerStyles","chatBar","inputContainer","getSendButtonIcon","calculatePosition","shouldBeVisible","trim","hasText","message","shiftKey","updateInputForTouch","updateSendButtonForTouch","ErrorManager","errorQueue","retryAttempts","networkStatus","isOnline","onLine","lastChecked","rateLimitInfo","errorCounts","windowStartTime","maxRetryAttempts","retryBaseDelay","retryMaxDelay","rateLimitWindow","maxErrorsPerWindow","enableUserNotifications","enableErrorReporting","setupNetworkMonitoring","setupErrorReporting","handleNetworkError","errorDetails","code","getNetworkErrorCode","userMessage","getNetworkErrorMessage","retryable","context","originalError","processError","handleImageError","imageContext","getImageErrorCode","getImageErrorMessage","isImageErrorRetryable","handleDOMError","domContext","getDOMErrorCode","getDOMErrorMessage","userAgent","handleConfigError","configContext","getConfigErrorCode","getConfigErrorMessage","handleAPIError","isRateLimit","isRateLimitError","getAPIErrorCode","getAPIErrorMessage","retryAfter","extractRetryAfter","status","apiCode","updateRateLimitInfo","shouldRetry","errorKey","resetTime","calculateRetryDelay","attemptNumber","exponentialDelay","pow","jitter","random","floor","recordRetryAttempt","attempts","attempt","clearRetryAttempts","getNetworkStatus","getRateLimitInfo","showUserError","notification","createErrorNotification","displayNotification","shift","updateErrorCounts","reportError","currentCount","connection","connectionType","effectiveType","filename","lineno","colno","reason","toLowerCase","includes","remaining","limit","retryInfo","onclick","PerformanceMonitor","thresholds","apiRequestTimes","errorCount","totalRequests","observers","startTime","performance","maxLoadTime","maxBundleSize","maxApiResponseTime","maxErrorRate","maxMemoryUsage","metrics","loadTime","bundleSize","apiResponseTime","errorRate","memoryUsage","userEngagement","imagesSelected","actionsTriggered","chatMessages","sessionDuration","initializeMonitoring","setupResourceObserver","setupNavigationObserver","setupMemoryObserver","readyState","calculateLoadTime","resourceObserver","PerformanceObserver","list","getEntries","name","transferSize","entryTypes","navigationObserver","navEntry","loadEventEnd","navigationStart","setInterval","memory","usedJSHeapSize","trackApiRequest","responseTime","isError","reduce","trackUserEngagement","increment","getMetrics","checkThresholds","generateReport","thresholdResults","toFixed","performanceMonitor","ImageOptimizer","supportsWebP","canvas","ctx","getContext","detectWebPSupport","Promise","resolve","webP","Image","onload","onerror","src","optimizeImage","imageElement","quality","originalSize","getImageSize","loadImageToCanvas","format","determineOptimalFormat","optimizedData","compressImage","optimizedSize","calculateDataSize","data","compressionRatio","reject","crossOrigin","calculateOptimalDimensions","naturalHeight","clearRect","drawImage","originalWidth","originalHeight","round","requestedFormat","mimeType","toDataURL","response","fetch","blob","startsWith","base64","split","dataUrl","createLazyLoadObserver","defaultOptions","root","rootMargin","threshold","IntersectionObserver","preloadImage","generateSrcSet","baseSrc","sizes","generateSizes","defaultBreakpoints","sizeEntries","slice","fallbackSize","LazyImageLoader","optimizer","loadedImages","handleIntersection","isIntersecting","loadImage","dataSrc","dataset","imageOptimizer","LazyComponentLoader","componentCache","loadingPromises","preloadQueue","loadedComponents","initializePreloading","requestIdleCallback","processPreloadQueue","registerComponent","preload","loadComponent","loader","component","fromCache","loadingPromise","loadComponentInternal","module","default","batch","allSettled","async","componentName","preloadComponent","catch","isComponentLoaded","getLoadedComponents","clearCache","getCacheSize","componentLoaders","quickActionSidebar","then","QuickActionSidebar$1","m","floatingChatBar","FloatingChatBar$1","imageHighlighter","ImageHighlighter$1","AnimationSystem$1","themeManager","ThemeManager$1","ResponsiveManager$1","TouchGestureHandler$1","ImageOptimizer$1","PerformanceMonitor$1","componentConfigs","priority","lazyComponentLoader","defaultPerformanceConfig","bundleOptimization","maxGzipSize","enableTreeShaking","enableCodeSplitting","enableMinification","lazyLoading","enableComponentLazyLoading","enableImageLazyLoading","intersectionThreshold","preloadCriticalComponents","imageOptimization","enableWebP","defaultQuality","enableCompression","monitoring","enablePerformanceMonitoring","enableUserEngagementTracking","enableErrorTracking","sampleRate","caching","enableComponentCache","enableImageCache","cacheMaxAge","maxCacheSize","maxInitTime","productionPerformanceConfig","PerformanceConfigManager","customConfig","isProduction","process","env","NODE_ENV","getConfig","updates","getBundleConfig","getLazyLoadingConfig","getImageOptimizationConfig","getMonitoringConfig","getCachingConfig","getThresholds","shouldEnableFeature","feature","featureConfig","enableKey","validateThresholds","results","performanceConfigManager","DinoOverlay","init","DinoOverlayLoader","errorManager","defaultRetryConfig","maxRetries","baseDelay","maxDelay","backoffMultiplier","retryableStatuses","timeout","retryConfig","baseUrl","apiKey","editImage","request","validateEditImageRequest","makeRequest","endpoint","retries","logError","apiError","createAPIError","sendChatMessage","validateChatRequest","url","lastError","calculateBackoffDelay","sleep","log","executeRequest","headers","isSuccessStatus","isRetryableStatus","isRetryableError","customHeaders","controller","AbortController","timeoutId","abort","requestOptions","Authorization","signal","JSON","stringify","responseHeaders","responseData","contentType","json","requestId","aborted","ms","imageData","imageUrl","isValidBase64","str","base64Data","test","btoa","atob","operation","isInitialized","initializationPromise","validateAndMergeConfig","performInitialization","getShadowRoot","isReady","validateEnvironment","createShadowDOM","loadStyles","mountOverlay","loaderError","createLoaderError","URL","customActions","isArray","HTMLElement","prototype","attachShadow","styleElement","getBaseStyles","overlayRoot","String","components","positionUpdateTimer","createInitialState","previousState","detectionConfig","imageDetector","setupImageDetectorListeners","setupResponsiveManagerListeners","setupThemeManagerListeners","handleWindowResize","handleWindowScroll","handleDocumentClick","setupGlobalEventListeners","removeGlobalEventListeners","values","getState","selectImage","previousImage","setState","clearSelection","updateImagePosition","updatedRect","setSidebarVisible","setChatBarVisible","setProcessingState","updateComponents","unregisterComponent","getComponent","getImageDetector","getResponsiveManager","getThemeManager","setThemeMode","attachImageClickListener","detachImageClickListener","schedulePositionUpdate","result","handleClick","__dinoClickListener"],"mappings":"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"}