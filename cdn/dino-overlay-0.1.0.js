var DinoOverlay=function(t){"use strict";const e={apiEndpoint:"https://api.dinooverlay.com",theme:"auto",enableAnalytics:!1,debug:!1};class i{constructor(t){this.observer=null,this.detectedImages=new Set,this.eventListeners=new Map,this.resizeObserver=null,this.scrollDebounceTimer=null,this.resizeDebounceTimer=null,this.isActive=!1,this.config={className:"editable-room",observeChanges:!0,debounceMs:150,debug:!1,...t},this.handleScroll=this.handleScroll.bind(this),this.handleResize=this.handleResize.bind(this),this.handleMutation=this.handleMutation.bind(this)}startDetection(){if(this.isActive)this.config.debug;else try{this.isActive=!0,this.setupMutationObserver(),this.setupEventListeners(),this.performInitialScan(),this.config.debug}catch(t){throw this.isActive=!1,new Error(`Failed to start image detection: ${t}`)}}stopDetection(){this.isActive&&(this.isActive=!1,this.cleanup(),this.config.debug)}getDetectedImages(){return Array.from(this.detectedImages)}isImageDetected(t){return this.detectedImages.has(t)}calculateImageBounds(t){if(!t||!t.isConnected)throw new Error("Image element is not connected to DOM");return t.getBoundingClientRect()}getImageBorderRadius(t){return t&&t.isConnected&&window.getComputedStyle(t).borderRadius||"0px"}createSelectedImage(t){return{element:t,rect:this.calculateImageBounds(t),borderRadius:this.getImageBorderRadius(t)}}on(t,e){this.eventListeners.has(t)||this.eventListeners.set(t,[]),this.eventListeners.get(t).push(e)}off(t,e){const i=this.eventListeners.get(t);if(i){const t=i.indexOf(e);t>-1&&i.splice(t,1)}}setupMutationObserver(){this.config.observeChanges&&(this.observer=new MutationObserver(this.handleMutation),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","src"]}))}setupEventListeners(){window.addEventListener("scroll",this.handleScroll,{passive:!0}),window.addEventListener("resize",this.handleResize,{passive:!0}),"ResizeObserver"in window&&(this.resizeObserver=new ResizeObserver(t=>{for(const e of t){const t=e.target;this.detectedImages.has(t)&&this.emit("imageUpdated",t)}}))}performInitialScan(){const t=this.scanForImages();for(const e of t)this.addDetectedImage(e);this.config.debug}scanForImages(){const t=`img.${this.config.className}`,e=document.querySelectorAll(t);return Array.from(e).filter(t=>t instanceof HTMLImageElement&&this.isValidImage(t))}isValidImage(t){if(!t.isConnected||0===t.offsetWidth||0===t.offsetHeight)return!1;if(!t.complete||0===t.naturalWidth)return!1;const e=window.getComputedStyle(t);return"none"!==e.display&&"hidden"!==e.visibility}addDetectedImage(t){this.detectedImages.has(t)||(this.detectedImages.add(t),this.attachImageListeners(t),this.resizeObserver&&this.resizeObserver.observe(t),this.emit("imageDetected",t),this.config.debug)}removeDetectedImage(t){this.detectedImages.has(t)&&(this.detectedImages.delete(t),this.detachImageListeners(t),this.resizeObserver&&this.resizeObserver.unobserve(t),this.emit("imageRemoved",t),this.config.debug)}attachImageListeners(t){const e=()=>{this.isValidImage(t)&&this.emit("imageUpdated",t)},i=()=>{this.removeDetectedImage(t)};t.addEventListener("load",e),t.addEventListener("error",i),t.t={handleLoad:e,handleError:i}}detachImageListeners(t){const e=t.t;e&&(t.removeEventListener("load",e.handleLoad),t.removeEventListener("error",e.handleError),delete t.t)}handleMutation(t){let e=!1;for(const i of t)if("childList"===i.type){for(const t of Array.from(i.addedNodes))if(t.nodeType===Node.ELEMENT_NODE){const i=t;i instanceof HTMLImageElement&&i.classList.contains(this.config.className)&&this.isValidImage(i)&&(this.addDetectedImage(i),e=!0);const s=i.querySelectorAll(`img.${this.config.className}`);for(const t of Array.from(s))t instanceof HTMLImageElement&&this.isValidImage(t)&&(this.addDetectedImage(t),e=!0)}for(const t of Array.from(i.removedNodes))if(t.nodeType===Node.ELEMENT_NODE){const i=t;i instanceof HTMLImageElement&&this.detectedImages.has(i)&&(this.removeDetectedImage(i),e=!0);for(const t of Array.from(this.detectedImages))t.isConnected&&!i.contains(t)||(this.removeDetectedImage(t),e=!0)}}else if("attributes"===i.type){const t=i.target;if(t instanceof HTMLImageElement){const i=this.detectedImages.has(t),s=t.classList.contains(this.config.className);s&&!i&&this.isValidImage(t)?(this.addDetectedImage(t),e=!0):!s&&i?(this.removeDetectedImage(t),e=!0):s&&i&&this.emit("imageUpdated",t)}}e&&this.config.debug}handleScroll(){this.scrollDebounceTimer&&clearTimeout(this.scrollDebounceTimer),this.scrollDebounceTimer=window.setTimeout(()=>{for(const t of this.detectedImages)this.emit("imageUpdated",t);this.config.debug},this.config.debounceMs)}handleResize(){this.resizeDebounceTimer&&clearTimeout(this.resizeDebounceTimer),this.resizeDebounceTimer=window.setTimeout(()=>{for(const t of this.detectedImages)this.emit("imageUpdated",t);this.config.debug},this.config.debounceMs)}emit(t,...e){const i=this.eventListeners.get(t);if(i)for(const n of i)try{n(...e)}catch(s){}}cleanup(){this.scrollDebounceTimer&&(clearTimeout(this.scrollDebounceTimer),this.scrollDebounceTimer=null),this.resizeDebounceTimer&&(clearTimeout(this.resizeDebounceTimer),this.resizeDebounceTimer=null),this.observer&&(this.observer.disconnect(),this.observer=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize);for(const t of this.detectedImages)this.detachImageListeners(t);this.detectedImages.clear(),this.eventListeners.clear()}destroy(){this.stopDetection()}}class s{constructor(t){this.eventListeners=new Map,this.resizeObserver=null,this.mediaQueries=new Map,this.isDestroyed=!1,this.config=t,this.breakpoints={mobile:768,tablet:1024,desktop:1200},this.currentViewport=this.calculateViewportInfo(),this.previousViewport={...this.currentViewport},this.handleResize=this.handleResize.bind(this),this.handleOrientationChange=this.handleOrientationChange.bind(this),this.handleMediaQueryChange=this.handleMediaQueryChange.bind(this)}initialize(){if(this.isDestroyed)throw new Error("ResponsiveManager has been destroyed");this.setupEventListeners(),this.setupMediaQueries(),this.setupResizeObserver(),this.config.debug}destroy(){if(!this.isDestroyed){this.isDestroyed=!0,window.removeEventListener("resize",this.handleResize),window.removeEventListener("orientationchange",this.handleOrientationChange),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null);for(const[t,e]of this.mediaQueries)e.removeEventListener("change",this.handleMediaQueryChange);this.mediaQueries.clear(),this.eventListeners.clear(),this.config.debug}}getViewportInfo(){return{...this.currentViewport}}isMobile(){return this.currentViewport.isMobile}isTablet(){return this.currentViewport.isTablet}isDesktop(){return this.currentViewport.isDesktop}isTouchDevice(){return this.currentViewport.isTouchDevice}getBreakpoints(){return{...this.breakpoints}}setBreakpoints(t){this.breakpoints={...this.breakpoints,...t},this.updateViewportInfo()}on(t,e){this.eventListeners.has(t)||this.eventListeners.set(t,[]),this.eventListeners.get(t).push(e)}off(t,e){const i=this.eventListeners.get(t);if(i){const t=i.indexOf(e);t>-1&&i.splice(t,1)}}getOptimalSidebarWidth(){return this.currentViewport.isMobile?Math.min(.9*this.currentViewport.width,400):this.currentViewport.isTablet?Math.min(.6*this.currentViewport.width,480):320}getOptimalChatBarPosition(){const t=this.currentViewport.isMobile?12:20;return this.currentViewport.isMobile?{bottom:t,right:t,left:t}:{bottom:t,right:t}}shouldUseMobileLayout(){return this.currentViewport.isMobile||this.currentViewport.isTablet&&"portrait"===this.currentViewport.orientation}getTouchTargetSize(){return this.currentViewport.isTouchDevice?44:32}calculateViewportInfo(){const t=window.innerWidth,e=window.innerHeight;return{width:t,height:e,isMobile:t<this.breakpoints.mobile,isTablet:t>=this.breakpoints.mobile&&t<this.breakpoints.desktop,isDesktop:t>=this.breakpoints.desktop,orientation:t>e?"landscape":"portrait",devicePixelRatio:window.devicePixelRatio||1,isTouchDevice:this.detectTouchDevice()}}detectTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}updateViewportInfo(){this.previousViewport={...this.currentViewport},this.currentViewport=this.calculateViewportInfo(),this.hasBreakpointChanged()&&this.emit("breakpointChanged",this.currentViewport,this.previousViewport),this.previousViewport.orientation!==this.currentViewport.orientation&&this.emit("orientationChanged",this.currentViewport.orientation),this.emit("viewportResized",this.currentViewport),this.config.debug}hasBreakpointChanged(){return this.previousViewport.isMobile!==this.currentViewport.isMobile||this.previousViewport.isTablet!==this.currentViewport.isTablet||this.previousViewport.isDesktop!==this.currentViewport.isDesktop}setupEventListeners(){window.addEventListener("resize",this.handleResize,{passive:!0}),window.addEventListener("orientationchange",this.handleOrientationChange,{passive:!0})}setupMediaQueries(){const t={mobile:`(max-width: ${this.breakpoints.mobile-1}px)`,tablet:`(min-width: ${this.breakpoints.mobile}px) and (max-width: ${this.breakpoints.desktop-1}px)`,desktop:`(min-width: ${this.breakpoints.desktop}px)`,portrait:"(orientation: portrait)",landscape:"(orientation: landscape)",touch:"(pointer: coarse)",hover:"(hover: hover)"};for(const[e,i]of Object.entries(t)){const t=window.matchMedia(i);t.addEventListener("change",this.handleMediaQueryChange),this.mediaQueries.set(e,t)}}setupResizeObserver(){"undefined"!=typeof ResizeObserver&&(this.resizeObserver=new ResizeObserver(()=>{this.handleResize()}),this.resizeObserver.observe(document.body))}handleResize(){this.isDestroyed||(clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.updateViewportInfo()},16))}handleOrientationChange(){this.isDestroyed||setTimeout(()=>{this.updateViewportInfo()},100)}handleMediaQueryChange(){this.isDestroyed||this.updateViewportInfo()}emit(t,...e){const i=this.eventListeners.get(t);if(i)for(const n of i)try{n(...e)}catch(s){}}}const n=Object.freeze(Object.defineProperty({__proto__:null,ResponsiveManager:s},Symbol.toStringTag,{value:"Module"})),r={mode:"light",glassmorphism:{background:"rgba(255, 255, 255, 0.25)",backdropBlur:"blur(16px)",border:"rgba(255, 255, 255, 0.3)",shadow:"rgba(0, 0, 0, 0.1)",text:"rgba(0, 0, 0, 0.87)",textSecondary:"rgba(0, 0, 0, 0.6)",accent:"rgba(59, 130, 246, 0.8)",accentHover:"rgba(59, 130, 246, 0.9)",success:"rgba(34, 197, 94, 0.8)",warning:"rgba(251, 191, 36, 0.8)",error:"rgba(239, 68, 68, 0.8)"},colors:{primary:"#3b82f6",secondary:"#6b7280",accent:"#8b5cf6",text:"#111827",textSecondary:"#6b7280",background:"#ffffff",surface:"#f9fafb",border:"#e5e7eb"},animations:{duration:{fast:"150ms",normal:"300ms",slow:"500ms"},easing:{ease:"cubic-bezier(0.4, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",easeOut:"cubic-bezier(0, 0, 0.2, 1)",easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)"}}},o={mode:"dark",glassmorphism:{background:"rgba(17, 24, 39, 0.25)",backdropBlur:"blur(16px)",border:"rgba(75, 85, 99, 0.3)",shadow:"rgba(0, 0, 0, 0.3)",text:"rgba(255, 255, 255, 0.87)",textSecondary:"rgba(255, 255, 255, 0.6)",accent:"rgba(96, 165, 250, 0.8)",accentHover:"rgba(96, 165, 250, 0.9)",success:"rgba(52, 211, 153, 0.8)",warning:"rgba(251, 191, 36, 0.8)",error:"rgba(248, 113, 113, 0.8)"},colors:{primary:"#60a5fa",secondary:"#9ca3af",accent:"#a78bfa",text:"#f9fafb",textSecondary:"#d1d5db",background:"#111827",surface:"#1f2937",border:"#374151"},animations:{duration:{fast:"150ms",normal:"300ms",slow:"500ms"},easing:{ease:"cubic-bezier(0.4, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",easeOut:"cubic-bezier(0, 0, 0.2, 1)",easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)"}}},a=r;class h{constructor(t,e){this.eventListeners=new Map,this.mediaQueryList=null,this.hostObserver=null,this.isDestroyed=!1,this.cssVariablesStyleElement=null,this.shadowRoot=t,this.config=e,this.mode=e.theme,this.currentTheme=a,this.previousTheme=a,this.handleMediaQueryChange=this.handleMediaQueryChange.bind(this),this.handleHostStyleChange=this.handleHostStyleChange.bind(this)}initialize(){if(this.isDestroyed)throw new Error("ThemeManager has been destroyed");this.detectAndApplyTheme(),this.setupThemeDetection(),this.applyCSSCustomProperties(),this.config.debug}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.mediaQueryList&&(this.mediaQueryList.removeEventListener("change",this.handleMediaQueryChange),this.mediaQueryList=null),this.hostObserver&&(this.hostObserver.disconnect(),this.hostObserver=null),this.cssVariablesStyleElement&&this.cssVariablesStyleElement.parentNode&&(this.cssVariablesStyleElement.parentNode.removeChild(this.cssVariablesStyleElement),this.cssVariablesStyleElement=null),this.eventListeners.clear(),this.config.debug)}getCurrentTheme(){return{...this.currentTheme}}getMode(){return this.mode}setMode(t){if(this.isDestroyed)return;const e=this.mode;this.mode=t,this.detectAndApplyTheme(),this.emit("modeChanged",t,e),this.config.debug}detectHostTheme(){if(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)return{detectedTheme:"dark",confidence:.9,method:"prefers-color-scheme"};if(window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches)return{detectedTheme:"light",confidence:.9,method:"prefers-color-scheme"};const t=this.analyzeHostBackground();if(t)return t;return this.analyzeComputedStyles()||{detectedTheme:"light",confidence:.1,method:"fallback"}}applyTheme(t){this.isDestroyed||(this.previousTheme={...this.currentTheme},this.currentTheme={...t},this.applyCSSCustomProperties(),this.emit("themeChanged",this.currentTheme,this.previousTheme),this.config.debug)}getCSSCustomProperties(){const t=this.currentTheme;return{"--dino-glass-bg":t.glassmorphism.background,"--dino-glass-backdrop":t.glassmorphism.backdropBlur,"--dino-glass-border":t.glassmorphism.border,"--dino-glass-shadow":t.glassmorphism.shadow,"--dino-glass-text":t.glassmorphism.text,"--dino-glass-text-secondary":t.glassmorphism.textSecondary,"--dino-glass-accent":t.glassmorphism.accent,"--dino-glass-accent-hover":t.glassmorphism.accentHover,"--dino-glass-success":t.glassmorphism.success,"--dino-glass-warning":t.glassmorphism.warning,"--dino-glass-error":t.glassmorphism.error,"--dino-color-primary":t.colors.primary,"--dino-color-secondary":t.colors.secondary,"--dino-color-accent":t.colors.accent,"--dino-color-text":t.colors.text,"--dino-color-text-secondary":t.colors.textSecondary,"--dino-color-background":t.colors.background,"--dino-color-surface":t.colors.surface,"--dino-color-border":t.colors.border,"--dino-duration-fast":t.animations.duration.fast,"--dino-duration-normal":t.animations.duration.normal,"--dino-duration-slow":t.animations.duration.slow,"--dino-easing-ease":t.animations.easing.ease,"--dino-easing-ease-in":t.animations.easing.easeIn,"--dino-easing-ease-out":t.animations.easing.easeOut,"--dino-easing-ease-in-out":t.animations.easing.easeInOut}}on(t,e){this.eventListeners.has(t)||this.eventListeners.set(t,[]),this.eventListeners.get(t).push(e)}off(t,e){const i=this.eventListeners.get(t);if(i){const t=i.indexOf(e);t>-1&&i.splice(t,1)}}detectAndApplyTheme(){let t;if("auto"===this.mode){const e=this.detectHostTheme();t="dark"===e.detectedTheme?o:r,this.emit("detectionCompleted",e),this.config.debug}else t="dark"===this.mode?o:r;this.applyTheme(t)}setupThemeDetection(){"auto"===this.mode&&(window.matchMedia&&(this.mediaQueryList=window.matchMedia("(prefers-color-scheme: dark)"),this.mediaQueryList.addEventListener("change",this.handleMediaQueryChange)),this.setupHostStyleObserver())}setupHostStyleObserver(){document.body?(this.hostObserver=new MutationObserver(this.handleHostStyleChange),this.hostObserver.observe(document.documentElement,{attributes:!0,attributeFilter:["style","class","data-theme","data-color-scheme"]}),this.hostObserver.observe(document.body,{attributes:!0,attributeFilter:["style","class","data-theme","data-color-scheme"]})):setTimeout(()=>this.setupHostStyleObserver(),100)}handleMediaQueryChange(t){"auto"===this.mode&&this.detectAndApplyTheme()}handleHostStyleChange(){"auto"===this.mode&&setTimeout(()=>{this.detectAndApplyTheme()},100)}analyzeHostBackground(){try{const t=window.getComputedStyle(document.body),e=window.getComputedStyle(document.documentElement),i=t.backgroundColor||e.backgroundColor;if(i&&"rgba(0, 0, 0, 0)"!==i&&"transparent"!==i){const t=this.calculateColorBrightness(i);return{detectedTheme:t>128?"light":"dark",confidence:.7,method:"background-color",details:{backgroundColor:i,computedBrightness:t}}}}catch(t){this.config.debug}return null}analyzeComputedStyles(){try{const t=["body","main",".content","#content",".container"];for(const e of t){const t=document.querySelector(e);if(t){const e=window.getComputedStyle(t),i=e.color,s=e.backgroundColor;if(i&&"rgba(0, 0, 0, 0)"!==i){const t=this.calculateColorBrightness(i);return{detectedTheme:t>128?"dark":"light",confidence:.6,method:"computed-style",details:{textColor:i,backgroundColor:s,computedBrightness:t}}}}}}catch(t){this.config.debug}return null}calculateColorBrightness(t){const e=this.parseColor(t);return e?(299*e.r+587*e.g+114*e.b)/1e3:128}parseColor(t){const e=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(e)return{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)};const i=t.match(/^#([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);if(i)return{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)};const s=t.match(/^#([a-f\d])([a-f\d])([a-f\d])$/i);return s?{r:parseInt(s[1]+s[1],16),g:parseInt(s[2]+s[2],16),b:parseInt(s[3]+s[3],16)}:null}applyCSSCustomProperties(){const t=this.getCSSCustomProperties();this.cssVariablesStyleElement&&this.cssVariablesStyleElement.parentNode&&this.cssVariablesStyleElement.parentNode.removeChild(this.cssVariablesStyleElement),this.cssVariablesStyleElement=document.createElement("style"),this.cssVariablesStyleElement.textContent=`\n      :host {\n        ${Object.entries(t).map(([t,e])=>`${t}: ${e};`).join("\n        ")}\n      }\n    `,this.shadowRoot.appendChild(this.cssVariablesStyleElement)}emit(t,...e){const i=this.eventListeners.get(t);if(i)for(const n of i)try{n(...e)}catch(s){}}}const c=Object.freeze(Object.defineProperty({__proto__:null,ThemeManager:h},Symbol.toStringTag,{value:"Module"}));class l{constructor(){this.activeAnimations=new Map,this.animationCounter=0,this.defaultEasing="cubic-bezier(0.4, 0, 0.2, 1)"}slideIn(t,e="right",i={}){const s=this.generateAnimationId("slide-in"),n={duration:300,easing:this.defaultEasing,fill:"forwards",...i},r=this.getSlideTransforms(e),o=[{transform:r.from,opacity:"0"},{transform:r.to,opacity:"1"}];return this.createAnimation(t,o,n,s)}slideOut(t,e="right",i={}){const s=this.generateAnimationId("slide-out"),n={duration:300,easing:this.defaultEasing,fill:"forwards",...i},r=this.getSlideTransforms(e),o=[{transform:r.to,opacity:"1"},{transform:r.from,opacity:"0"}];return this.createAnimation(t,o,n,s)}fadeIn(t,e={}){const i=this.generateAnimationId("fade-in"),s={duration:200,easing:this.defaultEasing,fill:"forwards",...e};return this.createAnimation(t,[{opacity:"0"},{opacity:"1"}],s,i)}fadeOut(t,e={}){const i=this.generateAnimationId("fade-out"),s={duration:200,easing:this.defaultEasing,fill:"forwards",...e};return this.createAnimation(t,[{opacity:"1"},{opacity:"0"}],s,i)}scale(t,e=.8,i=1,s={}){const n=this.generateAnimationId("scale"),r={duration:200,easing:this.defaultEasing,fill:"forwards",...s},o=[{transform:`scale(${e})`,opacity:"0"},{transform:`scale(${i})`,opacity:"1"}];return this.createAnimation(t,o,r,n)}glow(t,e="rgba(59, 130, 246, 0.5)",i={}){const s=this.generateAnimationId("glow"),n={duration:2e3,easing:"ease-in-out",iterations:1/0,direction:"alternate",...i},r=[{boxShadow:`0 0 5px ${e}`,borderColor:e.replace("0.5","0.3")},{boxShadow:`0 0 20px ${e}, 0 0 30px ${e}`,borderColor:e.replace("0.5","0.8")}];return this.createAnimation(t,r,n,s)}pulse(t,e={}){const i=this.generateAnimationId("pulse"),s={duration:1e3,easing:"ease-in-out",iterations:1/0,direction:"alternate",...e};return this.createAnimation(t,[{transform:"scale(1)",opacity:"1"},{transform:"scale(1.05)",opacity:"0.8"}],s,i)}bounce(t,e={}){const i=this.generateAnimationId("bounce"),s={duration:600,easing:"cubic-bezier(0.68, -0.55, 0.265, 1.55)",fill:"forwards",...e};return this.createAnimation(t,[{transform:"scale(0.3)",opacity:"0"},{transform:"scale(1.05)",opacity:"0.8"},{transform:"scale(0.9)",opacity:"0.9"},{transform:"scale(1)",opacity:"1"}],s,i)}shake(t,e={}){const i=this.generateAnimationId("shake"),s={duration:500,easing:"ease-in-out",fill:"forwards",...e};return this.createAnimation(t,[{transform:"translateX(0)"},{transform:"translateX(-10px)"},{transform:"translateX(10px)"},{transform:"translateX(-10px)"},{transform:"translateX(10px)"},{transform:"translateX(-5px)"},{transform:"translateX(5px)"},{transform:"translateX(0)"}],s,i)}spin(t,e={}){const i=this.generateAnimationId("spin"),s={duration:1e3,easing:"linear",iterations:1/0,...e};return this.createAnimation(t,[{transform:"rotate(0deg)"},{transform:"rotate(360deg)"}],s,i)}applyTransition(t,e){const i=e.map(t=>{const e=t.delay?` ${t.delay}ms`:"";return`${t.property} ${t.duration}ms ${t.easing}${e}`});t.style.transition=i.join(", ")}setupHoverAnimation(t,e,i={}){const{duration:s=200,easing:n=this.defaultEasing,scaleOnHover:r=!1,glowOnHover:o=!1,glowColor:a="rgba(59, 130, 246, 0.3)"}=i,h={};Object.keys(e).forEach(e=>{const i=e;h[i]=t.style[i]});const c=Object.keys(e);r&&c.push("transform"),o&&c.push("box-shadow","border-color");const l=c.map(t=>({property:t,duration:s,easing:n}));this.applyTransition(t,l);const d=()=>{Object.assign(t.style,e),r&&(t.style.transform=(t.style.transform||"")+" scale(1.05)"),o&&(t.style.boxShadow=`0 0 15px ${a}`,t.style.borderColor=a)},u=()=>{Object.assign(t.style,h),r&&(t.style.transform=(t.style.transform||"").replace(" scale(1.05)","")),o&&(t.style.boxShadow=h.boxShadow||"",t.style.borderColor=h.borderColor||"")};return t.addEventListener("mouseenter",d),t.addEventListener("mouseleave",u),()=>{t.removeEventListener("mouseenter",d),t.removeEventListener("mouseleave",u)}}setupFocusAnimation(t,e,i={}){const{duration:s=200,easing:n=this.defaultEasing,glowOnFocus:r=!0,glowColor:o="rgba(59, 130, 246, 0.5)"}=i,a={};Object.keys(e).forEach(e=>{const i=e;a[i]=t.style[i]});const h=Object.keys(e);r&&h.push("box-shadow","border-color");const c=h.map(t=>({property:t,duration:s,easing:n}));this.applyTransition(t,c);const l=()=>{Object.assign(t.style,e),r&&(t.style.boxShadow=`0 0 0 3px ${o}`,t.style.borderColor=o.replace("0.5","0.8"))},d=()=>{Object.assign(t.style,a),r&&(t.style.boxShadow=a.boxShadow||"",t.style.borderColor=a.borderColor||"")};return t.addEventListener("focus",l),t.addEventListener("blur",d),()=>{t.removeEventListener("focus",l),t.removeEventListener("blur",d)}}cancelAnimation(t){const e=this.activeAnimations.get(t);e&&(e.cancel(),this.activeAnimations.delete(t))}cancelAllAnimations(){this.activeAnimations.forEach(t=>{t.cancel()}),this.activeAnimations.clear()}getActiveAnimationCount(){return this.activeAnimations.size}isAnimationActive(t){return this.activeAnimations.has(t)}createCustomAnimation(t,e,i={}){const s=this.generateAnimationId("custom"),n={duration:300,easing:this.defaultEasing,fill:"forwards",...i};return this.createAnimation(t,e,n,s)}destroy(){this.cancelAllAnimations(),this.animationCounter=0}createAnimation(t,e,i,s){try{const n=t.animate(e,{duration:i.duration,easing:i.easing,delay:i.delay||0,fill:i.fill||"forwards",iterations:i.iterations||1,direction:i.direction||"normal"});return this.activeAnimations.set(s,n),n.addEventListener("finish",()=>{this.activeAnimations.delete(s)}),n.addEventListener("cancel",()=>{this.activeAnimations.delete(s)}),{cancel:()=>{n.cancel(),this.activeAnimations.delete(s)},finish:()=>{n.finish()},pause:()=>{n.pause()},play:()=>{n.play()}}}catch(n){return this.createCSSFallbackAnimation(t,e,i)}}createCSSFallbackAnimation(t,e,i){const s=e[e.length-1];return Object.assign(t.style,s),{cancel:()=>{},finish:()=>{},pause:()=>{},play:()=>{}}}getSlideTransforms(t){return{left:{from:"translateX(-100%)",to:"translateX(0)"},right:{from:"translateX(100%)",to:"translateX(0)"},up:{from:"translateY(-100%)",to:"translateY(0)"},down:{from:"translateY(100%)",to:"translateY(0)"}}[t]}generateAnimationId(t){return`${t}-${++this.animationCounter}-${Date.now()}`}}const d=new l,u=Object.freeze(Object.defineProperty({__proto__:null,AnimationSystem:l,animationSystem:d},Symbol.toStringTag,{value:"Module"}));class p{constructor(t){this.activeCleanups=new Map,this.prefersReducedMotion=!1,this.animationSystem=t,this.detectReducedMotionPreference()}animateSidebarIn(t,e=!1,i={}){const s="sidebar-in";if(this.cleanupPrevious(s),this.shouldSkipAnimation(i))return this.createNoOpCleanup();const n=i.duration||(e?400:300);t.style.display="block",t.style.pointerEvents="auto";const r=t.querySelector(".dino-sidebar-backdrop");r&&this.animationSystem.fadeIn(r,{duration:.8*n});const o=t.querySelector(".dino-sidebar-panel");if(o){const t=this.animationSystem.createCustomAnimation(o,[{transform:e?"translateY(100%) scale(0.95)":"translateX(100%) scale(0.95)",opacity:"0"},{transform:e?"translateY(0) scale(1)":"translateX(0) scale(1)",opacity:"1"}],{duration:n,easing:i.easing||"cubic-bezier(0.34, 1.56, 0.64, 1)",delay:i.stagger||0});return this.activeCleanups.set(s,t),t}return this.createNoOpCleanup()}animateSidebarOut(t,e=!1,i={}){const s="sidebar-out";if(this.cleanupPrevious(s),this.shouldSkipAnimation(i))return t.style.display="none",this.createNoOpCleanup();const n=i.duration||(e?350:250),r=t.querySelector(".dino-sidebar-backdrop");r&&this.animationSystem.fadeOut(r,{duration:.6*n});const o=t.querySelector(".dino-sidebar-panel");if(o){const r=this.animationSystem.createCustomAnimation(o,[{transform:e?"translateY(0) scale(1)":"translateX(0) scale(1)",opacity:"1"},{transform:e?"translateY(100%) scale(0.95)":"translateX(100%) scale(0.95)",opacity:"0"}],{duration:n,easing:i.easing||"cubic-bezier(0.4, 0, 1, 1)",delay:i.stagger||0});return r.cancel=()=>{t.style.display="none",t.style.pointerEvents="none"},this.activeCleanups.set(s,r),r}return this.createNoOpCleanup()}animateChatBarIn(t,e={}){const i="chatbar-in";if(this.cleanupPrevious(i),this.shouldSkipAnimation(e))return this.createNoOpCleanup();const s=e.duration||300;t.style.display="block",t.style.pointerEvents="auto";const n=this.animationSystem.createCustomAnimation(t,[{transform:"translateY(100%) scale(0.9)",opacity:"0"},{transform:"translateY(0) scale(1)",opacity:"1"}],{duration:s,easing:e.easing||"cubic-bezier(0.34, 1.56, 0.64, 1)",delay:e.stagger||0});return this.activeCleanups.set(i,n),n}animateChatBarOut(t,e={}){const i="chatbar-out";if(this.cleanupPrevious(i),this.shouldSkipAnimation(e))return t.style.display="none",this.createNoOpCleanup();const s=e.duration||250,n=this.animationSystem.createCustomAnimation(t,[{transform:"translateY(0) scale(1)",opacity:"1"},{transform:"translateY(100%) scale(0.9)",opacity:"0"}],{duration:s,easing:e.easing||"cubic-bezier(0.4, 0, 1, 1)",delay:e.stagger||0});return n.cancel=()=>{t.style.display="none",t.style.pointerEvents="none"},this.activeCleanups.set(i,n),n}animateHighlighterIn(t,e,i={}){const s="highlighter-in";if(this.cleanupPrevious(s),this.shouldSkipAnimation(i))return this.createNoOpCleanup();const n=i.duration||400;this.positionHighlighter(t,e);const r=this.animationSystem.createCustomAnimation(t,[{opacity:"0",transform:"scale(0.8)",borderWidth:"0px"},{opacity:"1",transform:"scale(1)",borderWidth:"2px"}],{duration:n,easing:i.easing||"cubic-bezier(0.34, 1.56, 0.64, 1)",delay:i.stagger||0});return this.startHighlighterGlow(t),this.activeCleanups.set(s,r),r}animateHighlighterOut(t,e={}){const i="highlighter-out";if(this.cleanupPrevious(i),this.shouldSkipAnimation(e))return t.style.display="none",this.createNoOpCleanup();const s=e.duration||200,n=this.animationSystem.createCustomAnimation(t,[{opacity:"1",transform:"scale(1)"},{opacity:"0",transform:"scale(0.8)"}],{duration:s,easing:e.easing||"cubic-bezier(0.4, 0, 1, 1)",delay:e.stagger||0});return this.stopHighlighterGlow(t),n.cancel=()=>{t.style.display="none"},this.activeCleanups.set(i,n),n}setupButtonHoverAnimation(t,e={}){return this.shouldSkipAnimation(e)?()=>{}:this.animationSystem.setupHoverAnimation(t,{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08))",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.2)"},{duration:e.duration||200,easing:e.easing||"cubic-bezier(0.4, 0, 0.2, 1)",scaleOnHover:!0,glowOnHover:!0,glowColor:"rgba(59, 130, 246, 0.3)"})}setupButtonFocusAnimation(t,e={}){return this.shouldSkipAnimation(e)?()=>{}:this.animationSystem.setupFocusAnimation(t,{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08))"},{duration:e.duration||200,easing:e.easing||"cubic-bezier(0.4, 0, 0.2, 1)",glowOnFocus:!0,glowColor:"rgba(59, 130, 246, 0.5)"})}animateLoadingState(t,e,i={}){const s=`loading-${t.className}`;if(this.cleanupPrevious(s),this.shouldSkipAnimation(i))return this.createNoOpCleanup();if(e){if(!t.querySelector(".dino-loading-spinner")){const e=this.createLoadingSpinner(),i=t.querySelector(".dino-action-icon, .dino-chat-icon");i&&(i.innerHTML="",i.appendChild(e))}const e=this.animationSystem.pulse(t,{duration:i.duration||1e3,iterations:1/0});return this.activeCleanups.set(s,e),e}{const e=t.querySelector(".dino-loading-spinner");return e&&e.remove(),this.createNoOpCleanup()}}animateErrorState(t,e={}){const i=`error-${t.className}`;if(this.cleanupPrevious(i),this.shouldSkipAnimation(e))return this.createNoOpCleanup();const s=t.style.background,n=t.style.border;t.style.background="linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1))",t.style.border="1px solid rgba(239, 68, 68, 0.3)";const r=this.animationSystem.shake(t,{duration:e.duration||500,easing:e.easing||"ease-in-out"});return setTimeout(()=>{t.style.background=s,t.style.border=n},e.duration||500),this.activeCleanups.set(i,r),r}animateStaggeredList(t,e={}){if(this.shouldSkipAnimation(e))return[];const i=Array.from(t.children),s=e.stagger||50,n=[];return i.forEach((t,i)=>{const r=this.animationSystem.createCustomAnimation(t,[{opacity:"0",transform:"translateX(20px)"},{opacity:"1",transform:"translateX(0)"}],{duration:e.duration||300,easing:e.easing||"cubic-bezier(0.4, 0, 0.2, 1)",delay:i*s});n.push(r)}),n}cleanup(){this.activeCleanups.forEach(t=>{t.cancel()}),this.activeCleanups.clear()}cleanupAnimation(t){const e=this.activeCleanups.get(t);e&&(e.cancel(),this.activeCleanups.delete(t))}cleanupPrevious(t){const e=this.activeCleanups.get(t);e&&(e.cancel(),this.activeCleanups.delete(t))}shouldSkipAnimation(t){return!1!==t.respectsReducedMotion&&this.prefersReducedMotion}createNoOpCleanup(){return{cancel:()=>{},finish:()=>{},pause:()=>{},play:()=>{}}}detectReducedMotionPreference(){if("undefined"!=typeof window&&window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion: reduce)");this.prefersReducedMotion=t.matches,t.addEventListener("change",t=>{this.prefersReducedMotion=t.matches})}}positionHighlighter(t,e){const{rect:i,borderRadius:s}=e;Object.assign(t.style,{position:"absolute",left:`${i.left}px`,top:`${i.top}px`,width:`${i.width}px`,height:`${i.height}px`,borderRadius:s,pointerEvents:"none",zIndex:"999997"})}startHighlighterGlow(t){const e=this.animationSystem.glow(t,"rgba(59, 130, 246, 0.6)",{duration:2e3,iterations:1/0});this.activeCleanups.set("highlighter-glow",e)}stopHighlighterGlow(t){this.cleanupAnimation("highlighter-glow")}createLoadingSpinner(){const t=document.createElement("div");t.className="dino-loading-spinner",Object.assign(t.style,{width:"20px",height:"20px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTop:"2px solid rgba(255, 255, 255, 0.8)",borderRadius:"50%",display:"inline-block"});const e=this.animationSystem.spin(t);return t.addEventListener("remove",()=>{e.cancel()}),t}}const g=new p(new l);class m{constructor(t,e){this.element=null,this.glowAnimation=null,this.isDestroyed=!1,this.resizeObserver=null,this.animationCleanups=new Map,this.hoverCleanups=new Map,this.props=t,this.overlayAnimations=e||new p(new(require("./AnimationSystem").AnimationSystem)),this.handleCloseClick=this.handleCloseClick.bind(this),this.handleImageClick=this.handleImageClick.bind(this)}render(){if(this.isDestroyed)throw new Error("ImageHighlighter has been destroyed");return this.element||(this.element=this.createElement()),this.updateElement(),this.element}update(t){if(this.isDestroyed)return;const e={...this.props,selectedImage:t.selectedImage};this.props=e,this.element&&this.updateElement()}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.stopGlowAnimation(),this.animationCleanups.forEach(t=>t.cancel()),this.animationCleanups.clear(),this.hoverCleanups.forEach(t=>t()),this.hoverCleanups.clear(),this.overlayAnimations.cleanup(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null)}createElement(){const t=document.createElement("div");t.className="dino-image-highlighter",this.applyBaseStyles(t);const e=this.createCloseButton();return t.appendChild(e),this.setupResizeObserver(),t}updateElement(){if(!this.element||this.isDestroyed)return;const{selectedImage:t}=this.props;if(!t){const t=this.overlayAnimations.animateHighlighterOut(this.element,{duration:200,respectsReducedMotion:!0});return this.animationCleanups.set("hide",t),void this.stopGlowAnimation()}this.positionHighlighter(t),this.updateBorderRadius(t);const e=this.overlayAnimations.animateHighlighterIn(this.element,t,{duration:400,respectsReducedMotion:!0});this.animationCleanups.set("show",e)}applyBaseStyles(t){Object.assign(t.style,{position:"fixed",pointerEvents:"none",zIndex:"999999",display:"none",border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:"8px",background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05))",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",boxShadow:"\n        0 8px 32px rgba(0, 0, 0, 0.1),\n        0 0 0 1px rgba(255, 255, 255, 0.1),\n        inset 0 1px 0 rgba(255, 255, 255, 0.2)\n      ",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",willChange:"transform, opacity",transform:"translateZ(0)"})}createCloseButton(){const t=document.createElement("button");t.className="dino-highlighter-close",t.innerHTML="×",t.setAttribute("aria-label","Close image highlighter"),Object.assign(t.style,{position:"absolute",top:"-12px",right:"-12px",width:"24px",height:"24px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1))",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",color:"rgba(255, 255, 255, 0.9)",fontSize:"16px",fontWeight:"bold",lineHeight:"1",cursor:"pointer",pointerEvents:"auto",boxShadow:"\n        0 4px 16px rgba(0, 0, 0, 0.1),\n        0 0 0 1px rgba(255, 255, 255, 0.2),\n        inset 0 1px 0 rgba(255, 255, 255, 0.3)\n      ",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",transform:"scale(1)",willChange:"transform, box-shadow"}),t.addEventListener("mouseenter",()=>{this.isDestroyed||Object.assign(t.style,{transform:"scale(1.1)",boxShadow:"\n            0 6px 20px rgba(0, 0, 0, 0.15),\n            0 0 0 1px rgba(255, 255, 255, 0.3),\n            inset 0 1px 0 rgba(255, 255, 255, 0.4),\n            0 0 20px rgba(255, 255, 255, 0.2)\n          "})}),t.addEventListener("mouseleave",()=>{this.isDestroyed||Object.assign(t.style,{transform:"scale(1)",boxShadow:"\n            0 4px 16px rgba(0, 0, 0, 0.1),\n            0 0 0 1px rgba(255, 255, 255, 0.2),\n            inset 0 1px 0 rgba(255, 255, 255, 0.3)\n          "})}),t.addEventListener("mousedown",()=>{this.isDestroyed||(t.style.transform="scale(0.95)")}),t.addEventListener("mouseup",()=>{this.isDestroyed||(t.style.transform="scale(1.1)")}),t.addEventListener("click",this.handleCloseClick);const e=this.overlayAnimations.setupButtonHoverAnimation(t,{duration:200,respectsReducedMotion:!0}),i=this.overlayAnimations.setupButtonFocusAnimation(t,{duration:200,respectsReducedMotion:!0});return this.hoverCleanups.set("close-hover",e),this.hoverCleanups.set("close-focus",i),t}positionHighlighter(t){if(!this.element||this.isDestroyed)return;const{rect:e}=t;Object.assign(this.element.style,{left:`${e.left}px`,top:`${e.top}px`,width:`${e.width}px`,height:`${e.height}px`})}updateBorderRadius(t){this.element&&!this.isDestroyed&&(this.element.style.borderRadius=t.borderRadius||"8px")}startGlowAnimation(){if(!this.element||this.isDestroyed||this.glowAnimation)return;const t=[{boxShadow:"\n          0 8px 32px rgba(0, 0, 0, 0.1),\n          0 0 0 1px rgba(255, 255, 255, 0.1),\n          inset 0 1px 0 rgba(255, 255, 255, 0.2),\n          0 0 20px rgba(59, 130, 246, 0.3)\n        ",borderColor:"rgba(59, 130, 246, 0.4)"},{boxShadow:"\n          0 8px 32px rgba(0, 0, 0, 0.1),\n          0 0 0 1px rgba(255, 255, 255, 0.1),\n          inset 0 1px 0 rgba(255, 255, 255, 0.2),\n          0 0 40px rgba(59, 130, 246, 0.5)\n        ",borderColor:"rgba(59, 130, 246, 0.6)"},{boxShadow:"\n          0 8px 32px rgba(0, 0, 0, 0.1),\n          0 0 0 1px rgba(255, 255, 255, 0.1),\n          inset 0 1px 0 rgba(255, 255, 255, 0.2),\n          0 0 20px rgba(59, 130, 246, 0.3)\n        ",borderColor:"rgba(59, 130, 246, 0.4)"}],e={duration:2e3,iterations:1/0,easing:"cubic-bezier(0.4, 0, 0.6, 1)"};try{this.glowAnimation=this.element.animate(t,e)}catch(i){}}stopGlowAnimation(){this.glowAnimation&&(this.glowAnimation.cancel(),this.glowAnimation=null)}setupResizeObserver(){if(this.props.selectedImage?.element&&!this.resizeObserver)try{this.resizeObserver=new ResizeObserver(t=>{if(!this.isDestroyed&&this.props.selectedImage)for(const e of t)if(e.target===this.props.selectedImage.element){const t=e.target.getBoundingClientRect(),i={...this.props.selectedImage,rect:t};this.props={...this.props,selectedImage:i},this.positionHighlighter(i);break}}),this.resizeObserver.observe(this.props.selectedImage.element)}catch(t){}}handleCloseClick(t){t.preventDefault(),t.stopPropagation(),this.isDestroyed||this.props.onClose()}handleImageClick(t){t.preventDefault(),t.stopPropagation(),!this.isDestroyed&&this.props.selectedImage&&this.props.onImageClick&&this.props.onImageClick(this.props.selectedImage.element)}static calculateBorderRadius(t){if(!t)return"8px";try{const e=window.getComputedStyle(t),i=e.borderRadius;if(i&&"0px"!==i)return i;const s=e.borderTopLeftRadius,n=e.borderTopRightRadius,r=e.borderBottomRightRadius,o=e.borderBottomLeftRadius;return s===n&&n===r&&r===o?s||"8px":`${s||"0px"} ${n||"0px"} ${r||"0px"} ${o||"0px"}`}catch(e){return"8px"}}static createGlowKeyframes(t="rgba(59, 130, 246, 0.5)"){return[{boxShadow:`\n          0 8px 32px rgba(0, 0, 0, 0.1),\n          0 0 0 1px rgba(255, 255, 255, 0.1),\n          inset 0 1px 0 rgba(255, 255, 255, 0.2),\n          0 0 20px ${t}\n        `},{boxShadow:`\n          0 8px 32px rgba(0, 0, 0, 0.1),\n          0 0 0 1px rgba(255, 255, 255, 0.1),\n          inset 0 1px 0 rgba(255, 255, 255, 0.2),\n          0 0 40px ${t}\n        `},{boxShadow:`\n          0 8px 32px rgba(0, 0, 0, 0.1),\n          0 0 0 1px rgba(255, 255, 255, 0.1),\n          inset 0 1px 0 rgba(255, 255, 255, 0.2),\n          0 0 20px ${t}\n        `}]}}const b=Object.freeze(Object.defineProperty({__proto__:null,ImageHighlighter:m},Symbol.toStringTag,{value:"Module"}));class f{constructor(t,e={}){this.eventListeners=new Map,this.isDestroyed=!1,this.touchStart=null,this.touchCurrent=null,this.lastTap=null,this.tapCount=0,this.tapTimeout=null,this.doubleTapTimeout=null,this.element=t,this.config={swipeThreshold:50,swipeVelocityThreshold:.3,tapTimeout:300,doubleTapTimeout:300,maxTapDistance:10,debug:!1,...e},this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),this.handleTouchEnd=this.handleTouchEnd.bind(this),this.handleTouchCancel=this.handleTouchCancel.bind(this)}initialize(){if(this.isDestroyed)throw new Error("TouchGestureHandler has been destroyed");this.setupEventListeners(),this.config.debug}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.tapTimeout&&(clearTimeout(this.tapTimeout),this.tapTimeout=null),this.doubleTapTimeout&&(clearTimeout(this.doubleTapTimeout),this.doubleTapTimeout=null),this.removeEventListeners(),this.eventListeners.clear(),this.touchStart=null,this.touchCurrent=null,this.lastTap=null,this.tapCount=0,this.config.debug)}on(t,e){this.eventListeners.has(t)||this.eventListeners.set(t,[]),this.eventListeners.get(t).push(e)}off(t,e){const i=this.eventListeners.get(t);if(i){const t=i.indexOf(e);t>-1&&i.splice(t,1)}}updateConfig(t){this.config={...this.config,...t}}setupEventListeners(){const t={passive:!1};this.element.addEventListener("touchstart",this.handleTouchStart,t),this.element.addEventListener("touchmove",this.handleTouchMove,t),this.element.addEventListener("touchend",this.handleTouchEnd,t),this.element.addEventListener("touchcancel",this.handleTouchCancel,t)}removeEventListeners(){this.element.removeEventListener("touchstart",this.handleTouchStart),this.element.removeEventListener("touchmove",this.handleTouchMove),this.element.removeEventListener("touchend",this.handleTouchEnd),this.element.removeEventListener("touchcancel",this.handleTouchCancel)}handleTouchStart(t){if(this.isDestroyed||1!==t.touches.length)return;const e=t.touches[0];this.touchStart=this.createTouchPoint(e),this.touchCurrent={...this.touchStart},this.emit("touchStart",this.touchStart,t),this.config.debug}handleTouchMove(t){if(this.isDestroyed||!this.touchStart||1!==t.touches.length)return;const e=t.touches[0];this.touchCurrent=this.createTouchPoint(e),this.emit("touchMove",this.touchCurrent,t),this.calculateDistance(this.touchStart,this.touchCurrent)>this.config.maxTapDistance&&t.preventDefault()}handleTouchEnd(t){if(this.isDestroyed||!this.touchStart||!this.touchCurrent)return;const e=this.touchCurrent;this.emit("touchEnd",e,t);const i=this.calculateDistance(this.touchStart,e),s=e.timestamp-this.touchStart.timestamp,n=i/s;this.config.debug,i>=this.config.swipeThreshold&&n>=this.config.swipeVelocityThreshold?this.handleSwipeGesture(this.touchStart,e,i,n,s,t):i<=this.config.maxTapDistance&&this.handleTapGesture(e,t),this.touchStart=null,this.touchCurrent=null}handleTouchCancel(t){this.isDestroyed||(this.touchStart=null,this.touchCurrent=null,this.config.debug)}handleSwipeGesture(t,e,i,s,n,r){const o=e.x-t.x,a=e.y-t.y;let h;h=Math.abs(o)>Math.abs(a)?o>0?"right":"left":a>0?"down":"up";const c={direction:h,distance:i,velocity:s,duration:n,startPoint:t,endPoint:e};this.emit("swipe",c,r),this.config.debug}handleTapGesture(t,e){if(this.tapTimeout&&(clearTimeout(this.tapTimeout),this.tapTimeout=null),this.lastTap&&this.isDoubleTap(this.lastTap,t)){this.tapCount=2,this.doubleTapTimeout&&(clearTimeout(this.doubleTapTimeout),this.doubleTapTimeout=null);const i={point:t,tapCount:this.tapCount};this.emit("doubleTap",i,e),this.config.debug,this.lastTap=null,this.tapCount=0}else this.tapCount=1,this.lastTap=t,this.doubleTapTimeout=window.setTimeout(()=>{const i={point:t,tapCount:1};this.emit("tap",i,e),this.config.debug,this.lastTap=null,this.tapCount=0,this.doubleTapTimeout=null},this.config.doubleTapTimeout)}isDoubleTap(t,e){const i=this.calculateDistance(t,e),s=e.timestamp-t.timestamp;return i<=this.config.maxTapDistance&&s<=this.config.doubleTapTimeout}createTouchPoint(t){return{x:t.clientX,y:t.clientY,timestamp:Date.now()}}calculateDistance(t,e){const i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)}emit(t,...e){const i=this.eventListeners.get(t);if(i)for(const n of i)try{n(...e)}catch(s){}}}const w=Object.freeze(Object.defineProperty({__proto__:null,TouchGestureHandler:f},Symbol.toStringTag,{value:"Module"}));class y{constructor(t,e,i){this.element=null,this.isDestroyed=!1,this.slideAnimation=null,this.responsiveManager=null,this.touchGestureHandler=null,this.currentViewport=null,this.animationCleanups=new Map,this.hoverCleanups=new Map,this.currentTheme=null,this.props=t,this.actions=this.getDefaultActions(),this.responsiveManager=e||null,this.overlayAnimations=i||new p(new(require("./AnimationSystem").AnimationSystem)),this.responsiveManager&&(this.currentViewport=this.responsiveManager.getViewportInfo()),this.handleActionClick=this.handleActionClick.bind(this),this.handleCloseClick=this.handleCloseClick.bind(this),this.handleBackdropClick=this.handleBackdropClick.bind(this),this.handleSwipeGesture=this.handleSwipeGesture.bind(this),this.handleViewportChange=this.handleViewportChange.bind(this)}render(){if(this.isDestroyed)throw new Error("QuickActionSidebar has been destroyed");return this.element||(this.element=this.createElement(),this.setupResponsiveHandling(),this.setupTouchGestures()),this.updateElement(),this.element}update(t){if(this.isDestroyed)return;const e={...this.props,visible:t.sidebarVisible,selectedImage:t.selectedImage,isProcessing:t.isProcessing,currentAction:t.currentAction},i=this.props.visible,s=e.visible;this.props=e,this.element&&(!i&&s?this.slideIn():i&&!s?this.slideOut():s&&this.updateElement())}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.slideAnimation&&(this.slideAnimation.cancel(),this.slideAnimation=null),this.animationCleanups.forEach(t=>t.cancel()),this.animationCleanups.clear(),this.hoverCleanups.forEach(t=>t()),this.hoverCleanups.clear(),this.overlayAnimations.cleanup(),this.touchGestureHandler&&(this.touchGestureHandler.destroy(),this.touchGestureHandler=null),this.responsiveManager&&(this.responsiveManager.off("viewportResized",this.handleViewportChange),this.responsiveManager.off("breakpointChanged",this.handleViewportChange)),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.currentViewport=null)}updateTheme(t){this.isDestroyed||(this.currentTheme=t,this.element&&this.applyThemeStyles())}setCustomActions(t){this.actions=[...this.getDefaultActions(),...t],this.element&&this.props.visible&&this.updateActionButtons()}createElement(){const t=document.createElement("div");t.className="dino-quick-action-sidebar",this.applyBaseStyles(t);const e=this.createBackdrop();t.appendChild(e);const i=this.createSidebarPanel();return t.appendChild(i),t}createBackdrop(){const t=document.createElement("div");return t.className="dino-sidebar-backdrop",Object.assign(t.style,{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:"rgba(0, 0, 0, 0.2)",backdropFilter:"blur(2px)",WebkitBackdropFilter:"blur(2px)",zIndex:"999998",opacity:"0",transition:"opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1)",cursor:"pointer"}),t.addEventListener("click",this.handleBackdropClick),t}createSidebarPanel(){const t=document.createElement("div");t.className="dino-sidebar-panel",this.applySidebarPanelStyles(t);const e=this.createSidebarHeader();t.appendChild(e);const i=this.createActionsContainer();return t.appendChild(i),t}createSidebarHeader(){const t=document.createElement("div");t.className="dino-sidebar-header",Object.assign(t.style,{padding:"20px 24px 16px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",marginBottom:"16px"});const e=document.createElement("h3");e.textContent="Quick Actions",e.className="dino-sidebar-title",Object.assign(e.style,{margin:"0",fontSize:"18px",fontWeight:"600",color:"var(--dino-glass-text)",lineHeight:"1.2"});const i=document.createElement("p");i.textContent="Transform your room with AI",i.className="dino-sidebar-subtitle",Object.assign(i.style,{margin:"4px 0 0",fontSize:"14px",color:"var(--dino-glass-text-secondary)",lineHeight:"1.3"});const s=this.createCloseButton();return t.appendChild(e),t.appendChild(i),t.appendChild(s),t}createCloseButton(){const t=document.createElement("button");return t.className="dino-sidebar-close",t.innerHTML="×",t.setAttribute("aria-label","Close sidebar"),Object.assign(t.style,{position:"absolute",top:"16px",right:"16px",width:"32px",height:"32px",borderRadius:"50%",border:"none",background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05))",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",color:"var(--dino-glass-text)",fontSize:"20px",fontWeight:"normal",lineHeight:"1",cursor:"pointer",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",transform:"scale(1)"}),t.addEventListener("mouseenter",()=>{this.isDestroyed||Object.assign(t.style,{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08))",transform:"scale(1.05)",color:"rgba(255, 255, 255, 1)"})}),t.addEventListener("mouseleave",()=>{this.isDestroyed||Object.assign(t.style,{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05))",transform:"scale(1)",color:"rgba(255, 255, 255, 0.8)"})}),t.addEventListener("click",this.handleCloseClick),t}createActionsContainer(){const t=document.createElement("div");return t.className="dino-actions-container",Object.assign(t.style,{padding:"0 24px 24px",display:"flex",flexDirection:"column",gap:"12px",maxHeight:"calc(100vh - 200px)",overflowY:"auto"}),t.style.scrollbarWidth="thin",t.style.scrollbarColor="rgba(255, 255, 255, 0.3) transparent",this.updateActionButtons(t),t}updateActionButtons(t){if(!t){const e=this.element?.querySelector(".dino-actions-container");if(!e)return;t=e}t.innerHTML="",this.actions.forEach(e=>{const i=this.createActionButton(e);t.appendChild(i)}),this.props.visible&&this.overlayAnimations.animateStaggeredList(t,{duration:300,stagger:50,respectsReducedMotion:!0}).forEach((t,e)=>{this.animationCleanups.set(`stagger-${e}`,t)})}createActionButton(t){const e=document.createElement("button");e.className="dino-action-button",e.setAttribute("data-action-id",t.id),this.applyActionButtonStyles(e);const i=this.createButtonContent(t);e.appendChild(i),e.addEventListener("click",()=>this.handleActionClick(t));const s=this.overlayAnimations.setupButtonHoverAnimation(e,{duration:200,respectsReducedMotion:!0}),n=this.overlayAnimations.setupButtonFocusAnimation(e,{duration:200,respectsReducedMotion:!0});return"function"==typeof s&&this.hoverCleanups.set(`hover-${t.id}`,s),"function"==typeof n&&this.hoverCleanups.set(`focus-${t.id}`,n),e}createButtonContent(t){const e=document.createElement("div");e.className="dino-button-content",Object.assign(e.style,{display:"flex",alignItems:"center",gap:"12px",width:"100%"});const i=document.createElement("div");i.className="dino-action-icon",i.innerHTML=t.icon,Object.assign(i.style,{fontSize:"20px",lineHeight:"1",flexShrink:"0",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center"});const s=document.createElement("div");s.className="dino-action-text",Object.assign(s.style,{flex:"1",textAlign:"left"});const n=document.createElement("div");n.className="dino-action-label",n.textContent=t.label,Object.assign(n.style,{fontSize:"16px",fontWeight:"500",color:"var(--dino-glass-text)",lineHeight:"1.2",marginBottom:"2px"});const r=document.createElement("div");return r.className="dino-action-description",r.textContent=this.getActionDescription(t),Object.assign(r.style,{fontSize:"13px",color:"var(--dino-glass-text-secondary)",lineHeight:"1.3"}),s.appendChild(n),s.appendChild(r),e.appendChild(i),e.appendChild(s),e}applyBaseStyles(t){Object.assign(t.style,{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",zIndex:"999999",display:"none",pointerEvents:"none"})}applySidebarPanelStyles(t){const e=this.currentViewport?.isMobile||!1,i=this.currentViewport?.isTouchDevice||!1,s=this.responsiveManager?.getOptimalSidebarWidth()||320;t.className="dino-sidebar-panel dino-sidebar",Object.assign(t.style,{position:"fixed",top:"0",right:"0",width:e?"100vw":`${s}px`,maxWidth:e?"none":"90vw",height:"100vh",background:"var(--dino-glass-bg)",backdropFilter:"var(--dino-glass-backdrop)",WebkitBackdropFilter:"var(--dino-glass-backdrop)",border:"1px solid var(--dino-glass-border)",borderRight:e?"1px solid var(--dino-glass-border)":"none",boxShadow:e?"0 -8px 32px var(--dino-glass-shadow)":"-8px 0 32px var(--dino-glass-shadow), inset 1px 0 0 var(--dino-glass-border)",transform:e?"translateY(100%)":"translateX(100%)",transition:"transform var(--dino-duration-normal) var(--dino-easing-ease)",willChange:"transform",pointerEvents:"auto",...e&&{bottom:"0",top:"auto",height:"auto",maxHeight:"80vh",borderRadius:"16px 16px 0 0",borderBottom:"none"},...i&&{WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"}})}applyActionButtonStyles(t){const e=this.currentViewport?.isTouchDevice||!1,i=this.responsiveManager?.getTouchTargetSize()||44;t.className="dino-action-button dino-button",Object.assign(t.style,{width:"100%",padding:e?"18px 16px":"16px",minHeight:e?`${i}px`:"auto",border:"none",borderRadius:"12px",background:"var(--dino-glass-bg)",backdropFilter:"var(--dino-glass-backdrop)",WebkitBackdropFilter:"var(--dino-glass-backdrop)",border:"1px solid var(--dino-glass-border)",color:"var(--dino-glass-text)",cursor:"pointer",boxShadow:"0 2px 8px var(--dino-glass-shadow)",transition:"all var(--dino-duration-fast) var(--dino-easing-ease)",transform:"scale(1)",textAlign:"left",...e&&{WebkitTapHighlightColor:"transparent",touchAction:"manipulation",userSelect:"none",WebkitUserSelect:"none"},willChange:"transform, background, box-shadow"}),t.addEventListener("mouseenter",()=>{this.isDestroyed||this.isButtonDisabled(t)||Object.assign(t.style,{background:"var(--dino-glass-accent)",transform:"scale(1.02)",boxShadow:"0 4px 16px var(--dino-glass-shadow), 0 0 0 1px var(--dino-glass-border)"})}),t.addEventListener("mouseleave",()=>{this.isDestroyed||this.isButtonDisabled(t)||Object.assign(t.style,{background:"var(--dino-glass-bg)",transform:"scale(1)",boxShadow:"0 2px 8px var(--dino-glass-shadow)"})}),t.addEventListener("mousedown",()=>{this.isDestroyed||this.isButtonDisabled(t)||(t.style.transform="scale(0.98)")}),t.addEventListener("mouseup",()=>{this.isDestroyed||this.isButtonDisabled(t)||(t.style.transform="scale(1.02)")})}updateElement(){if(!this.element||this.isDestroyed)return;const{visible:t,isProcessing:e,currentAction:i}=this.props;t?(this.element.style.display="block",this.updateProcessingStates(e,i)):this.element.style.display="none"}updateProcessingStates(t,e){this.element&&this.element.querySelectorAll(".dino-action-button").forEach(i=>{const s=i.getAttribute("data-action-id");t&&s===e?this.setButtonLoading(i,!0):(this.setButtonLoading(i,!1),this.setButtonDisabled(i,t||!1))})}setButtonLoading(t,e){const i=t.getAttribute("data-action-id")||"unknown",s=this.overlayAnimations.animateLoadingState(t,e,{duration:1e3,respectsReducedMotion:!0});if(e)this.animationCleanups.set(`loading-${i}`,s),Object.assign(t.style,{background:"linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.1))",border:"1px solid rgba(59, 130, 246, 0.3)",cursor:"not-allowed"});else{this.animationCleanups.delete(`loading-${i}`);const e=t.querySelector(".dino-action-icon"),s=this.actions.find(t=>t.id===i);s&&e&&(e.innerHTML=s.icon),this.applyActionButtonStyles(t)}}setButtonDisabled(t,e){e?Object.assign(t.style,{opacity:"0.5",cursor:"not-allowed",pointerEvents:"none"}):Object.assign(t.style,{opacity:"1",cursor:"pointer",pointerEvents:"auto"})}isButtonDisabled(t){return"not-allowed"===t.style.cursor}createLoadingSpinner(){const t=document.createElement("div");t.className="dino-loading-spinner",Object.assign(t.style,{width:"20px",height:"20px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTop:"2px solid rgba(255, 255, 255, 0.8)",borderRadius:"50%",animation:"spin 1s linear infinite"});const e=document.createElement("style");return e.textContent="\n      @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n    ",document.head.querySelector("style[data-dino-spinner]")||(e.setAttribute("data-dino-spinner","true"),document.head.appendChild(e)),t}slideIn(){if(!this.element||this.isDestroyed)return;this.slideAnimation&&this.slideAnimation.cancel();const t=this.currentViewport?.isMobile||!1,e=this.overlayAnimations.animateSidebarIn(this.element,t,{duration:t?400:300,easing:"cubic-bezier(0.34, 1.56, 0.64, 1)",respectsReducedMotion:!0});this.animationCleanups.set("slide-in",e)}slideOut(){if(!this.element||this.isDestroyed)return;this.slideAnimation&&this.slideAnimation.cancel();const t=this.currentViewport?.isMobile||!1,e=this.overlayAnimations.animateSidebarOut(this.element,t,{duration:t?350:250,easing:"cubic-bezier(0.4, 0, 1, 1)",respectsReducedMotion:!0});this.animationCleanups.set("slide-out",e),setTimeout(()=>{!this.isDestroyed&&this.element&&(this.element.style.display="none",this.element.style.pointerEvents="none")},t?350:250)}getDefaultActions(){return[{id:"minimalist",label:"Minimalist Style",icon:"✨",prompt:"Transform this room into a minimalist style with clean lines, neutral colors, and uncluttered space",category:"style"},{id:"scandi",label:"Scandinavian Style",icon:"🏔️",prompt:"Apply Scandinavian design with light woods, cozy textures, and hygge elements",category:"style"},{id:"modern",label:"Modern Contemporary",icon:"🏢",prompt:"Create a modern contemporary look with sleek furniture and bold accents",category:"style"},{id:"add-sofa",label:"Add Sofa",icon:"🛋️",prompt:"Add a stylish sofa that complements the room's existing design and color scheme",category:"furniture"},{id:"add-furniture",label:"Add Furniture",icon:"🪑",prompt:"Add appropriate furniture pieces to make this room more functional and inviting",category:"furniture"},{id:"lighting",label:"Improve Lighting",icon:"💡",prompt:"Enhance the room's lighting with modern fixtures and ambient lighting solutions",category:"lighting"},{id:"plants",label:"Add Plants",icon:"🌿",prompt:"Add indoor plants and greenery to bring life and freshness to the space",category:"decor"},{id:"artwork",label:"Add Artwork",icon:"🖼️",prompt:"Add tasteful artwork and wall decorations that complement the room's style",category:"decor"}]}getActionDescription(t){return{minimalist:"Clean, uncluttered aesthetic",scandi:"Cozy Nordic design elements",modern:"Sleek contemporary styling","add-sofa":"Perfect seating solution","add-furniture":"Complete the room setup",lighting:"Brighten and enhance mood",plants:"Natural greenery and life",artwork:"Personalize with wall art"}[t.id]||"Transform your space"}handleActionClick(t){this.isDestroyed||this.props.isProcessing||this.props.onActionClick(t)}handleCloseClick(t){t.preventDefault(),t.stopPropagation(),this.isDestroyed||this.props.onClose()}handleBackdropClick(t){t.preventDefault(),t.stopPropagation(),this.isDestroyed||this.props.onClose()}setupResponsiveHandling(){this.responsiveManager&&(this.responsiveManager.on("viewportResized",this.handleViewportChange),this.responsiveManager.on("breakpointChanged",this.handleViewportChange))}setupTouchGestures(){this.element&&this.currentViewport?.isTouchDevice&&(this.touchGestureHandler=new f(this.element,{swipeThreshold:50,swipeVelocityThreshold:.3,debug:!1}),this.touchGestureHandler.on("swipe",this.handleSwipeGesture),this.touchGestureHandler.initialize())}handleViewportChange(t){if(this.isDestroyed)return;const e=this.currentViewport;this.currentViewport=t,e&&e.isMobile===t.isMobile&&e.isTablet===t.isTablet||this.updateResponsiveStyles()}handleSwipeGesture(t){if(this.isDestroyed||!this.props.visible)return;const e=this.currentViewport?.isMobile||!1;e&&"down"===t.direction?this.props.onClose():e||"right"!==t.direction||this.props.onClose()}updateResponsiveStyles(){if(!this.element||!this.currentViewport)return;const t=this.element.querySelector(".dino-sidebar-panel");t&&this.applySidebarPanelStyles(t),this.element.querySelectorAll(".dino-action-button").forEach(t=>{this.applyActionButtonStyles(t)});const e=this.element.querySelector(".dino-sidebar-close");e&&this.updateCloseButtonForTouch(e)}updateCloseButtonForTouch(t){const e=this.currentViewport?.isTouchDevice||!1,i=this.responsiveManager?.getTouchTargetSize()||44;e&&Object.assign(t.style,{width:`${i}px`,height:`${i}px`,fontSize:"24px",WebkitTapHighlightColor:"transparent",touchAction:"manipulation"})}applyThemeStyles(){if(!this.element||!this.currentTheme)return;const t=this.element.querySelector(".dino-sidebar-panel");t&&this.applySidebarPanelStyles(t);const e=this.element.querySelector(".dino-sidebar-backdrop");e&&Object.assign(e.style,{backgroundColor:"dark"===this.currentTheme.mode?"rgba(0, 0, 0, 0.4)":"rgba(0, 0, 0, 0.2)"});const i=this.element.querySelector(".dino-sidebar-title");i&&(i.style.color="var(--dino-glass-text)");const s=this.element.querySelector(".dino-sidebar-subtitle");s&&(s.style.color="var(--dino-glass-text-secondary)");const n=this.element.querySelector(".dino-sidebar-close");n&&Object.assign(n.style,{background:"var(--dino-glass-bg)",color:"var(--dino-glass-text)",border:"1px solid var(--dino-glass-border)"}),this.element.querySelectorAll(".dino-action-button").forEach(t=>{this.applyActionButtonStyles(t);const e=t.querySelector(".dino-action-label");e&&(e.style.color="var(--dino-glass-text)");const i=t.querySelector(".dino-action-description");i&&(i.style.color="var(--dino-glass-text-secondary)")})}}const x=Object.freeze(Object.defineProperty({__proto__:null,QuickActionSidebar:y},Symbol.toStringTag,{value:"Module"}));class v{constructor(t,e,i){this.element=null,this.inputElement=null,this.sendButton=null,this.typingIndicator=null,this.isVisible=!1,this.isAnimating=!1,this.responsiveManager=null,this.currentViewport=null,this.animationCleanups=new Map,this.hoverCleanups=new Map,this.props={...t},this.responsiveManager=e||null,this.overlayAnimations=i||new p(new(require("./AnimationSystem").AnimationSystem)),this.responsiveManager&&(this.currentViewport=this.responsiveManager.getViewportInfo()),this.handleSubmit=this.handleSubmit.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.handleInputChange=this.handleInputChange.bind(this),this.handleSendClick=this.handleSendClick.bind(this),this.handleViewportChange=this.handleViewportChange.bind(this)}render(){return this.element||(this.element=this.createElement(),this.setupResponsiveHandling(),this.updateVisibility()),this.element}update(t){const e={visible:t.chatBarVisible,selectedImage:t.selectedImage,onSubmit:this.props.onSubmit,onClose:this.props.onClose,isProcessing:t.isProcessing,placeholder:this.props.placeholder};this.updateProps(e)}destroy(){this.animationCleanups.forEach(t=>t.cancel()),this.animationCleanups.clear(),this.hoverCleanups.forEach(t=>t()),this.hoverCleanups.clear(),this.overlayAnimations.cleanup(),this.responsiveManager&&(this.responsiveManager.off("viewportResized",this.handleViewportChange),this.responsiveManager.off("breakpointChanged",this.handleViewportChange)),this.element&&(this.element.remove(),this.element=null,this.inputElement=null,this.sendButton=null,this.typingIndicator=null),this.currentViewport=null}updateProps(t){const e=this.props.visible;this.props={...this.props,...t},this.element&&(this.updateVisibility(),this.updateProcessingState(),this.updatePlaceholder(),e!==this.props.visible&&(this.props.visible?this.show():this.hide()))}focusInput(){this.inputElement&&this.props.visible&&setTimeout(()=>{this.inputElement?.focus()},100)}clearInput(){this.inputElement&&(this.inputElement.value="",this.updateSendButtonState())}createElement(){const t=document.createElement("div");t.className=this.getContainerClasses(),t.style.cssText=this.getContainerStyles();const e=document.createElement("div");e.className="glass-panel flex items-center gap-2 p-3 min-w-80 max-w-md";const i=document.createElement("div");i.className="flex-1 relative",this.inputElement=document.createElement("input"),this.inputElement.type="text",this.inputElement.className="glass-input w-full pr-10 text-sm",this.inputElement.placeholder=this.props.placeholder||"Describe your room edit...",this.inputElement.addEventListener("keypress",this.handleKeyPress),this.inputElement.addEventListener("input",this.handleInputChange),this.sendButton=document.createElement("button"),this.sendButton.className="absolute right-2 top-1/2 transform -translate-y-1/2 p-1 rounded-full transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",this.sendButton.innerHTML=this.getSendButtonIcon(),this.sendButton.addEventListener("click",this.handleSendClick),this.sendButton.disabled=!0;const s=this.overlayAnimations.setupButtonHoverAnimation(this.sendButton,{duration:200,respectsReducedMotion:!0}),n=this.overlayAnimations.setupButtonFocusAnimation(this.sendButton,{duration:200,respectsReducedMotion:!0});return this.hoverCleanups.set("send-hover",s),this.hoverCleanups.set("send-focus",n),this.typingIndicator=document.createElement("div"),this.typingIndicator.className="hidden items-center gap-1 text-xs text-gray-400 ml-2",this.typingIndicator.innerHTML='\n      <div class="flex gap-1">\n        <div class="w-1 h-1 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 0ms"></div>\n        <div class="w-1 h-1 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 150ms"></div>\n        <div class="w-1 h-1 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 300ms"></div>\n      </div>\n      <span>Processing...</span>\n    ',this.typingIndicator.classList.add("hidden"),this.typingIndicator.classList.remove("flex"),i.appendChild(this.inputElement),i.appendChild(this.sendButton),e.appendChild(i),e.appendChild(this.typingIndicator),t.appendChild(e),t}getContainerClasses(){return["fixed","z-50","transition-all","duration-300","ease-out","pointer-events-auto"].join(" ")}getContainerStyles(){const t=this.calculatePosition(),e=this.currentViewport?.isMobile||!1,i=[`bottom: ${t.bottom}px`,`right: ${t.right}px`,"transform: translateY(0)",this.isVisible?"opacity: 1":"opacity: 0",this.isVisible?"pointer-events: auto":"pointer-events: none"];return void 0!==t.left&&i.push(`left: ${t.left}px`),e&&(i.push("width: calc(100vw - 24px)"),i.push("max-width: none")),i.join("; ")}calculatePosition(){return this.responsiveManager?this.responsiveManager.getOptimalChatBarPosition():this.currentViewport?.isMobile?{bottom:12,right:12,left:12}:{bottom:20,right:20}}updateVisibility(){if(!this.element)return;const t=this.props.visible&&null!==this.props.selectedImage;t!==this.isVisible&&(this.isVisible=t,this.element.style.opacity=this.isVisible?"1":"0",this.element.style.pointerEvents=this.isVisible?"auto":"none",this.isVisible&&this.focusInput())}updateProcessingState(){if(!this.inputElement||!this.sendButton||!this.typingIndicator)return;const t=this.props.isProcessing||!1;this.inputElement.disabled=t,this.sendButton.disabled=t||""===this.inputElement.value.trim();const e=this.overlayAnimations.animateLoadingState(this.typingIndicator,t,{duration:1e3,respectsReducedMotion:!0});t?(this.animationCleanups.set("processing",e),this.typingIndicator.classList.remove("hidden"),this.typingIndicator.classList.add("flex")):(this.animationCleanups.delete("processing"),this.typingIndicator.classList.remove("flex"),this.typingIndicator.classList.add("hidden")),this.inputElement.style.transition="opacity 0.2s ease",this.inputElement.style.opacity=t?"0.6":"1"}updatePlaceholder(){this.inputElement&&(this.props.selectedImage?this.props.placeholder?this.inputElement.placeholder=this.props.placeholder:this.inputElement.placeholder="Describe your room edit...":this.inputElement.placeholder="Select an image first...")}updateSendButtonState(){if(!this.sendButton||!this.inputElement)return;const t=this.inputElement.value.trim().length>0,e=this.props.isProcessing||!1;this.sendButton.disabled=!t||e,this.sendButton.className=t&&!e?this.sendButton.className.replace("text-gray-400","text-blue-400 hover:text-blue-300 hover:bg-blue-400/10"):this.sendButton.className.replace("text-blue-400 hover:text-blue-300 hover:bg-blue-400/10","text-gray-400")}getSendButtonIcon(){return'\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <line x1="22" y1="2" x2="11" y2="13"></line>\n        <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>\n      </svg>\n    '}show(){if(!this.element||this.isAnimating)return;this.isAnimating=!0;const t=this.overlayAnimations.animateChatBarIn(this.element,{duration:300,easing:"cubic-bezier(0.34, 1.56, 0.64, 1)",respectsReducedMotion:!0});this.animationCleanups.set("show",t),setTimeout(()=>{this.isAnimating=!1,this.focusInput()},300)}hide(){if(!this.element||this.isAnimating)return;this.isAnimating=!0;const t=this.overlayAnimations.animateChatBarOut(this.element,{duration:250,easing:"cubic-bezier(0.4, 0, 1, 1)",respectsReducedMotion:!0});this.animationCleanups.set("hide",t),setTimeout(()=>{this.isAnimating=!1},250)}handleSubmit(t){t.trim()&&!this.props.isProcessing&&this.props.selectedImage&&(this.props.onSubmit(t.trim()),this.clearInput())}handleKeyPress(t){if("Enter"!==t.key||t.shiftKey)"Escape"===t.key&&this.props.onClose();else{t.preventDefault();const e=t.target.value;this.handleSubmit(e)}}handleInputChange(){this.updateSendButtonState()}handleSendClick(){if(this.inputElement){const t=this.inputElement.value;this.handleSubmit(t)}}setupResponsiveHandling(){this.responsiveManager&&(this.responsiveManager.on("viewportResized",this.handleViewportChange),this.responsiveManager.on("breakpointChanged",this.handleViewportChange))}handleViewportChange(t){const e=this.currentViewport;this.currentViewport=t,e&&e.isMobile===t.isMobile&&e.isTablet===t.isTablet||this.updateResponsiveStyles()}updateResponsiveStyles(){this.element&&this.currentViewport&&(this.element.style.cssText=this.getContainerStyles(),this.inputElement&&this.updateInputForTouch(),this.sendButton&&this.updateSendButtonForTouch())}updateInputForTouch(){if(!this.inputElement||!this.currentViewport)return;const t=this.currentViewport.isTouchDevice,e=this.responsiveManager?.getTouchTargetSize()||44;t&&Object.assign(this.inputElement.style,{minHeight:`${e}px`,fontSize:"16px",WebkitTapHighlightColor:"transparent",touchAction:"manipulation"})}updateSendButtonForTouch(){if(!this.sendButton||!this.currentViewport)return;const t=this.currentViewport.isTouchDevice,e=this.responsiveManager?.getTouchTargetSize()||44;t&&Object.assign(this.sendButton.style,{width:`${e}px`,height:`${e}px`,WebkitTapHighlightColor:"transparent",touchAction:"manipulation"})}}const I=Object.freeze(Object.defineProperty({__proto__:null,FloatingChatBar:v},Symbol.toStringTag,{value:"Module"}));class O{constructor(t={}){this.errorQueue=[],this.retryAttempts=new Map,this.networkStatus={isOnline:navigator.onLine,lastChecked:Date.now()},this.rateLimitInfo=null,this.errorCounts=new Map,this.windowStartTime=Date.now(),this.config={maxRetryAttempts:3,retryBaseDelay:1e3,retryMaxDelay:3e4,rateLimitWindow:6e4,maxErrorsPerWindow:10,enableUserNotifications:!0,enableErrorReporting:!0,debug:!1,...t},this.setupNetworkMonitoring(),this.setupErrorReporting()}handleNetworkError(t){const e={category:"network",code:this.getNetworkErrorCode(t),message:t.message,userMessage:this.getNetworkErrorMessage(t),retryable:!0,context:{isOnline:this.networkStatus.isOnline,timestamp:Date.now(),originalError:t}};return this.processError(e),e}handleImageError(t,e){const i={category:"image",code:this.getImageErrorCode(t),message:t.message,userMessage:this.getImageErrorMessage(t),retryable:this.isImageErrorRetryable(t),context:{imageContext:e,timestamp:Date.now(),originalError:t}};return this.processError(i),i}handleDOMError(t,e){const i={category:"dom",code:this.getDOMErrorCode(t),message:t.message,userMessage:this.getDOMErrorMessage(t),retryable:!1,context:{domContext:e,userAgent:navigator.userAgent,timestamp:Date.now(),originalError:t}};return this.processError(i),i}handleConfigError(t,e){const i={category:"config",code:this.getConfigErrorCode(t),message:t.message,userMessage:this.getConfigErrorMessage(t),retryable:!1,context:{configContext:e,timestamp:Date.now(),originalError:t}};return this.processError(i),i}handleAPIError(t){const e=this.isRateLimitError(t),i={category:e?"rate_limit":"api",code:this.getAPIErrorCode(t),message:t.message,userMessage:this.getAPIErrorMessage(t),retryable:t.retryable||e,retryAfter:e?this.extractRetryAfter(t):void 0,context:{status:t.status,apiCode:t.code,timestamp:Date.now(),originalError:t}};return e&&this.updateRateLimitInfo(t),this.processError(i),i}shouldRetry(t){if(!t.retryable)return!1;const e=`${t.category}:${t.code}`;return!((this.retryAttempts.get(e)||[]).length>=this.config.maxRetryAttempts)&&("rate_limit"===t.category&&this.rateLimitInfo?Date.now()>=this.rateLimitInfo.resetTime:!("network"===t.category&&!this.networkStatus.isOnline))}calculateRetryDelay(t){if(t.retryAfter)return 1e3*t.retryAfter;const e=`${t.category}:${t.code}`,i=(this.retryAttempts.get(e)||[]).length,s=this.config.retryBaseDelay*Math.pow(2,i),n=.1*Math.random()*s,r=Math.min(s+n,this.config.retryMaxDelay);return Math.floor(r)}recordRetryAttempt(t){const e=`${t.category}:${t.code}`,i=this.retryAttempts.get(e)||[];i.push({timestamp:Date.now(),error:t,attempt:i.length+1}),this.retryAttempts.set(e,i)}clearRetryAttempts(t){const e=`${t.category}:${t.code}`;this.retryAttempts.delete(e)}getNetworkStatus(){return{...this.networkStatus}}getRateLimitInfo(){return this.rateLimitInfo?{...this.rateLimitInfo}:null}showUserError(t){if(!this.config.enableUserNotifications)return;const e=this.createErrorNotification(t);this.displayNotification(e)}processError(t){this.errorQueue.push(t),this.errorQueue.length>100&&this.errorQueue.shift(),this.updateErrorCounts(t),this.config.debug,this.config.enableErrorReporting&&this.reportError(t),this.showUserError(t)}updateErrorCounts(t){const e=Date.now();e-this.windowStartTime>this.config.rateLimitWindow&&(this.errorCounts.clear(),this.windowStartTime=e);const i=`${t.category}:${t.code}`,s=this.errorCounts.get(i)||0;this.errorCounts.set(i,s+1)}setupNetworkMonitoring(){if(window.addEventListener("online",()=>{this.networkStatus.isOnline=!0,this.networkStatus.lastChecked=Date.now()}),window.addEventListener("offline",()=>{this.networkStatus.isOnline=!1,this.networkStatus.lastChecked=Date.now()}),"connection"in navigator){const t=navigator.connection;this.networkStatus.connectionType=t.effectiveType,t.addEventListener("change",()=>{this.networkStatus.connectionType=t.effectiveType,this.networkStatus.lastChecked=Date.now()})}}setupErrorReporting(){window.addEventListener("error",t=>{this.handleDOMError(t.error,{filename:t.filename,lineno:t.lineno,colno:t.colno})}),window.addEventListener("unhandledrejection",t=>{this.handleDOMError(new Error(t.reason),{type:"unhandledrejection",reason:t.reason})})}getNetworkErrorCode(t){const e=t.message.toLowerCase();return e.includes("timeout")?"NETWORK_TIMEOUT":e.includes("fetch")?"FETCH_ERROR":e.includes("cors")?"CORS_ERROR":e.includes("econnreset")?"CONNECTION_RESET":e.includes("enotfound")?"DNS_ERROR":"status"in t&&t.status?`HTTP_${t.status}`:"NETWORK_UNKNOWN"}getImageErrorCode(t){const e=t.message.toLowerCase();return e.includes("format")?"INVALID_FORMAT":e.includes("size")?"SIZE_ERROR":e.includes("corrupt")?"CORRUPTED_IMAGE":e.includes("base64")?"INVALID_BASE64":e.includes("processing")?"PROCESSING_FAILED":"IMAGE_UNKNOWN"}getDOMErrorCode(t){const e=t.message.toLowerCase();return e.includes("permission")?"PERMISSION_DENIED":e.includes("not found")?"ELEMENT_NOT_FOUND":e.includes("shadow")?"SHADOW_DOM_ERROR":e.includes("mutation")?"MUTATION_ERROR":"DOM_UNKNOWN"}getConfigErrorCode(t){const e=t.message.toLowerCase();return e.includes("api key")?"INVALID_API_KEY":e.includes("endpoint")?"INVALID_ENDPOINT":e.includes("required")?"MISSING_CONFIG":e.includes("format")?"INVALID_FORMAT":"CONFIG_UNKNOWN"}getAPIErrorCode(t){return t.code?t.code:t.status?`HTTP_${t.status}`:"API_UNKNOWN"}getNetworkErrorMessage(t){switch(this.getNetworkErrorCode(t)){case"NETWORK_TIMEOUT":return"Request timed out. Please check your connection and try again.";case"CORS_ERROR":return"Unable to connect to the service. Please contact support.";case"DNS_ERROR":return"Unable to reach the server. Please check your internet connection.";case"HTTP_429":return"Too many requests. Please wait a moment before trying again.";case"HTTP_500":case"HTTP_502":case"HTTP_503":case"HTTP_504":return"Service temporarily unavailable. Please try again in a few moments.";default:return"Unable to connect to AI service. Please check your connection."}}getImageErrorMessage(t){switch(this.getImageErrorCode(t)){case"INVALID_FORMAT":return"Image format not supported. Please use JPG, PNG, or WebP images.";case"SIZE_ERROR":return"Image is too large. Please use an image smaller than 10MB.";case"CORRUPTED_IMAGE":return"Image appears to be corrupted. Please try a different image.";case"INVALID_BASE64":return"Image data is invalid. Please try uploading the image again.";case"PROCESSING_FAILED":return"Image processing failed. Please try a different image or prompt.";default:return"Image processing failed. Please try a different image."}}getDOMErrorMessage(t){switch(this.getDOMErrorCode(t)){case"PERMISSION_DENIED":return"Browser permissions required. Please allow the requested permissions.";case"ELEMENT_NOT_FOUND":return"Page element not found. Please refresh the page and try again.";case"SHADOW_DOM_ERROR":return"Browser compatibility issue. Please try a different browser.";default:return"Browser compatibility issue. Please update or try a different browser."}}getConfigErrorMessage(t){switch(this.getConfigErrorCode(t)){case"INVALID_API_KEY":return"Invalid API configuration. Please contact the website administrator.";case"INVALID_ENDPOINT":return"Service configuration error. Please contact support.";case"MISSING_CONFIG":return"Missing configuration. Please contact the website administrator.";default:return"Configuration error. Please contact the website administrator."}}getAPIErrorMessage(t){return 429===t.status?"Too many requests. Please wait a moment before trying again.":401===t.status?"Authentication failed. Please contact the website administrator.":403===t.status?"Access denied. Please contact the website administrator.":t.status&&t.status>=500?"Service temporarily unavailable. Please try again in a few moments.":"Request failed. Please try again or contact support if the problem persists."}isImageErrorRetryable(t){return"PROCESSING_FAILED"===this.getImageErrorCode(t)}isRateLimitError(t){return 429===t.status||"RATE_LIMIT_EXCEEDED"===t.code}extractRetryAfter(t){if(t.details&&t.details.retryAfter)return parseInt(t.details.retryAfter,10)}updateRateLimitInfo(t){t.details&&(this.rateLimitInfo={remaining:parseInt(t.details.remaining||"0",10),resetTime:Date.now()+1e3*parseInt(t.details.retryAfter||"60",10),limit:parseInt(t.details.limit||"100",10)})}createErrorNotification(t){const e=document.createElement("div");e.className="dino-error-notification",e.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: rgba(239, 68, 68, 0.95);\n      backdrop-filter: blur(10px);\n      color: white;\n      padding: 16px 20px;\n      border-radius: 12px;\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\n      max-width: 400px;\n      z-index: 10000;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      line-height: 1.4;\n      animation: slideIn 0.3s ease-out;\n    ";const i=document.createElement("div");if(i.textContent=t.userMessage,e.appendChild(i),t.retryable){const t=document.createElement("div");t.style.cssText="\n        margin-top: 8px;\n        font-size: 12px;\n        opacity: 0.8;\n      ",t.textContent="Retrying automatically...",e.appendChild(t)}const s=document.createElement("button");return s.innerHTML="×",s.style.cssText="\n      position: absolute;\n      top: 8px;\n      right: 12px;\n      background: none;\n      border: none;\n      color: white;\n      font-size: 18px;\n      cursor: pointer;\n      opacity: 0.7;\n    ",s.onclick=()=>e.remove(),e.appendChild(s),e}displayNotification(t){document.body.appendChild(t),setTimeout(()=>{t.parentNode&&(t.style.animation="slideOut 0.3s ease-in",setTimeout(()=>t.remove(),300))},5e3)}reportError(t){this.config.debug}}class S{constructor(t){this.apiRequestTimes=[],this.errorCount=0,this.totalRequests=0,this.observers=[],this.startTime=performance.now(),this.thresholds={maxLoadTime:2e3,maxBundleSize:204800,maxApiResponseTime:5e3,maxErrorRate:.05,maxMemoryUsage:52428800,...t},this.metrics={loadTime:0,bundleSize:0,apiResponseTime:0,errorRate:0,memoryUsage:0,userEngagement:{imagesSelected:0,actionsTriggered:0,chatMessages:0,sessionDuration:0}},this.initializeMonitoring()}initializeMonitoring(){"PerformanceObserver"in window&&(this.setupResourceObserver(),this.setupNavigationObserver(),this.setupMemoryObserver()),"complete"===document.readyState?this.calculateLoadTime():window.addEventListener("load",()=>this.calculateLoadTime())}setupResourceObserver(){const t=new PerformanceObserver(t=>{for(const e of t.getEntries())e.name.includes("dino-overlay")&&(this.metrics.bundleSize=e.transferSize||0)});t.observe({entryTypes:["resource"]}),this.observers.push(t)}setupNavigationObserver(){const t=new PerformanceObserver(t=>{for(const e of t.getEntries()){const t=e;this.metrics.loadTime=t.loadEventEnd-t.navigationStart}});t.observe({entryTypes:["navigation"]}),this.observers.push(t)}setupMemoryObserver(){"memory"in performance&&setInterval(()=>{const t=performance.memory;this.metrics.memoryUsage=t.usedJSHeapSize},5e3)}calculateLoadTime(){this.metrics.loadTime=performance.now()-this.startTime,this.metrics.userEngagement.sessionDuration=this.metrics.loadTime}trackApiRequest(t,e=!1){this.apiRequestTimes.push(t),this.totalRequests++,e&&this.errorCount++,this.metrics.apiResponseTime=this.apiRequestTimes.reduce((t,e)=>t+e,0)/this.apiRequestTimes.length,this.metrics.errorRate=this.errorCount/this.totalRequests}trackUserEngagement(t,e=1){"sessionDuration"===t?this.metrics.userEngagement.sessionDuration=performance.now()-this.startTime:this.metrics.userEngagement[t]+=e}getMetrics(){return this.metrics.userEngagement.sessionDuration=performance.now()-this.startTime,{...this.metrics}}checkThresholds(){return{loadTime:this.metrics.loadTime<=this.thresholds.maxLoadTime,bundleSize:this.metrics.bundleSize<=this.thresholds.maxBundleSize,apiResponseTime:this.metrics.apiResponseTime<=this.thresholds.maxApiResponseTime,errorRate:this.metrics.errorRate<=this.thresholds.maxErrorRate,memoryUsage:this.metrics.memoryUsage<=this.thresholds.maxMemoryUsage}}generateReport(){const t=this.getMetrics(),e=this.checkThresholds();return`\nDinoOverlay Performance Report\n=============================\nLoad Time: ${t.loadTime.toFixed(2)}ms ${e.loadTime?"✓":"✗"}\nBundle Size: ${(t.bundleSize/1024).toFixed(2)}KB ${e.bundleSize?"✓":"✗"}\nAPI Response Time: ${t.apiResponseTime.toFixed(2)}ms ${e.apiResponseTime?"✓":"✗"}\nError Rate: ${(100*t.errorRate).toFixed(2)}% ${e.errorRate?"✓":"✗"}\nMemory Usage: ${(t.memoryUsage/1024/1024).toFixed(2)}MB ${e.memoryUsage?"✓":"✗"}\n\nUser Engagement:\n- Images Selected: ${t.userEngagement.imagesSelected}\n- Actions Triggered: ${t.userEngagement.actionsTriggered}\n- Chat Messages: ${t.userEngagement.chatMessages}\n- Session Duration: ${(t.userEngagement.sessionDuration/1e3).toFixed(2)}s\n    `.trim()}destroy(){this.observers.forEach(t=>t.disconnect()),this.observers=[]}}const C=new S,T=Object.freeze(Object.defineProperty({__proto__:null,PerformanceMonitor:S,performanceMonitor:C},Symbol.toStringTag,{value:"Module"}));class k{constructor(){this.supportsWebP=!1,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.detectWebPSupport()}async detectWebPSupport(){return new Promise(t=>{const e=new Image;e.onload=e.onerror=()=>{this.supportsWebP=2===e.height,t()},e.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"})}async optimizeImage(t,e={quality:.8}){const i=await this.getImageSize(t.src);await this.loadImageToCanvas(t,e);const s=this.determineOptimalFormat(e.format),n=this.compressImage(s,e.quality),r=this.calculateDataSize(n);return{data:n,format:s,originalSize:i,optimizedSize:r,compressionRatio:i/r,width:this.canvas.width,height:this.canvas.height}}async loadImageToCanvas(t,e){return new Promise((i,s)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{const{width:t,height:s}=this.calculateOptimalDimensions(n.naturalWidth,n.naturalHeight,e);this.canvas.width=t,this.canvas.height=s,this.ctx.clearRect(0,0,t,s),this.ctx.drawImage(n,0,0,t,s),i()},n.onerror=()=>s(new Error("Failed to load image")),n.src=t.src})}calculateOptimalDimensions(t,e,i){let{width:s,height:n}={width:t,height:e};return i.maxWidth&&s>i.maxWidth&&(n=n*i.maxWidth/s,s=i.maxWidth),i.maxHeight&&n>i.maxHeight&&(s=s*i.maxHeight/n,n=i.maxHeight),{width:Math.round(s),height:Math.round(n)}}determineOptimalFormat(t){return t&&"auto"!==t?t:this.supportsWebP?"webp":"jpeg"}compressImage(t,e){const i=`image/${t}`;return this.canvas.toDataURL(i,e)}async getImageSize(t){try{const e=await fetch(t);return(await e.blob()).size}catch{if(t.startsWith("data:")){const e=t.split(",")[1];return Math.round(3*e.length/4)}return 0}}calculateDataSize(t){if(t.startsWith("data:")){const e=t.split(",")[1];return Math.round(3*e.length/4)}return 0}createLazyLoadObserver(t,e={}){const i={root:null,rootMargin:"50px",threshold:.1,...e};return new IntersectionObserver(t,i)}async preloadImage(t){return new Promise((e,i)=>{const s=new Image;s.onload=()=>e(s),s.onerror=()=>i(new Error(`Failed to preload image: ${t}`)),s.src=t})}generateSrcSet(t,e=[320,640,1024,1920]){return e.map(e=>`${t}?w=${e} ${e}w`).join(", ")}generateSizes(t={}){const e={"(max-width: 320px)":"280px","(max-width: 640px)":"600px","(max-width: 1024px)":"960px",...t},i=Object.entries(e),s=i.slice(0,-1).map(([t,e])=>`${t} ${e}`).join(", "),n=i[i.length-1][1];return s?`${s}, ${n}`:n}destroy(){this.canvas.width=0,this.canvas.height=0}}class M{constructor(t){this.loadedImages=new Set,this.optimizer=t,this.observer=this.optimizer.createLazyLoadObserver(this.handleIntersection.bind(this))}handleIntersection(t){t.forEach(t=>{if(t.isIntersecting){const e=t.target;this.loadImage(e),this.observer.unobserve(e)}})}async loadImage(t){if(this.loadedImages.has(t))return;const e=t.dataset.src;if(e)try{t.style.filter="blur(5px)",await this.optimizer.preloadImage(e),t.src=e,t.style.filter="",t.classList.add("loaded"),this.loadedImages.add(t)}catch(i){t.classList.add("error")}}observe(t){this.observer.observe(t)}unobserve(t){this.observer.unobserve(t)}destroy(){this.observer.disconnect(),this.loadedImages.clear()}}const E=new k,R=Object.freeze(Object.defineProperty({__proto__:null,ImageOptimizer:k,LazyImageLoader:M,imageOptimizer:E},Symbol.toStringTag,{value:"Module"}));class A{constructor(){this.componentCache=new Map,this.loadingPromises=new Map,this.preloadQueue=[],this.loadedComponents=new Set,this.initializePreloading()}initializePreloading(){"requestIdleCallback"in window?requestIdleCallback(()=>this.processPreloadQueue()):setTimeout(()=>this.processPreloadQueue(),100)}registerComponent(t){t.preload&&this.preloadQueue.push(t.name)}async loadComponent(t,e){const i=performance.now();if(this.componentCache.has(t))return{component:this.componentCache.get(t),loadTime:performance.now()-i,fromCache:!0};if(this.loadingPromises.has(t))return{component:await this.loadingPromises.get(t),loadTime:performance.now()-i,fromCache:!1};const s=this.loadComponentInternal(e);this.loadingPromises.set(t,s);try{const e=await s;return this.componentCache.set(t,e),this.loadedComponents.add(t),{component:e,loadTime:performance.now()-i,fromCache:!1}}finally{this.loadingPromises.delete(t)}}async loadComponentInternal(t){try{const e=await t();return e.default||e}catch(e){throw e}}async processPreloadQueue(){for(;this.preloadQueue.length>0;){const t=this.preloadQueue.splice(0,2);await Promise.allSettled(t.map(async t=>{})),await new Promise(t=>setTimeout(t,10))}}preloadComponent(t,e){this.loadedComponents.has(t)||this.loadingPromises.has(t)||this.loadComponent(t,e).catch(t=>{})}isComponentLoaded(t){return this.loadedComponents.has(t)}getLoadedComponents(){return Array.from(this.loadedComponents)}clearCache(){this.componentCache.clear(),this.loadedComponents.clear(),this.loadingPromises.clear()}getCacheSize(){return this.componentCache.size}}const D={quickActionSidebar:()=>Promise.resolve().then(()=>x).then(t=>t.QuickActionSidebar),floatingChatBar:()=>Promise.resolve().then(()=>I).then(t=>t.FloatingChatBar),imageHighlighter:()=>Promise.resolve().then(()=>b).then(t=>t.ImageHighlighter),animationSystem:()=>Promise.resolve().then(()=>u).then(t=>t.AnimationSystem),themeManager:()=>Promise.resolve().then(()=>c).then(t=>t.ThemeManager),responsiveManager:()=>Promise.resolve().then(()=>n).then(t=>t.ResponsiveManager),touchGestureHandler:()=>Promise.resolve().then(()=>w).then(t=>t.TouchGestureHandler),imageOptimizer:()=>Promise.resolve().then(()=>R).then(t=>t.ImageOptimizer),performanceMonitor:()=>Promise.resolve().then(()=>T).then(t=>t.PerformanceMonitor)},P=[{name:"quickActionSidebar",loader:D.quickActionSidebar,priority:"high",preload:!0},{name:"floatingChatBar",loader:D.floatingChatBar,priority:"high",preload:!0},{name:"imageHighlighter",loader:D.imageHighlighter,priority:"high",preload:!0},{name:"animationSystem",loader:D.animationSystem,priority:"medium",preload:!1},{name:"themeManager",loader:D.themeManager,priority:"medium",preload:!1},{name:"responsiveManager",loader:D.responsiveManager,priority:"medium",preload:!1},{name:"touchGestureHandler",loader:D.touchGestureHandler,priority:"low",preload:!1},{name:"imageOptimizer",loader:D.imageOptimizer,priority:"low",preload:!1},{name:"performanceMonitor",loader:D.performanceMonitor,priority:"high",preload:!0}],z=new A;P.forEach(t=>{z.registerComponent(t)});const _={bundleOptimization:{maxBundleSize:204800,maxGzipSize:51200,enableTreeShaking:!0,enableCodeSplitting:!0,enableMinification:!0},lazyLoading:{enableComponentLazyLoading:!0,enableImageLazyLoading:!0,intersectionThreshold:.1,rootMargin:"50px",preloadCriticalComponents:!0},imageOptimization:{enableWebP:!0,defaultQuality:.8,maxWidth:1920,maxHeight:1080,enableCompression:!0},monitoring:{enablePerformanceMonitoring:!0,enableUserEngagementTracking:!0,enableErrorTracking:!0,sampleRate:1},caching:{enableComponentCache:!0,enableImageCache:!0,cacheMaxAge:36e5,maxCacheSize:52428800},thresholds:{maxLoadTime:2e3,maxInitTime:500,maxApiResponseTime:5e3,maxMemoryUsage:52428800,maxErrorRate:.05}},$={..._,monitoring:{..._.monitoring,sampleRate:.1},bundleOptimization:{..._.bundleOptimization,maxBundleSize:153600,maxGzipSize:40960}};class N{constructor(t){this.isProduction="production"===process.env.NODE_ENV,this.config={...this.isProduction?$:_,...t}}getConfig(){return{...this.config}}updateConfig(t){this.config={...this.config,...t}}getBundleConfig(){return this.config.bundleOptimization}getLazyLoadingConfig(){return this.config.lazyLoading}getImageOptimizationConfig(){return this.config.imageOptimization}getMonitoringConfig(){return this.config.monitoring}getCachingConfig(){return this.config.caching}getThresholds(){return this.config.thresholds}shouldEnableFeature(t){const e=this.config[t];if("object"==typeof e&&null!==e){const t=Object.keys(e).find(t=>t.startsWith("enable"));if(t)return e[t]}return!0}validateThresholds(t){const e=this.getThresholds(),i={};return void 0!==t.loadTime&&(i.loadTime=t.loadTime<=e.maxLoadTime),void 0!==t.bundleSize&&(i.bundleSize=t.bundleSize<=this.config.bundleOptimization.maxBundleSize),void 0!==t.apiResponseTime&&(i.apiResponseTime=t.apiResponseTime<=e.maxApiResponseTime),void 0!==t.memoryUsage&&(i.memoryUsage=t.memoryUsage<=e.maxMemoryUsage),void 0!==t.errorRate&&(i.errorRate=t.errorRate<=e.maxErrorRate),i}}const L=new N;return"undefined"!=typeof window&&(window.DinoOverlay={init:t=>{performanceMonitor.trackUserEngagement("sessionDuration"),new DinoOverlayLoader(t).initialize().then(()=>{performanceMonitor.trackUserEngagement("actionsTriggered")}).catch(t=>{performanceMonitor.trackApiRequest(0,!0)})},performanceMonitor:performanceMonitor,lazyComponentLoader:lazyComponentLoader,get loadedComponents(){return lazyComponentLoader.getLoadedComponents()}}),t.APIClient=class{constructor(t,e){if(this.defaultRetryConfig={maxRetries:3,baseDelay:1e3,maxDelay:1e4,backoffMultiplier:2,retryableStatuses:[408,429,500,502,503,504]},this.config={timeout:3e4,retryConfig:{...this.defaultRetryConfig,...t.retryConfig},debug:!1,...t},this.errorManager=e||new O({debug:this.config.debug,enableUserNotifications:!0,enableErrorReporting:!0}),!this.config.baseUrl)throw new Error("APIClient: baseUrl is required");if(!this.config.apiKey)throw new Error("APIClient: apiKey is required")}async editImage(t){this.validateEditImageRequest(t);try{return(await this.makeRequest({method:"POST",endpoint:"/overlay/edit-image",data:t,options:{timeout:6e4,retries:2}})).data}catch(e){this.logError("editImage",e);const t=this.createAPIError(e,"Failed to edit image");throw this.errorManager.handleAPIError(t),t}}async sendChatMessage(t){this.validateChatRequest(t);try{return(await this.makeRequest({method:"POST",endpoint:"/overlay/chat",data:t})).data}catch(e){this.logError("sendChatMessage",e);const t=this.createAPIError(e,"Failed to send chat message");throw this.errorManager.handleAPIError(t),t}}async makeRequest(t){const{method:e,endpoint:i,data:s,options:n={}}=t,r=`${this.config.baseUrl}${i}`,o=n.timeout||this.config.timeout,a=void 0!==n.retries?n.retries:this.config.retryConfig.maxRetries;let h;for(let l=0;l<=a;l++)try{if(l>0){const t=this.calculateBackoffDelay(l);await this.sleep(t),this.log(`Retrying request (attempt ${l+1}/${a+1}): ${e} ${r}`)}const t=await this.executeRequest(e,r,s,o,n.headers);if(this.isSuccessStatus(t.status))return t;const i=new Error(`HTTP ${t.status}: Request failed`);if(i.status=t.status,i.response=t,!this.isRetryableStatus(t.status)||l===a)throw i;h=i;continue}catch(c){if(h=c,!this.isRetryableError(c)||l===a)throw c}throw h}async executeRequest(t,e,i,s,n){const r=new AbortController,o=s?setTimeout(()=>r.abort(),s):null;try{const s={method:t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`,"User-Agent":"DinoOverlay/1.0",...n},signal:r.signal};!i||"POST"!==t&&"PUT"!==t||(s.body=JSON.stringify(i)),this.log(`Making request: ${t} ${e}`);const a=await fetch(e,s);o&&clearTimeout(o);const h={};let c;a.headers.forEach((t,e)=>{h[e]=t});const l=a.headers.get("content-type");return c=l&&l.includes("application/json")?await a.json():await a.text(),{data:c,status:a.status,headers:h,requestId:h["x-request-id"]}}catch(a){if(o&&clearTimeout(o),r.signal.aborted)throw new Error("Request timeout");throw a}}calculateBackoffDelay(t){const{baseDelay:e,maxDelay:i,backoffMultiplier:s}=this.config.retryConfig,n=e*Math.pow(s,t-1);return Math.min(n,i)}sleep(t){return new Promise(e=>setTimeout(e,t))}isSuccessStatus(t){return t>=200&&t<300}isRetryableStatus(t){return this.config.retryConfig.retryableStatuses.includes(t)}isRetryableError(t){const e=t.message.toLowerCase();if(e.includes("fetch")||e.includes("network")||e.includes("timeout")||e.includes("econnreset")||e.includes("enotfound"))return!0;const i=t.status;return!(!i||!this.isRetryableStatus(i))}createAPIError(t,e){const i=new Error(e);return i.name="APIError",t.status?(i.status=t.status,i.code=`HTTP_${t.status}`):t.message.includes("timeout")?(i.code="TIMEOUT",i.retryable=!0):t.message.includes("network")?(i.code="NETWORK_ERROR",i.retryable=!0):i.code="UNKNOWN_ERROR",i.details=t,i}validateEditImageRequest(t){if(!t.prompt||0===t.prompt.trim().length)throw new Error("EditImageRequest: prompt is required");if(!t.imageData&&!t.imageUrl)throw new Error("EditImageRequest: either imageData or imageUrl is required");if(t.imageData&&!this.isValidBase64(t.imageData))throw new Error("EditImageRequest: imageData must be valid base64");if(t.prompt.length>1e3)throw new Error("EditImageRequest: prompt must be less than 1000 characters")}validateChatRequest(t){if(!t.message||0===t.message.trim().length)throw new Error("ChatRequest: message is required");if(t.message.length>2e3)throw new Error("ChatRequest: message must be less than 2000 characters");if(t.imageContext&&!this.isValidBase64(t.imageContext))throw new Error("ChatRequest: imageContext must be valid base64")}isValidBase64(t){try{const e=t.replace(/^data:image\/[a-z]+;base64,/,"");return!!/^[A-Za-z0-9+/]*={0,2}$/.test(e)&&btoa(atob(e))===e}catch{return!1}}log(t){this.config.debug}logError(t,e){this.config.debug}},t.AnimationSystem=l,t.DinoOverlayLoader=class{constructor(t){this.shadowRoot=null,this.container=null,this.isInitialized=!1,this.initializationPromise=null,this.config=this.validateAndMergeConfig(t)}async initialize(){return this.initializationPromise?this.initializationPromise:this.isInitialized?(this.initializationPromise||(this.initializationPromise=Promise.resolve()),this.initializationPromise):(this.initializationPromise=this.performInitialization(),this.initializationPromise)}destroy(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.shadowRoot=null,this.container=null,this.isInitialized=!1,this.initializationPromise=null}getShadowRoot(){return this.shadowRoot}getConfig(){return{...this.config}}isReady(){return this.isInitialized&&null!==this.shadowRoot}async performInitialization(){try{this.validateEnvironment(),await this.createShadowDOM(),await this.loadStyles(),await this.mountOverlay(),this.isInitialized=!0,this.config.debug}catch(t){const e=this.createLoaderError("INITIALIZATION_FAILED",t);throw this.config.debug,e}}validateAndMergeConfig(t){if(!t||"object"!=typeof t)throw this.createLoaderError("INVALID_CONFIG","Configuration must be an object");if(void 0!==t.apiKey&&("string"!=typeof t.apiKey||0===t.apiKey.trim().length))throw this.createLoaderError("INVALID_API_KEY","API key must be a non-empty string");if(t.apiEndpoint)try{new URL(t.apiEndpoint)}catch{throw this.createLoaderError("INVALID_API_ENDPOINT","API endpoint must be a valid URL")}if(t.theme&&!["light","dark","auto"].includes(t.theme))throw this.createLoaderError("INVALID_THEME",'Theme must be "light", "dark", or "auto"');if(t.customActions){if(!Array.isArray(t.customActions))throw this.createLoaderError("INVALID_CUSTOM_ACTIONS","Custom actions must be an array");t.customActions.forEach((t,e)=>{if(!t.id||"string"!=typeof t.id)throw this.createLoaderError("INVALID_CUSTOM_ACTION",`Custom action at index ${e} must have a valid id`);if(!t.label||"string"!=typeof t.label)throw this.createLoaderError("INVALID_CUSTOM_ACTION",`Custom action at index ${e} must have a valid label`);if(!t.prompt||"string"!=typeof t.prompt)throw this.createLoaderError("INVALID_CUSTOM_ACTION",`Custom action at index ${e} must have a valid prompt`)})}return{...e,...t,customActions:t.customActions||[]}}validateEnvironment(){if("undefined"==typeof window)throw this.createLoaderError("NO_WINDOW","DinoOverlay requires a browser environment");if("undefined"==typeof document)throw this.createLoaderError("NO_DOCUMENT","DinoOverlay requires DOM access");if(!document.body)throw this.createLoaderError("NO_BODY","DinoOverlay requires document.body to be available");if(!HTMLElement.prototype.attachShadow)throw this.createLoaderError("NO_SHADOW_DOM","DinoOverlay requires Shadow DOM support")}async createShadowDOM(){try{this.container=document.createElement("div"),this.container.id="dino-overlay-container",this.container.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n        z-index: 2147483647;\n      ",this.shadowRoot=this.container.attachShadow({mode:"closed"}),document.body.appendChild(this.container),this.config.debug}catch(t){throw this.createLoaderError("SHADOW_DOM_CREATION_FAILED",t)}}async loadStyles(){if(!this.shadowRoot)throw this.createLoaderError("NO_SHADOW_ROOT","Shadow root not available for style loading");try{const t=document.createElement("style");t.textContent=this.getBaseStyles(),this.shadowRoot.appendChild(t),this.config.debug}catch(t){throw this.createLoaderError("STYLE_LOADING_FAILED",t)}}async mountOverlay(){if(!this.shadowRoot)throw this.createLoaderError("NO_SHADOW_ROOT","Shadow root not available for overlay mounting");try{const t=document.createElement("div");t.id="overlay-root",t.className="dino-overlay-root",this.shadowRoot.appendChild(t),this.config.debug}catch(t){throw this.createLoaderError("OVERLAY_MOUNTING_FAILED",t)}}getBaseStyles(){return"\n      /* CSS Reset for Shadow DOM */\n      *, *::before, *::after {\n        box-sizing: border-box;\n        margin: 0;\n        padding: 0;\n      }\n\n      /* Base overlay styles */\n      .dino-overlay-root {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 14px;\n        line-height: 1.5;\n        color: #333;\n        pointer-events: none;\n        position: relative;\n        width: 100%;\n        height: 100%;\n      }\n\n      /* Glassmorphic utilities */\n      .glass {\n        background: rgba(255, 255, 255, 0.1);\n        backdrop-filter: blur(10px);\n        -webkit-backdrop-filter: blur(10px);\n        border: 1px solid rgba(255, 255, 255, 0.2);\n        border-radius: 12px;\n      }\n\n      .glass-dark {\n        background: rgba(0, 0, 0, 0.1);\n        backdrop-filter: blur(10px);\n        -webkit-backdrop-filter: blur(10px);\n        border: 1px solid rgba(255, 255, 255, 0.1);\n        border-radius: 12px;\n      }\n\n      /* Interactive elements */\n      .interactive {\n        pointer-events: auto;\n        cursor: pointer;\n        transition: all 0.2s ease;\n      }\n\n      .interactive:hover {\n        transform: scale(1.02);\n        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\n      }\n\n      /* Animation utilities */\n      .fade-in {\n        animation: fadeIn 0.3s ease-out;\n      }\n\n      .slide-in-right {\n        animation: slideInRight 0.3s ease-out;\n      }\n\n      @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n      }\n\n      @keyframes slideInRight {\n        from { \n          opacity: 0;\n          transform: translateX(100%);\n        }\n        to { \n          opacity: 1;\n          transform: translateX(0);\n        }\n      }\n\n      /* Responsive utilities */\n      @media (max-width: 768px) {\n        .dino-overlay-root {\n          font-size: 12px;\n        }\n      }\n    "}createLoaderError(t,e){const i=e instanceof Error?e.message:String(e),s=new Error(`[DinoOverlay] ${i}`);return s.code=t,s.details=e,s}},t.ErrorManager=O,t.FloatingChatBar=v,t.ImageDetector=i,t.ImageHighlighter=m,t.ImageOptimizer=k,t.LazyComponentLoader=A,t.LazyImageLoader=M,t.OverlayAnimations=p,t.OverlayManager=class{constructor(t,e){this.components=new Map,this.eventListeners=new Map,this.positionUpdateTimer=null,this.isDestroyed=!1,this.shadowRoot=t,this.config=e,this.state=this.createInitialState(),this.previousState={...this.state};const n={className:"editable-room",observeChanges:!0,debounceMs:150,debug:e.debug};this.imageDetector=new i(n),this.setupImageDetectorListeners(),this.responsiveManager=new s(e),this.setupResponsiveManagerListeners(),this.themeManager=new h(t,e),this.setupThemeManagerListeners(),this.handleWindowResize=this.handleWindowResize.bind(this),this.handleWindowScroll=this.handleWindowScroll.bind(this),this.handleDocumentClick=this.handleDocumentClick.bind(this)}initialize(){if(this.isDestroyed)throw new Error("OverlayManager has been destroyed");this.imageDetector.startDetection(),this.responsiveManager.initialize(),this.themeManager.initialize(),this.setupGlobalEventListeners(),this.config.debug}destroy(){if(!this.isDestroyed){this.isDestroyed=!0,this.positionUpdateTimer&&(clearTimeout(this.positionUpdateTimer),this.positionUpdateTimer=null),this.imageDetector.destroy(),this.responsiveManager.destroy(),this.themeManager.destroy(),this.removeGlobalEventListeners();for(const t of this.components.values())t.destroy();this.components.clear(),this.eventListeners.clear(),this.config.debug}}getState(){return{...this.state}}selectImage(t){if(!this.isDestroyed)try{const e=this.imageDetector.createSelectedImage(t),i=this.state.selectedImage;this.setState({selectedImage:e,sidebarVisible:!0,chatBarVisible:!0}),this.emit("imageSelected",e),i&&this.emit("imageDeselected",i),this.config.debug}catch(e){}}clearSelection(){if(this.isDestroyed)return;const t=this.state.selectedImage;this.setState({selectedImage:null,sidebarVisible:!1,chatBarVisible:!1,currentAction:null}),t&&this.emit("imageDeselected",t),this.config.debug}updateImagePosition(){if(!this.isDestroyed&&this.state.selectedImage)try{const t=this.imageDetector.calculateImageBounds(this.state.selectedImage.element),e={...this.state.selectedImage,rect:t};this.setState({selectedImage:e}),this.emit("imagePositionUpdated",e),this.config.debug}catch(t){this.clearSelection()}}setSidebarVisible(t){this.isDestroyed||this.state.sidebarVisible!==t&&(this.setState({sidebarVisible:t}),this.emit("sidebarToggled",t))}setChatBarVisible(t){this.isDestroyed||this.state.chatBarVisible!==t&&(this.setState({chatBarVisible:t}),this.emit("chatBarToggled",t))}setProcessingState(t,e){this.isDestroyed||(this.setState({isProcessing:t,currentAction:t&&e||null}),this.emit("processingStateChanged",t,e))}setState(t){this.isDestroyed||(this.previousState={...this.state},this.state={...this.state,...t},this.updateComponents(),this.emit("stateChanged",this.state,this.previousState),this.config.debug)}registerComponent(t,e){if(this.isDestroyed)throw new Error("Cannot register component on destroyed OverlayManager");this.components.has(t)&&this.components.get(t)?.destroy(),this.components.set(t,e),e.update&&e.update(this.state),this.config.debug}unregisterComponent(t){const e=this.components.get(t);e&&(e.destroy(),this.components.delete(t),this.config.debug)}getComponent(t){return this.components.get(t)}on(t,e){this.eventListeners.has(t)||this.eventListeners.set(t,[]),this.eventListeners.get(t).push(e)}off(t,e){const i=this.eventListeners.get(t);if(i){const t=i.indexOf(e);t>-1&&i.splice(t,1)}}getImageDetector(){return this.imageDetector}getShadowRoot(){return this.shadowRoot}getConfig(){return{...this.config}}getResponsiveManager(){return this.responsiveManager}getThemeManager(){return this.themeManager}getCurrentTheme(){return this.themeManager.getCurrentTheme()}setThemeMode(t){this.isDestroyed||this.themeManager.setMode(t)}createInitialState(){return{selectedImage:null,sidebarVisible:!1,chatBarVisible:!1,isProcessing:!1,currentAction:null}}setupImageDetectorListeners(){this.imageDetector.on("imageDetected",t=>{this.attachImageClickListener(t)}),this.imageDetector.on("imageRemoved",t=>{this.state.selectedImage?.element===t&&this.clearSelection(),this.detachImageClickListener(t)}),this.imageDetector.on("imageUpdated",t=>{this.state.selectedImage?.element===t&&this.schedulePositionUpdate()})}setupResponsiveManagerListeners(){this.responsiveManager.on("breakpointChanged",(t,e)=>{this.config.debug,this.state.selectedImage&&this.schedulePositionUpdate()}),this.responsiveManager.on("orientationChanged",t=>{this.config.debug,setTimeout(()=>{this.state.selectedImage&&this.updateImagePosition()},100)})}setupThemeManagerListeners(){this.themeManager.on("themeChanged",(t,e)=>{this.config.debug,this.emit("themeChanged",t,e),this.updateComponents()}),this.themeManager.on("modeChanged",(t,e)=>{this.config.debug}),this.themeManager.on("detectionCompleted",t=>{this.config.debug})}attachImageClickListener(t){const e=e=>{e.preventDefault(),e.stopPropagation(),this.selectImage(t)};t.addEventListener("click",e),t.i=e}detachImageClickListener(t){const e=t.i;e&&(t.removeEventListener("click",e),delete t.i)}setupGlobalEventListeners(){window.addEventListener("resize",this.handleWindowResize,{passive:!0}),window.addEventListener("scroll",this.handleWindowScroll,{passive:!0}),document.addEventListener("click",this.handleDocumentClick)}removeGlobalEventListeners(){window.removeEventListener("resize",this.handleWindowResize),window.removeEventListener("scroll",this.handleWindowScroll),document.removeEventListener("click",this.handleDocumentClick)}handleWindowResize(){this.schedulePositionUpdate()}handleWindowScroll(){this.schedulePositionUpdate()}handleDocumentClick(t){const e=t.target;e instanceof HTMLImageElement&&e.classList.contains("editable-room")||this.shadowRoot.contains(e)||(this.state.sidebarVisible||this.state.chatBarVisible)&&this.setState({sidebarVisible:!1,chatBarVisible:!1})}schedulePositionUpdate(){this.positionUpdateTimer&&clearTimeout(this.positionUpdateTimer),this.positionUpdateTimer=window.setTimeout(()=>{this.updateImagePosition()},16)}updateComponents(){const t=this.themeManager.getCurrentTheme();for(const i of this.components.values()){if(i.update)try{i.update(this.state)}catch(e){}if(i.updateTheme)try{i.updateTheme(t)}catch(e){}}}emit(t,...e){const i=this.eventListeners.get(t);if(i)for(const n of i)try{n(...e)}catch(s){}}},t.PerformanceConfigManager=N,t.PerformanceMonitor=S,t.QuickActionSidebar=y,t.animationSystem=d,t.componentLoaders=D,t.defaultPerformanceConfig=_,t.imageOptimizer=E,t.lazyComponentLoader=z,t.overlayAnimations=g,t.performanceConfigManager=L,t.performanceMonitor=C,t.productionPerformanceConfig=$,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t}({});
//# sourceMappingURL=dino-overlay.iife.js.map
